<!DOCTYPE html>
<html >
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Jerry" />



<meta name="description" content="##1、请描述一次完整的http请求处理过程； 简介一次完整的HTTP请求过程从TCP三次握手建立连接成功后开始,客户端按照指定的格式开始向服务端发送HTTP请求，服务端接收请求后，解析HTTP请求，处理完业务逻辑，最后返回一个HTTP的响应给客户端，HTTP的响应内容同样有标准的格式。无论是什么客户端或者是什么服务端，大家只要按照HTTP的协议标准来实现的话，那么它一定是通用的。 1、客户端发起">
<meta property="og:type" content="article">
<meta property="og:title" content="Jerry&#39;s Blog">
<meta property="og:url" content="https://zhusas/github.io/2018/06/04/第十二周作业/index.html">
<meta property="og:site_name" content="Jerry&#39;s Blog">
<meta property="og:description" content="##1、请描述一次完整的http请求处理过程； 简介一次完整的HTTP请求过程从TCP三次握手建立连接成功后开始,客户端按照指定的格式开始向服务端发送HTTP请求，服务端接收请求后，解析HTTP请求，处理完业务逻辑，最后返回一个HTTP的响应给客户端，HTTP的响应内容同样有标准的格式。无论是什么客户端或者是什么服务端，大家只要按照HTTP的协议标准来实现的话，那么它一定是通用的。 1、客户端发起">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://i.imgur.com/M391Xco.png">
<meta property="og:image" content="http://i.imgur.com/yNpPuHB.png">
<meta property="og:image" content="http://i.imgur.com/cRaZaL8.png">
<meta property="og:image" content="http://i.imgur.com/vDrgmqd.png">
<meta property="og:updated_time" content="2018-06-04T08:29:45.833Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jerry&#39;s Blog">
<meta name="twitter:description" content="##1、请描述一次完整的http请求处理过程； 简介一次完整的HTTP请求过程从TCP三次握手建立连接成功后开始,客户端按照指定的格式开始向服务端发送HTTP请求，服务端接收请求后，解析HTTP请求，处理完业务逻辑，最后返回一个HTTP的响应给客户端，HTTP的响应内容同样有标准的格式。无论是什么客户端或者是什么服务端，大家只要按照HTTP的协议标准来实现的话，那么它一定是通用的。 1、客户端发起">
<meta name="twitter:image" content="http://i.imgur.com/M391Xco.png">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="Jerry&#39;s Blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>Jerry&#39;s Blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: 
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Jerry</a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:zhusas@163.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/zhusas" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">专注于运维</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Jerry</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Jerry</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:zhusas@163.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/zhusas" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-第十二周作业" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2018/06/04/第十二周作业/" class="article-date">
      <time datetime="2018-06-04T08:29:45.833Z" itemprop="datePublished">2018-06-04</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>##1、请描述一次完整的http请求处理过程；</p>
<p><strong>简介</strong><br>一次完整的HTTP请求过程从TCP三次握手建立连接成功后开始,客户端按照指定的格式开始向服务端发送HTTP请求，服务端接收请求后，解析HTTP请求，处理完业务逻辑，最后返回一个HTTP的响应给客户端，HTTP的响应内容同样有标准的格式。无论是什么客户端或者是什么服务端，大家只要按照HTTP的协议标准来实现的话，那么它一定是通用的。</p>
<p><strong>1、客户端发起http请求阶段</strong></p>
<p>客户端在与服务端TCP三次握手建立连接成功后</p>
<p>开始按照指定的格式开始向服务端发送HTTP请求</p>
<p>HTTP请求格式主要有四部分组成，分别是：请求行、请求头、空行、消息体，每部分内容占一行，如下图：<br><img src="http://i.imgur.com/M391Xco.png" alt=""></p>
<p>下面我们来详解一下这个来自客户端的http请求</p>
<p>请求行：请求行是请求消息的第一行，由三部分组成：分别是请求方法（GET/POST/DELETE/PUT/HEAD）、请求资源的URI路径、HTTP的版本号</p>
<p>请求头：请求头中的信息有和缓存相关的头（Cache-Control，If-Modified-Since）、客户端身份信息（User-Agent）等等。</p>
<p>消息体：请求体是客户端发给服务端的请求数据，这部分数据并不是每个请求必须的。</p>
<p><strong>2、服务端接收客户端http请求阶段</strong></p>
<p>服务端接收来自于网络上的主机请求报文中对某特定资源的一次请求的过程</p>
<p><strong>3、服务端处理客户端http请求阶段</strong></p>
<p>对请求报文进行解析，获取客户端请求的资源及请求方法等相关信息；</p>
<p>根据请求报文的头信息，来确定请求合适，编码等</p>
<p><strong>4、服务端根据客户端http请求与访问自己本地资源</strong></p>
<p>获取请求报文中请求的资源，根据请求，从应用-》系统内核-》驱动-》资源存放媒介（硬盘、内存）获取客户端需要的信息</p>
<p><strong>5、服务端构建http响应报文</strong></p>
<p>服务器接收处理完请求后返回一个HTTP相应消息给客户端。HTTP响应消息的格式包括：状态行、响应头、空行、消息体。每部分内容占一行。</p>
<p><img src="http://i.imgur.com/yNpPuHB.png" alt=""></p>
<p>状态行：状态行位于相应消息的第一行，有HTTP协议版本号，状态码和状态说明三部分构成。</p>
<p>响应头：响应头是服务器传递给客户端用于说明服务器的一些信息，以及将来继续访问该资源时的策略。</p>
<p>响应体：响应体是服务端返回给客户端的HTML文本内容，或者其他格式的数据，比如：视频流、图片或者音频数据。</p>
<p><strong>6、服务端将http响应报文发送给客户端</strong></p>
<p>就是在已建立的tcp链接之上将相应报文及客户请求的数据从应用层，传输层、传输层、链路层、物理层层层打包头依次传输到客户端的物理层、链路层、传输层、应用层层层解包，最后客户端获得自己http请求的数据。</p>
<p><strong>7、记录日志</strong></p>
<p>服务端记录http请求访问日志</p>
<p>##2、httpd所支持的处理模型有哪些，他们的分别使用于哪些环境。</p>
<p><strong>prefork：多进程模型，每个进程响应一个请求</strong></p>
<p>一个主进程：负责生成子进程及回收子进程；负责创建套接字；负责接收请求，并将其派发给某子进程进行处理；</p>
<p>n个子进程：每个子进程处理一个请求；</p>
<p>工作模型：会预先生成几个空闲进程，随时等待用于响应用户请求；最大空闲和最小空闲；</p>
<p><strong>worker：多进程多线程模型，每线程处理一个用户请求</strong></p>
<p>一个主进程：负责生成子进程；负责创建套接字；负责接收请求，并将其派发给某子进程进行处理；</p>
<p>多个子进程：每个子进程负责生成多个线程；</p>
<p>每个线程：负责响应用户请求；</p>
<p>并发响应数量：m*n</p>
<p>m：子进程数量</p>
<p>n：每个子进程所能创建的最大线程数量；</p>
<p><strong>event：事件驱动模型，多进程模型，每个进程响应多个请求</strong></p>
<p>一个主进程 ：负责生成子进程；负责创建套接字；负责接收请求，并将其派发给某子进程进行处理；</p>
<p>子进程：基于事件驱动机制直接响应多个请求；</p>
<p>##3、源码编译安装LAMP环境（基于wordpress程序），并写出详细的安装、配置、测试过程。</p>
<p><strong>1、安装包的准备</strong></p>
<p>肯定是下载源码包了啊，所谓兵马未动粮草先行，这步过于简单，我就不写了。</p>
<p>我准备的是以下几个包：<br>httpd-2.4.25.tar.gz<br>nginx-1.10.3.tar.gz（可选项，如果喜欢用nginx）<br>php-5.6.30.tar.gz<br>mariadb-10.1.21.tar.gz<br>openssl-1.0.2k.tar.gz<br>wordpress-4.7.3-zh_CN.tar.gz</p>
<p><strong>2、更新系统组件</strong></p>
<p>CentOS:yum update</p>
<p>Ubuntu:apt update &amp;&amp; apt upgrade</p>
<p>这一步是个人喜好，不喜勿喷~~~</p>
<p><strong>3、检查原有httpd-2.2，如有请卸载</strong></p>
<p>命令 </p>
<p>rpm -qa | grep httpd </p>
<p>yum remove httpd*</p>
<p><strong>4、安装编译以来组件包，保平安</strong></p>
<p>yum groupinstall “Development Tools” “Server Platform Development”</p>
<p>yum install gcc gcc-c++ ncurses-devel perl cmake libaio pcre-devel openssl-devel bison.x86_64 bison-devel.x86_64 libxml2-devel.x86_64 </p>
<p><strong>5、修改主机名</strong></p>
<pre><code>[root@CentOS6 opt]# hostname LAMPW
[root@CentOS6 opt]# vim /etc/sysconfig/network
[root@CentOS6 opt]# vim /etc/hosts
[root@CentOS6 opt]# cat /etc/sysconfig/network
NETWORKING=yes
HOSTNAME=LAMPW
NETWORKING_IPV6=no
[root@CentOS6 opt]# cat /etc/hosts
127.0.0.1   LAMPW
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
[root@CentOS6 opt]# 
</code></pre><p><strong>6、这一步完了记得重启机器</strong></p>
<p>reboot</p>
<p><strong>7、编译安装Apache</strong></p>
<p>httpd-2.4.25需要较新版本的apr和apr-util，因此需要事先对其进行升级。我这里用的是源码包编译安装</p>
<p>(1)编译安装apr</p>
<p>[root@LAMPW opt]# tar zxf apr-1.5.2.tar.gz</p>
<p>[root@LAMPW opt]# cd apr-1.5.2</p>
<p>[root@LAMPW apr-1.5.2]# ./configure –prefix=/opt/apr</p>
<p>[root@LAMPW apr-1.5.2]# make &amp;&amp; make install</p>
<p>(2)编译安装apr-util</p>
<p>[root@LAMPW opt]# tar zxf apr-util-1.5.4.tar.gz</p>
<p>[root@LAMPW opt]# cd apr-util-1.5.4</p>
<p>[root@LAMPW apr-util-1.5.4]# ./configure –prefix=/opt/apr-util –with-apr=/opt/apr</p>
<p>[root@LAMPW apr-util-1.5.4]# make &amp;&amp; make install</p>
<p>(3)编译安装apache2.4.25</p>
<p>编译参数如下：</p>
<pre><code>./configure --prefix=/opt/apache24 \
--enable-so \
--enable-ssl \
--enable-cgi \
--enable-rewrite \
--with-zlib \
--with-pcre \
--with-apr=/opt/apr \ 
--with-apr-util=/opt/apr-util \
--enable-modules=most \
--enable-mpms-shared=all \
--with-mpm=event \
--enable-cache \
--enable-cache-disk \
</code></pre><p>(4)安装apache2.4.25服务脚本</p>
<p>编辑一下内容放到/etc/init.d/下面，附上执行权限，chkconfig –add httpd &amp; chkconfig httpd on设置为开机启动即可，相关内容根据实际路径编辑一下即可：</p>
<pre><code>#!/bin/bash
#chkconfig: - 88 66
#description:  this is a httpd scripts  of myself.
prog=/opt/apache24/bin/httpd
configfile=/opt/apache24/conf/httpd.conf
lockfile=/opt/apache24/lock/httpd
namearg=httpd
pidfile=/opt/apache24/httpd.pid
. /etc/init.d/functions

start() {
    if [ -e $lockfile  ];then
    echo &quot;the program $namearg (`cat $pidfile`)is running&quot; &amp;&amp; exit 1
    else
        echo -n  &quot;Starting $namearg ...&quot; &amp;&amp; sleep 2
        $prog -f $configfile &amp;&amp; touch $lockfile &amp;&amp; echo -e &quot;\t\t\t[\033[32m ok \033[0m]&quot; ||
        echo -e &quot;\t\t\t[\033[32m fail \033[0m]&quot;
    fi
}

stop (){
    if [  -e $lockfile  ];then
    echo -n  &quot;Stopping $namearg...&quot; &amp;&amp; sleep 2
    killproc $namearg   &amp;&gt;/dev/null &amp;&amp; rm -rf $lockfile &amp;&amp; echo -e &quot;\t\t\t[\033[32m ok \033[0m]&quot;||  echo -e &quot;\t\t\t[\033[32m fail \033[0m]&quot;

    else
         echo  -e &quot;Stopping $namearg ...\t\t\t[\033[31m fail\033[0m]&quot;

    fi
}

status () {

    if [ -e $lockfile  ];then
        echo &quot;the program $namearg (`cat $pidfile`)is running&quot; &amp;&amp; exit 1
    else

        echo &quot;the program $namearg is not running&quot;

    fi
}

case $1 in
start)
    start
    ;;
stop)
    stop
    ;;
restart)
    stop
    start
    ;;
status)
    status
    ;;
*)
    echo &quot;Usage: $namearg [start | stop | restart | status  ] &quot;
    ;;
esac
</code></pre><p>(5)为httpd服务的相关命令添加环境变量</p>
<p>vim /etc/profile,添加以下内容：</p>
<pre><code>#Set the httpd variable environment for $PATH
export httpd_HOME=/opt/apache24
export PATH=$PATH:${httpd_HOME}/bin
</code></pre><p>最后echo $PATH看看，OK啦</p>
<p><strong>apache2.4到此编译安装完毕，httpd.conf根据实际情况自己修改一下下啦</strong></p>
<p><strong>8.编译安装mysql-5.6.35,mysql-5.7已弃坑</strong></p>
<p>(1)环境监察，看看有没有已安装的mysql相关包，有的话就卸载掉</p>
<p>基础了，我就不写了</p>
<p>(2)安装cmake，我喜欢用最新版，下载的是cmake version 3.8.0-rc2，源码编译安装，稍微麻烦，但是可以享受其过程。</p>
<pre><code>[root@LAMPW opt]# tar zxf cmake-3.8.0.tar.gz
[root@LAMPW opt]#./bootstrap --help  #看看有什么鬼参数
[root@LAMPW opt]#./bootstrap --prefix=/usr   #我比较懒，直接一步到位，指定/usr目录
[root@LAMPW opt]#make &amp;&amp; make install
[root@LAMPW cmake-3.7.2]# cmake --version
cmake version 3.8.0-rc2

CMake suite maintained and supported by Kitware (kitware.com/cmake).
[root@LAMPW cmake-3.7.2]# 
</code></pre><p>well done！</p>
<p>(3)建立MySQL程序目录和数据存储目录</p>
<pre><code>[root@LAMPW /]# mkdir -pv /data/MySQL_data
mkdir: created directory `/data&apos;
mkdir: created directory `/data/MySQL_data&apos;
[root@LAMPW /]# mkdir -pv /opt/MySQL
mkdir: created directory `/opt/MySQL&apos;
[root@LAMPW /]# 
</code></pre><p>PS：其实这一步可以省略，在编译参数里面制定，make install是强制执行了，没有目录的话会自动创建，数据存放目录除外，亲测有效。</p>
<p>(4)创建MySQL的系统用户组和系统用户</p>
<pre><code>[root@LAMPW /]# groupadd -r mysql
[root@LAMPW /]# useradd -d /data/MySQL_data/ -g mysql -M -r -s /sbin/nologin mysql
[root@LAMPW /]# id mysql
uid=498(mysql) gid=499(mysql) groups=499(mysql)
</code></pre><p>(5)开始编译安装mysql-5.6.35</p>
<pre><code>cmake . -DCMAKE_INSTALL_PREFIX=/opt/mysql \
-DMYSQL_DATADIR=/data/mysql_data \
-DSYSCONFDIR=/opt/mysql/etc \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_ARCHIVE_STORAGE_ENGINE=1 \
-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \
-DWITH_LIBWRAP=0 \
-DMYSQL_UNIX_ADDR=/opt/mysql/tmp/mysql.sock \
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci \
-DENABLED_LOCAL_INFILE=1 \
-DWITH_MEMORY_STORAGE_ENGINE=1 \



make -j 8 &amp;&amp; make install 
</code></pre><p>PS: 编译前要删除/etc/my.cnf，不然编译会报错。</p>
<p>(6)相关目录的授权</p>
<p>cd /data &amp;&amp; chown -R mysql:mysql mysql_data/</p>
<p>cd /opt/ &amp;&amp; chown -R mysql:mysql mysql/</p>
<p>(7)初始化data存放目录设置</p>
<p>cd /opt/mysql &amp;&amp;  scripts/mysql_install_db –user=mysql –basedir=/opt/mysql –datadir=/data/mysql_data</p>
<p> ls /data/mysql_data # 有数据说明初始化成功 </p>
<p>(8)初始化完成后mysql中目录文件的属主应改回成root，以免被别人攻破mysql用户密码而带来数据破坏等</p>
<pre><code>[root@CentOS6 ~]# cd /opt/ &amp;&amp; chown -R root:root mysql/
[root@CentOS6 opt]# ll
total 122444
drwx------  8  501    20     4096 Aug 12  2015 boost_1_59_0
-rw-r--r--  1 root root  83709983 Mar 17 13:08 boost_1_59_0.tar.gz
drwxr-xr-x 15 root root      4096 Mar 17 13:16 cmake-3.8.0-rc2
-rw-r--r--  1 root root   7504498 Mar 17 13:08 cmake-3.8.0-rc2.tar.gz
-rw-r--r--  1 root root   1974108 Mar 17 13:08 make-4.2.tar.gz
drwxr-xr-x 13 root root      4096 Mar 17 17:30 mysql
drwxr-xr-x 35 7161 31415     4096 Mar 17 17:00 mysql-5.6.35
-rw-r--r--  1 root root  32167628 Mar 17 14:55 mysql-5.6.35.tar.gz
[root@CentOS6 opt]# ls mysql/
bin  COPYING  data  docs  include  lib  man  my.cnf  mysql-test  README  scripts  share  sql-bench  support-files
[root@CentOS6 opt]# ll mysql/
total 72
drwxr-xr-x  2 root root  4096 Mar 17 17:01 bin
-rw-r--r--  1 root root 17987 Nov 28 21:36 COPYING
drwxr-xr-x  3 root root  4096 Mar 17 17:00 data
drwxr-xr-x  2 root root  4096 Mar 17 17:00 docs
drwxr-xr-x  3 root root  4096 Mar 17 17:00 include
drwxr-xr-x  3 root root  4096 Mar 17 17:00 lib
drwxr-xr-x  4 root root  4096 Mar 17 17:00 man
-rw-r--r--  1 root root   943 Mar 17 17:30 my.cnf
drwxr-xr-x 10 root root  4096 Mar 17 17:01 mysql-test
-rw-r--r--  1 root root  2496 Nov 28 21:36 README
drwxr-xr-x  2 root root  4096 Mar 17 17:18 scripts
drwxr-xr-x 28 root root  4096 Mar 17 17:01 share
drwxr-xr-x  4 root root  4096 Mar 17 17:01 sql-bench
drwxr-xr-x  2 root root  4096 Mar 17 18:36 support-files
[root@CentOS6 opt]# 
</code></pre><p>（9）mysql主配置文件</p>
<p>初始化后会自动在当前目录下创建一个my.cnf配置文件，直接修改就可以(在mysql 5.6 以后配置文件自动生成，不需要我们再进行复制)，但是/usr/local/mysql/support-files目录下，有默认配置的配置文件，可以拷贝过去。这里我用默认生成的。</p>
<p>修改配置文件  #必须修改啊，不然下一步会报错哦</p>
<pre><code>[root@CentOS6 /]# vim /opt/mysql/my.cnf

[mysqld]

basedir = /opt/mysql
datadir = /data/mysql_data
port = 3306
</code></pre><p>（10）为mysql提供sysv服务脚本并启动服务</p>
<pre><code>[root@CentOS6 ~]# cp /opt/mysql/support-files/mysql.server /etc/init.d/mysqld
[root@CentOS6 ~]#chkconfig --add mysqld
[root@CentOS6 ~]#chkconfig mysqld on
[root@CentOS6 ~]# chkconfig mysqld --list
mysqld             0:off    1:off    2:on    3:on    4:on    5:on    6:off
[root@CentOS6 ~]# 
</code></pre><p>service mysqld start 记得要测试OK，其中启动可能会报错，例如目录权限啊，sock 、pid 文件目录设置等，主要看看报错日志，跟着解决就好。</p>
<p>一通肆虐（测试）</p>
<pre><code>[root@CentOS6 mysql]# service mysqld 
Usage: mysqld  {start|stop|restart|reload|force-reload|status}  [ MySQL server options ]
[root@CentOS6 mysql]# service mysqld stop
Shutting down MySQL.. SUCCESS! 
[root@CentOS6 mysql]# service mysqld reload
 ERROR! MySQL PID file could not be found!
[root@CentOS6 mysql]# service mysqld start
Starting MySQL. SUCCESS! 
[root@CentOS6 mysql]# service mysqld status
 SUCCESS! MySQL running (2019)
[root@CentOS6 mysql]# service mysqld reload
 SUCCESS! Reloading service MySQL
[root@CentOS6 mysql]# service mysqld restart
Shutting down MySQL.. SUCCESS! 
Starting MySQL. SUCCESS! 
[root@CentOS6 mysql]# 
</code></pre><p>嗦嘎！</p>
<p>（11）输出mysql的头文件至系统头文件路径/usr/include</p>
<pre><code>[root@CentOS6 mysql]# ln -sv /opt/mysql/include/ /usr/include/mysql
`/usr/include/mysql&apos; -&gt; `/opt/mysql/include/&apos;
[root@CentOS6 mysql]# 
</code></pre><p>（12）输出mysql的头文件至系统头文件路径/usr/include</p>
<pre><code>[root@CentOS6 mysql]# ln -sv /opt/mysql/include/ /usr/include/mysql
`/usr/include/mysql&apos; -&gt; `/opt/mysql/include/&apos;
[root@CentOS6 mysql]# 
</code></pre><p>（13）输出mysql的库文件给系统库查找路径</p>
<pre><code>[root@CentOS6 ~]# vim /etc/ld.so.conf.d/mysql.conf 
[root@CentOS6 ~]# ldconfig -v |grep mysql
ldconfig: /etc/ld.so.conf.d/kernel-2.6.32-642.el6.x86_64.conf:6: duplicate hwcap 1 nosegneg
/opt/mysql/lib:
    libmysqlclient.so.18 -&gt; libmysqlclient_r.so.18.1.0
/usr/lib64/mysql:
    libmysqlclient.so.16 -&gt; libmysqlclient.so.16.0.0
    libmysqlclient_r.so.16 -&gt; libmysqlclient_r.so.16.0.0
[root@CentOS6 ~]# 
</code></pre><p>（14） 修改PATH环境变量，让系统可以直接使用mysql的相关命令</p>
<pre><code>[root@CentOS6 ~]# echo &quot;export PATH=$PATH:/opt/mysql/bin&quot; &gt; /etc/profile.d/mysql.sh  #一条命令搞定，很叼
[root@CentOS6 ~]# ll /etc/profile.d/mysql.sh
-rw-r--r-- 1 root root 83 Mar 20 11:03 /etc/profile.d/mysql.sh
[root@CentOS6 ~]# cat /etc/profile.d/mysql.sh  #查看一下创建的文件内容
export PATH=/usr/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin:/root/bin:/opt/mysql/bin
[root@CentOS6 ~]# source /etc/profile.d/mysql.sh  #使其即时生效
[root@CentOS6 ~]# echo $?  #命令是OK的
0
[root@CentOS6 ~]# mysql    #用tab键匹配一下MySQL命令 ，bingo！
mysql                       mysql_embedded
mysqlaccess                 mysql_find_rows
mysqlaccess.conf            mysql_fix_extensions
mysqladmin                  mysqlhotcopy
mysqlbinlog                 mysqlimport
mysqlbug                    mysql_plugin
mysqlcheck                  mysql_secure_installation
mysql_client_test           mysql_setpermission
mysql_client_test_embedded  mysqlshow
mysql_config                mysqlslap
mysql_config_editor         mysqltest
mysql_convert_table_format  mysqltest_embedded
mysqld                      mysql_tzinfo_to_sql
mysqld_multi                mysql_upgrade
mysqld_safe                 mysql_waitpid
mysqldump                   mysql_zap
mysqldumpslow               
[root@CentOS6 ~]# 
</code></pre><p>（15） 最终测试，使用mysql命令登录</p>
<pre><code>[root@CentOS6 lib]# mysql
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 2
Server version: 5.6.35 Source distribution

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.

mysql&gt; show status;
+-----------------------------------------------+-------------+
| Variable_name                                 | Value       |
+-----------------------------------------------+-------------+
| Aborted_clients                               | 0           |
| Aborted_connects                              | 0           |
| Binlog_cache_disk_use                         | 0           |
| Binlog_cache_use                              | 0           |
| Binlog_stmt_cache_disk_use                    | 0           |
| Binlog_stmt_cache_use                         | 0           |
| Bytes_received                                | 219         |
| Bytes_sent                                    | 179         |
| Com_admin_commands                            | 0           |
| Com_assign_to_keycache                        | 0    
</code></pre><p><strong>9、编译安装php</strong></p>
<p>（1）安装依赖包保平安</p>
<p>yum install gd-devel libmcrypt-devel libcurl-devel openssl-devel libxml2-devel</p>
<p>(2)下载加压，下面是编译参数</p>
<pre><code>./configure --prefix=/opt/php \
--with-openssl \
--with-mysqli=/opt/mysql/bin/mysql_config \
--enable-mbstring \
--with-freetype-dir \
--with-jpeg-dir \
--with-png-dir \
--with-zlib \
--with-libxml-dir=/usr \
--enable-xml  \
--enable-sockets \
--with-apxs2=/opt/apache24/bin/apxs \
--with-mcrypt  \
--with-config-file-path=/opt/php/conf \
--with-config-file-scan-dir=/opt/php/php.d \
--with-bz2 \
--enable-maintainer-zts \
--with-mysql=mysqlnd \
--with-pdo-mysql=mysqlnd \
--with-mysqli=mysqlnd \
--with-mysql=/opt/mysql \

make -j 8
make test
make install
</code></pre><p>（3）从源码包复制php配置文件</p>
<p>cp /opt/php-5.6.30/php.ini-production /opt/php/etc/</p>
<p>（4） 编辑apache配置文件httpd.conf，以apache支持php ，此为httpd模块加载方式，非fastcgi模式</p>
<h1 id="vim-opt-apache24-conf-httpd-conf"><a href="#vim-opt-apache24-conf-httpd-conf" class="headerlink" title="vim /opt/apache24/conf/httpd.conf"></a>vim /opt/apache24/conf/httpd.conf</h1><p> 1、添加如下二行<br>   AddType application/x-httpd-php  .php<br>   AddType application/x-httpd-php-source  .phps</p>
<p> 2、定位至DirectoryIndex index.html<br>   修改为：<br>    DirectoryIndex  index.php  index.html</p>
<p>而后重新启动httpd，或让其重新载入配置文件即可测试php是否已经可以正常使用。</p>
<p>vim /opt/apache24/htdocs/index.php  测试页面index.php示例如下：</p>
<pre><code>&lt;?php
  $link = mysql_connect(&apos;192.168.0.248&apos;,&apos;root&apos;,&apos;123456&apos;);
  if ($link)
    echo &quot; hahaha, Success...&quot;;
  else
    echo &quot;Failure...&quot;;

  mysql_close();
?&gt;


&lt;? 
        phpinfo(); 
?&gt;
</code></pre><p>（5） 测试是否ok</p>
<p><img src="http://i.imgur.com/cRaZaL8.png" alt=""></p>
<p><strong>安装部署WordPress</strong></p>
<p>（1）下载WordPress，并解压到网站根目录</p>
<pre><code>[root@lampw tools]# cp wordpress-4.7.3-zh_CN.tar.gz /opt/apache24/htdocswordpress.tar.gz
[root@lampw tools]# cd /opt/apache24/htdocs/
[root@lampw htdocs]# tar zxf wordpress.tar.gz 
[root@lampw htdocs]# cd wordpress/
[root@lampw wordpress]# ll
total 188
-rw-r--r--  1 nobody 65534   418 Sep 25  2013 index.php
-rw-r--r--  1 nobody 65534 19935 Jan  3 02:51 license.txt
-rw-r--r--  1 nobody 65534  6956 Mar  7 13:14 readme.html
-rw-r--r--  1 nobody 65534  5447 Sep 28 05:36 wp-activate.php
drwxr-xr-x  9 nobody 65534  4096 Mar  7 13:14 wp-admin
-rw-r--r--  1 nobody 65534   364 Dec 19  2015 wp-blog-header.php
-rw-r--r--  1 nobody 65534  1627 Aug 29  2016 wp-comments-post.php
-rw-r--r--  1 nobody 65534  2930 Mar  7 13:14 wp-config-sample.php
drwxr-xr-x  5 nobody 65534  4096 Mar  7 13:14 wp-content
-rw-r--r--  1 nobody 65534  3286 May 25  2015 wp-cron.php
drwxr-xr-x 18 nobody 65534 12288 Mar  7 13:14 wp-includes
-rw-r--r--  1 nobody 65534  2422 Nov 21 10:46 wp-links-opml.php
-rw-r--r--  1 nobody 65534  3301 Oct 25 11:15 wp-load.php
-rw-r--r--  1 nobody 65534 33939 Nov 21 10:46 wp-login.php
-rw-r--r--  1 nobody 65534  8048 Jan 11 13:15 wp-mail.php
-rw-r--r--  1 nobody 65534 16250 Nov 29 13:39 wp-settings.php
-rw-r--r--  1 nobody 65534 29896 Oct 19 12:47 wp-signup.php
-rw-r--r--  1 nobody 65534  4513 Oct 15 03:39 wp-trackback.php
-rw-r--r--  1 nobody 65534  3065 Sep  1  2016 xmlrpc.php
</code></pre><p>（2）创建WordPress要连接mysql的账号</p>
<pre><code>[root@lampw wordpress]# mysql -u root -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 1419
Server version: 5.6.35 Source distribution

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.

mysql&gt; CREATE DATABASE wpdb; 
Query OK, 1 row affected (0.00 sec)

mysql&gt; GRANT ALL PRIVILEGES ON wpdb.* TO wpuser@&apos;192.168.%.%&apos; IDENTIFIED BY &apos;wppass&apos;;;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; FLUSH PRIVILEGES;
Query OK, 0 rows affected (0.00 sec)
</code></pre><p>mysql&gt; </p>
<p>3)创建WordPress的配置文件</p>
<p>[root@WebServer wordpress]# pwd </p>
<p>/usr/local/apache/htdocs/wordpress</p>
<p>[root@WebServer wordpress]# cp wp-config-sample.php wp-config.php</p>
<p>4）更改 wp-config.php关于数据库的连接相关配置</p>
<p>[root@WebServer wordpress]# vim wp-config.php </p>
<p>define(‘DB_NAME’, ‘wpdb’);    # 填写数据库 </p>
<p>/*<em> MySQL数据库用户名 </em>/ </p>
<p>define(‘DB_USER’, ‘wpuser’);    # 填写数据库账号 </p>
<p>/*<em> MySQL数据库密码 </em>/ </p>
<p>define(‘DB_PASSWORD’, ‘wppass’);    # 填写密码 </p>
<p>/*<em> MySQL主机 </em>/ </p>
<p>define(‘DB_HOST’, ‘10.10.10.4’);    # 数据库所在的主机，本机也可以填写localhost</p>
<p>5）访问测试</p>
<p>有图有真相</p>
<p><img src="http://i.imgur.com/vDrgmqd.png" alt=""></p>
<p>##4、建立httpd服务器(基于编译的方式进行)，要求：</p>
<p>提供两个基于名称的虚拟主机</p>
<p><strong>前期工作</strong></p>
<p>建立相应目录，我一般都是放在/data，</p>
<pre><code>[root@lampw data]# mkdir -pv /data/web/vhost/{www1,www2}
mkdir: created directory `/data/web&apos;
mkdir: created directory `/data/web/vhost&apos;
mkdir: created directory `/data/web/vhost/www1&apos;
mkdir: created directory `/data/web/vhost/www2&apos;
</code></pre><p>vim /opt/apache24/conf/httpd.conf</p>
<directory><br>    AllowOverride none<br>   # Require all denied<br></directory>



<p><strong>(a)www1.stuX.com，页面文件目录为/web/vhosts/www1；错误日志为/var/log/httpd/www1.err，访问日志为/var/log/httpd/www1.access；</strong></p>
<pre><code>[root@lampw data]# mkdir -pv /data/web/vhost/{www1,www2}
mkdir: created directory `/data/web&apos;
mkdir: created directory `/data/web/vhost&apos;
mkdir: created directory `/data/web/vhost/www1&apos;
mkdir: created directory `/data/web/vhost/www2&apos;
</code></pre><p>vim /opt/apache24/conf/httpd.conf</p>
<pre><code>&lt;VirtualHost 192.168.0.248:80&gt;

        ServerName www1.stuX.com
        DocumentRoot &quot;/data/web/vhosts/www1&quot;
        ErrorLog /data/web/log/httpd/www1.err
        CustomLog /data/web/log/httpd/www1.access combined
        &lt;Directory &quot;/data/web/vhosts/www1&quot;&gt;
                Options None
                AllowOverride None
                Require all granted
        &lt;/Directory&gt;

        &lt;Location &quot;/server-status&quot;&gt;

               SetHandler server-status 

               Options None
                AllowOverride None
                AuthType Basic
                AuthName &quot;Adimin Realm,show something&quot;
                AuthUserFile &quot;/opt/apache24/conf/.htpasswd&quot;
                Require user jerry
        &lt;/Location&gt;
&lt;/VirtualHost&gt;
</code></pre><p><strong>(b)www2.stuX.com，页面文件目录为/web/vhosts/www2；错误日志为/var/log/httpd/www2.err，访问日志为/var/log/httpd/www2.access；</strong></p>
<pre><code>[root@lampw data]# mkdir -pv /data/web/vhost/{www1,www2}
mkdir: created directory `/data/web&apos;
mkdir: created directory `/data/web/vhost&apos;
mkdir: created directory `/data/web/vhost/www1&apos;
mkdir: created directory `/data/web/vhost/www2&apos;


[root@lampw data]# vim /opt/apache24/conf/httpd.conf

    &lt;VirtualHost 192.168.0.248:80&gt;
            ServerName www2.stuX.com
            DocumentRoot &quot;/data/web/vhosts/www2&quot;
            ErrorLog /data/web/log/httpd/www1.err
            CustomLog /data/web/log/httpd/www1.access combined
            &lt;Directory &quot;/data/web/vhosts/www2&quot;&gt;
                    Options None
                    AllowOverride None
                    Require all granted
            &lt;/Directory&gt;
    &lt;/VirtualHost&gt;
</code></pre><p><strong>(c)为两个虚拟主机建立各自的主页文件index.html，内容分别为其对应的主机名；</strong></p>
<pre><code>[root@lampw data]# vim /data/web/vhost/www1/index.html
[root@lampw data]# vim /data/web/vhost/www2/index.html
[root@lampw data]# cat /data/web/vhost/www1/index.html
&lt;h1&gt;www1.stuX.com&lt;/h1&gt;
[root@lampw data]# cat /data/web/vhost/www2/index.html
&lt;h1&gt;www2.stuX.com&lt;/h1&gt;
[root@lampw data]# 
</code></pre><p><strong>(d)通过www1.stuX.com/server-status输出httpd工作状态相关信息，且只允许提供帐号密码才能访问(status:status)；</strong></p>
<p>[root@lampw ~]# cd /opt/apache24/bin/</p>
<p>[root@lampw bin]# ./htpasswd -m -c /opt/apache24/conf/.htpasswd jerry</p>
<p>[root@lampw data]# vim /opt/apache24/conf/httpd.conf</p>
<pre><code>&lt;VirtualHost 192.168.0.248:80&gt;

        ServerName www1.stuX.com
        DocumentRoot &quot;/data/web/vhosts/www1&quot;
        ErrorLog /data/web/log/httpd/www1.err
        CustomLog /data/web/log/httpd/www1.access combined
        &lt;Directory &quot;/data/web/vhosts/www1&quot;&gt;
                Options None
                AllowOverride None
                Require all granted
        &lt;/Directory&gt;

        &lt;Location &quot;/server-status&quot;&gt;

               SetHandler server-status 

               Options None
                AllowOverride None
                AuthType Basic
                AuthName &quot;Adimin Realm,show something&quot;
                AuthUserFile &quot;/opt/apache24/conf/.htpasswd&quot;
                Require user jerry
        &lt;/Location&gt;
&lt;/VirtualHost&gt;
</code></pre><p>##5、为第4题中的第2个虚拟主机提供https服务，使得用户可以通过https安全的访问此web站点；</p>
<p>(1)要求使用证书认证，证书中要求使用的国家(CN)、州(HA)、城市(ZZ)和组织(MageEdu)；</p>
<p>(2)设置部门为Ops，主机名为www2.stuX.com，邮件为<a href="mailto:admin@stuX.com" target="_blank" rel="noopener">admin@stuX.com</a>；</p>
<p><strong>生成私钥</strong></p>
<pre><code>[root@lampw pki]# (umask 077; openssl genrsa -out /etc/pki/ca-trust/cakey.pem 8192)
Generating RSA private key, 8192 bit long modulus
...................................................................................................................++
........................................................................................................................................................................................................................................................++
e is 65537 (0x10001)
</code></pre><p><strong>生成自签证书</strong></p>
<pre><code>[root@lampw pki]# openssl req -new -x509 -key /etc/pki/ca-trust/cakey.pem -out /etc/pki/ca-trust/cacert.pem -days 3655
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &apos;.&apos;, the field will be left blank.
-----
Country Name (2 letter code) [AU]:CN  
State or Province Name (full name) [Some-State]:HA
Locality Name (eg, city) []:ZZ
Organization Name (eg, company) [Internet Widgits Pty Ltd]:MageEdu
Organizational Unit Name (eg, section) []:MageEdu
Common Name (e.g. server FQDN or YOUR name) []:www2.stuX.com
Email Address []:admin@stuX.com
[root@lampw pki]# 
</code></pre><p><strong>为CA提供所需的目录及文件</strong></p>
<pre><code>[root@lampw pki]# mkdir  -pv  /etc/pki/CA/{certs,crl,newcerts}
mkdir: created directory `/etc/pki/CA&apos;
mkdir: created directory `/etc/pki/CA/certs&apos;
mkdir: created directory `/etc/pki/CA/crl&apos;
mkdir: created directory `/etc/pki/CA/newcerts&apos;
[root@lampw pki]# touch  /etc/pki/CA/{serial,index.txt}
[root@lampw pki]# echo  01 &gt; /etc/pki/CA/serial
[root@lampw pki]# 
</code></pre><p><strong>用到证书的主机生成私钥</strong></p>
<pre><code>[root@lampw pki]# mkdir  -pv  /etc/pki/CA/{certs,crl,newcerts}
mkdir: created directory `/etc/pki/CA&apos;
mkdir: created directory `/etc/pki/CA/certs&apos;
mkdir: created directory `/etc/pki/CA/crl&apos;
mkdir: created directory `/etc/pki/CA/newcerts&apos;
[root@lampw pki]# touch  /etc/pki/CA/{serial,index.txt}
[root@lampw pki]# echo  01 &gt; /etc/pki/CA/serial
[root@lampw pki]#  mkdir -pv /opt/apache24/ssl
mkdir: created directory `/opt/apache24/ssl&apos;
[root@lampw pki]# cd /opt/apache24/ssl
[root@lampw ssl]# (umask  077; openssl  genrsa -out  /opt/apache24/ssl/httpd.key 8192)
Generating RSA private key, 8192 bit long modulus
.............................................................................................................++
....................................................++
e is 65537 (0x10001)
[root@lampw ssl]# 
</code></pre><p><strong>生成证书签署请求</strong></p>
<pre><code>[root@lampw ssl]# openssl  req  -new  -key  /opt/apache24/ssl/httpd.key  -out /opt/apache24/ssl/httpd.csr  -days  365
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &apos;.&apos;, the field will be left blank.
-----
Country Name (2 letter code) [AU]:CN
State or Province Name (full name) [Some-State]:HA
Locality Name (eg, city) []:ZZ
Organization Name (eg, company) [Internet Widgits Pty Ltd]:MageEdu
Organizational Unit Name (eg, section) []:MageEdu
Common Name (e.g. server FQDN or YOUR name) []:www2.stuX.com
Email Address []:admin@stuX.com

Please enter the following &apos;extra&apos; attributes
to be sent with your certificate request
A challenge password []:
An optional company name []:
</code></pre><p><strong>将请求通过可靠方式发送给CA主机，这次是在同一台机器，我就略过，如果是生产环境，估计就是要发给可信的证书签署机构</strong></p>
<p><strong>在CA主机上签署证书</strong></p>
<pre><code>[root@centos ssl]# openssl ca  -in  /etc/httpd/ssl/httpd.csr  -out  /etc/pki/CA/certs/httpd.crt  -days  365
Using configuration from /etc/pki/tls/openssl.cnf
Check that the request matches the signature
Signature ok
Certificate Details:
        Serial Number: 1 (0x1)
        Validity
            Not Before: Mar 22 03:49:48 2017 GMT
            Not After : Mar 22 03:49:48 2018 GMT
        Subject:
            countryName               = CN
            stateOrProvinceName       = HA
            organizationName          = MageEdu
            organizationalUnitName    = ops
            commonName                = www2.stuX.com
            emailAddress              = admin@stuX.com
        X509v3 extensions:
            X509v3 Basic Constraints: 
                CA:FALSE
            Netscape Comment: 
                OpenSSL Generated Certificate
            X509v3 Subject Key Identifier: 
                EC:C4:48:10:BE:BD:1D:D2:48:38:17:B7:FD:0D:57:DE:51:B1:8F:64
            X509v3 Authority Key Identifier: 
                keyid:ED:42:A1:59:88:A2:45:0A:F2:64:46:A6:BA:C9:7A:5D:E3:9C:FB:AE

Certificate is to be certified until Mar 22 03:49:48 2018 GMT (365 days)
Sign the certificate? [y/n]:y


1 out of 1 certificate requests certified, commit? [y/n]y
Write out database with 1 new entries
Data Base Updated
[root@centos ssl]# 
</code></pre><p>ssl]# ls /etc/pki/CA/certs/httpd.crt</p>
<p>/etc/pki/CA/certs/httpd.crt</p>
<p>ssl]# cp /etc/pki/CA/certs/httpd.crt /etc/httpd24/ssl/</p>
<p>ssl]# ls</p>
<p>httpd.crt  httpd.csr  httpd.key</p>
<p>2、修改配置文件提供ssl服务</p>
<p>开启主配置文件的ssl调用，删除www2在httpd-vhosts中的定义</p>
<p>Include /etc/httpd24/extra/httpd-ssl.conf</p>
<p>~]# vim /etc/httpd24/extra/httpd-ssl.conf</p>
<p>[root@localhost httpd24]# cat extra/httpd-ssl.conf | grep -v “^#”</p>
<p>Listen 443</p>
<p>SSLPassPhraseDialog  builtin</p>
<virtualhost 192.168.150.136:443=""><br><br>DocumentRoot “/web/vhost/www2”<br><br>ServerName www2.stuX.com:443<br><br>ServerAdmin <a href="mailto:you@example.com" target="_blank" rel="noopener">you@example.com</a><br><br>ErrorLog “/var/log/httpd/www2.err”<br><br>TransferLog “/usr/local/apache24/logs/access_log”<br><br>SSLEngine on<br><br>SSLCertificateFile “/etc/httpd24/ssl/httpd.crt”<br><br>SSLCertificateKeyFile “/etc/httpd24/ssl/httpd.key”<br><br><directory "="" web="" vhost="" www2"=""><br><br> AllowOverride None<br><br>    Options None<br><br>    Require all granted<br><br></directory><br><br></virtualhost>             

<p>主配置文件中启用ssl模块</p>
<p>~]# vim /etc/httpd24/httpd.conf</p>
<p>LoadModule ssl_module modules/mod_ssl.so</p>
<p>重启httpd服务后测试</p>
<p>httpd24]# ss -tnl | grep 443</p>
<p>LISTEN     0      128                      :::443                     :::*     </p>
<p>##6、在LAMP架构中，请分别以php编译成httpd模块形式和php以fpm工作为独立守护进程的方式来支持httpd，列出详细的过程。</p>
<p><strong>php编译成httpd模块形式</strong></p>
<p>参阅第三题第九步</p>
<p><strong>php以fpm工作为独立守护进程的方式来支持httpd</strong></p>
<p>./configure –prefix=/opt/php5-fpm \<br>–with-mysql=mysqlnd \<br>–with-openssl \<br>–with-mysqli=mysqlnd \<br>–enable-mbstring \<br>–with-freetype-dir \<br>–with-jpeg-dir \<br>–with-png-dir \<br>–with-zlib \<br>–with-libxml-dir=/usr \<br>–enable-xml \<br>–enable-sockets \<br>–enable-fpm \<br>–with-mcrypt \<br>–with-config-file-path=/opt/php5-fpm/conf \<br>–with-config-file-scan-dir=/opt/php5-fpm/conf.d \<br>–with-bz2</p>
<p>添加了–enable-fpm选项 ，这是重点啊，各位记住。</p>
<p>make &amp;&amp; make install</p>
<p>拷贝配置文件至/opt/php5-fpm/conf目录</p>
<p>php-5.4.26]# cp php.ini-production /etc/php.ini</p>
<p>拷贝php-fpm配置文件，并同时取消pid选项的注释</p>
<p>cp /usr/local/php5/etc/php-fpm.conf.default  /usr/local/php5/etc/php-fpm.conf</p>
<p>php-5.4.26]# vim /usr/local/php5/etc/php-fpm.conf</p>
<p>pid = /usr/local/php5/var/run/php-fpm.pid</p>
<p>添加服务脚本</p>
<p>fpm]# pwd</p>
<p>/root/php-5.4.26/sapi/fpm</p>
<p>fpm]# cp init.d.php-fpm /etc/rc.d/init.d/php-fp</p>
<p>~]# chmod +x /etc/rc.d/init.d/php-fpm</p>
<p>~]# chkconfig –add php-fpm</p>
<p>启动php-fpm</p>
<p>~]# service php-fpm start</p>
<p>配置httpd</p>
<p>~]# vim /etc/httpd24/httpd.conf</p>
<p>启用这两个模块</p>
<p>LoadModule proxy_module modules/mod_proxy.so</p>
<p>LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so</p>
<p>添加文件类型</p>
<p>AddType application/x-httpd-php .php</p>
<p>AddType application/x-httpd-php-source .phps</p>
<p>添加php文件的访问通过fpm</p>
<p>ProxyRequests Off</p>
<p>ProxyPassMatch ^/(.*.php)$ fcgi://127.0.0.1:9000/usr/local/apache24/htdocs/$1</p>
<p>找到 DirectoryIndex index.html</p>
<p>改为</p>
<p>DirectoryIndex index.php index.html</p>
<p>编辑php测试页并开启httpd进行测试</p>
<p>php-5.4.26]# cd /usr/local/apache24/htdocs/</p>
<p>htdocs]# vim index.php</p>
<pre><code>&lt;h1&gt;phpfpmtest&lt;/h1&gt;

&lt;?php

    phpinfo();

?&gt;
</code></pre><p>[root@localhost htdocs]# apachectl start</p>
<p>AH00558: httpd: Could not reliably determine the server’s fully qualified domain name, using localhost.</p>
<p>localdomain. Set the ‘ServerName’ directive globally to suppress this</p>
<p>[root@localhost htdocs]# ss -tnl     httpd 80 php-fpm 9000</p>
<p>State       Recv-Q Send-Q                   Local Address:Port                     Peer Address:Port</p>
<p>LISTEN      0      128                                 :::80                                 :::*     </p>
<p>LISTEN      0      128                                 :::22                                 :::*     </p>
<p>LISTEN      0      128                                  <em>:22                                  </em>:*     </p>
<p>LISTEN      0      100                                ::1:25                                 :::*     </p>
<p>LISTEN      0      100                          127.0.0.1:25                                  <em>:</em>     </p>
<p>LISTEN      0      128                          127.0.0.1:6010                                <em>:</em>     </p>
<p>LISTEN      0      128                                ::1:6010                               :::*     </p>
<p>LISTEN      0      128                          127.0.0.1:6011                                <em>:</em>     </p>
<p>LISTEN      0      128                                ::1:6011                               :::*     </p>
<p>LISTEN      0      128                          127.0.0.1:9000                                <em>:</em></p>
<p>此时的Server API为FPM/FastCGI</p>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2018/06/04/第十二周作业/"></a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Jerry</a></p>
        <p><span>发布时间:</span>2018-06-04, 16:29:45</p>
        <p><span>最后更新:</span>2018-06-04, 16:29:45</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2018/06/04/第十二周作业/" title="">https://zhusas/github.io/2018/06/04/第十二周作业/</a>
            <span class="copy-path" data-clipboard-text="原文: https://zhusas/github.io/2018/06/04/第十二周作业/　　作者: Jerry" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/2018/06/04/第十六周作业/">
                    
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2018/06/04/第十八周作业/">
                    
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#vim-opt-apache24-conf-httpd-conf"><span class="toc-number">1.</span> <span class="toc-text">vim /opt/apache24/conf/httpd.conf</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"　| Jerry's Blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    




    <div class="scroll" id="post-nav-button">
        
            <a href="/2018/06/04/第十六周作业/" title="上一篇: ">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2018/06/04/第十八周作业/" title="下一篇: ">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第一周作业/">第一周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第五周作业/">第五周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第四周作业/">第四周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第十周作业/">第十周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第十一周作业/">第十一周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第十五周作业/">第十五周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第十四周作业/">第十四周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第十三周作业/">第十三周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第十六周作业/">第十六周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第十二周作业/">第十二周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第十八周作业/">第十八周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第三周作业/">第三周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第七周作业/">第七周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第六周作业/">第六周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第九周作业/">第九周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第二周作业/">第二周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/第八周作业/">第八周作业</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/04/test1/">test1</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/05/31/hello-world/">Hello World</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2018 Jerry
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>