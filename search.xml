<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>vsftp文件共享服务</title>
      <link href="/2018/08/06/vsftp%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/"/>
      <url>/2018/08/06/vsftp%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB%E6%9C%8D%E5%8A%A1/</url>
      <content type="html"><![CDATA[<p>1)基于虚拟用户的访问形式</p><p>2)匿名用户只允许下载，不允许上传</p><p>3)禁锢所有的用户于其家目录当中</p><p>4)限制最大并发连接数为200</p><p>5)匿名用户的最大传输速率512KB/s</p><p>6)虚拟用户的账号存储在mysql数据库当中</p><p>7)数据库通过NFS进行共享</p><p><strong>先科(zhuang)普(bi)</strong></p><p>我们登录FTP有三种方式，匿名登录、本地用户登录和虚拟用户登录。 <a id="more"></a></p><p>匿名登录：在登录FTP时使用默认的用户名，一般是ftp或anonymous。</p><p>本地用户登录：使用系统用户登录，在/etc/passwd中。</p><p>虚拟用户登录：这是FTP专有用户，有两种方式实现虚拟用户，本地数据文件和数据库服务器。</p><p>FTP虚拟用户是FTP服务器的专有用户，使用虚拟用户登录FTP，只能访问FTP服务器提供的资源，大大增强了系统的安全。</p><p><img src="http://i.imgur.com/pNs4Zu2.jpg" alt=""></p><p><strong>测试环境</strong></p><p>NFS&amp;MySQL服务器          192.168.0.248</p><p>vsftp 服务器 192.168.0.235</p><p><strong>一、通过NFS服务器共享数据库</strong></p><p>1、在192.168.0.248服务器上启动nfs服务，设置共享目录为/nfs_data</p><p>[root@CentOS6 ~]# mkdir -pv  /nfs_data<br>mkdir: created directory `/nfs_data’</p><p>2、安装组件</p><p>yum install rpcbind nfs-server  nfs-lock nfs-idmap</p><p>3、启动nfs服务</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]# systemctl start nfs-server.service</span><br><span class="line">[root@CentOS7 ~]# systemctl status nfs-server.service </span><br><span class="line">● nfs-server.service - NFS server and services</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/nfs-server.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (exited) since 五 2017-03-24 16:38:33 CST; 1 day 7h ago</span><br><span class="line"> Main PID: 37384 (code=exited, status=0/SUCCESS)</span><br><span class="line">   CGroup: /system.slice/nfs-server.service</span><br><span class="line"></span><br><span class="line">3月 24 16:38:33 CentOS7 systemd[1]: Starting NFS server and services...</span><br><span class="line">3月 24 16:38:33 CentOS7 systemd[1]: Started NFS server and services.</span><br><span class="line">[root@CentOS7 ~]#</span><br></pre></td></tr></table></figure><p>4、编辑 vim  /etc/exports</p><p> 添加一下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/nfs_data 192.168.0.0/24(rw,no_root_squash,sync)</span><br></pre></td></tr></table></figure><p> exportfs -r 一下使其生效</p><p>注：配置文件说明：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/nfs_data为共享目录</span><br><span class="line"></span><br><span class="line">192.168.0.0/24  可以为一个网段，一个IP，也可以是域名，域名支持通配符 如: *.qq.com</span><br><span class="line"></span><br><span class="line">rw：read-write，可读写；</span><br><span class="line"></span><br><span class="line">ro：read-only，只读；</span><br><span class="line"></span><br><span class="line">sync：文件同时写入硬盘和内存；</span><br><span class="line"></span><br><span class="line">async：文件暂存于内存，而不是直接写入内存；</span><br><span class="line"></span><br><span class="line">no_root_squash：NFS客户端连接服务端时如果使用的是:root的话，那么对服务端分享的目录来说，也拥有root权限。显然开启这项是不安全的。</span><br><span class="line"></span><br><span class="line">root_squash：NFS客户端连接服务端时如果使用的是root的话，那么对服务端分享的目录来说，拥有匿名用户权限，通常他将使用nobody或nfsnobody身份；</span><br><span class="line"></span><br><span class="line">all_squash：不论NFS客户端连接服务端时使用什么用户，对服务端分享的目录来说都是拥有匿名用户权限；</span><br></pre></td></tr></table></figure><p><strong>二、vsftp mysql 服务器挂载nfs</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS6 ~]# showmount -e 192.168.0.235</span><br><span class="line">Export list for 192.168.0.235:</span><br><span class="line">/nfs_data 192.168.0.0/24</span><br><span class="line"></span><br><span class="line">[root@CentOS6 ~]# mount -t nfs 192.168.0.235:/nfs_data /nfs_data</span><br><span class="line"></span><br><span class="line">[root@CentOS6 ~]# df -h</span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/vg_centos6-lv_root</span><br><span class="line">                       18G  3.3G   13G  21% /</span><br><span class="line">tmpfs                 3.9G     0  3.9G   0% /dev/shm</span><br><span class="line">/dev/sda1             477M   69M  383M  16% /boot</span><br><span class="line">192.168.0.235:/nfs_data</span><br><span class="line">                       17G  6.9G   11G  41% /nfs_data</span><br></pre></td></tr></table></figure><p>客户端在挂载的时候遇到的一个问题如下，可能是网络不太稳定，NFS默认是用UDP协议，换成TCP协议即可</p><p>mount -t nfs 192.168.0.235:/nfs_data /nfs_data -o proto=tcp -o nolock</p><p>在客户端写入一个有内容的文件测试，嘿嘿，服务端马上看到了，欧耶<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**vsftp mysql 服务器 192.168.0.235安装MySQL/MariaDB**</span><br><span class="line"></span><br><span class="line">这里我就直接yum安装MariaDB了</span><br><span class="line"></span><br><span class="line">yum install mariadb-server.x86_64 mariadb-devel.x86_64 openssl-devel.x86_64</span><br><span class="line">systemctl start mariadb.service </span><br><span class="line">systemctl enable mariadb.service </span><br><span class="line"></span><br><span class="line">**安装PAM-MySQL，要跟vsftp安装在同一台机器上**</span><br><span class="line"></span><br><span class="line">下载源码包，加压</span><br><span class="line"></span><br><span class="line">安装前再次确认依赖包</span><br><span class="line"></span><br><span class="line">yum install pam-devel openssl-devel mariadb-devel</span><br><span class="line"></span><br><span class="line">**CentOS7**</span><br><span class="line">./configure --with-mysql=/usr --with-openssl --with-pam=/usr --with-pam-mods-dir=/usr/lib64/security</span><br><span class="line"></span><br><span class="line">**CentOS6**</span><br><span class="line">./configure --with-mysql=/usr --with-openssl --with-pam=/usr --with-pam-mods-dir=/lib64/security/</span><br><span class="line"></span><br><span class="line">make -j 4 &amp;&amp; make install</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**配置数据库，创建vsftpd的库和表**</span><br><span class="line"></span><br><span class="line">```mysql</span><br><span class="line">[root@CentOS7 pam_mysql-0.7RC1]# mysql</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 3</span><br><span class="line">Server version: 5.5.52-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; create database vsftpd;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| test               |</span><br><span class="line">| vsftpd             |</span><br><span class="line">+--------------------+</span><br><span class="line">5 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; use vsftpd;</span><br><span class="line">Database changed</span><br><span class="line">MariaDB [vsftpd]&gt; create table users (</span><br><span class="line">    -&gt; id int auto_increment not null primary key,</span><br><span class="line">    -&gt; name char(30) not null,</span><br><span class="line">    -&gt; password char(48) binary not null );</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [vsftpd]&gt; desc users;</span><br><span class="line">+----------+----------+------+-----+---------+----------------+</span><br><span class="line">| Field    | Type     | Null | Key | Default | Extra          |</span><br><span class="line">+----------+----------+------+-----+---------+----------------+</span><br><span class="line">| id       | int(11)  | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| name     | char(30) | NO   |     | NULL    |                |</span><br><span class="line">| password | char(48) | NO   |     | NULL    |                |</span><br><span class="line">+----------+----------+------+-----+---------+----------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [vsftpd]&gt; insert into users(name,password) values (&apos;jerry&apos;,password(&apos;mageedu&apos;));</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [vsftpd]&gt; insert into users(name,password) values (&apos;tom&apos;,password(&apos;mageedu111&apos;));</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [vsftpd]&gt; select * from users;</span><br><span class="line">+----+-------+-------------------------------------------+</span><br><span class="line">| id | name  | password                                  |</span><br><span class="line">+----+-------+-------------------------------------------+</span><br><span class="line">|  1 | jerry | *9A94EE7D14C10908118B62D2DA88E6932E11E438 |</span><br><span class="line">|  2 | tom   | *67CF267D9D554496768C605C2D66754EAE874C12 |</span><br><span class="line">+----+-------+-------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [vsftpd]&gt; </span><br><span class="line"></span><br><span class="line">#我这边vsftpd跟mysql不是同一台机器，所以开启远程授权    </span><br><span class="line">MariaDB [mysql]&gt; grant select on vsftpd.* to vsftpd@&apos;192.168.0.248&apos; identified by &apos;mageedu&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [mysql]&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">[root@CentOS7 pam_mysql-0.7RC1]# mysql -uvsftpd -pmageedu</span><br><span class="line">Welcome to the MariaDB monitor.  Commands end with ; or \g.</span><br><span class="line">Your MariaDB connection id is 14</span><br><span class="line">Server version: 5.5.52-MariaDB MariaDB Server</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.</span><br><span class="line"></span><br><span class="line">Type &apos;help;&apos; or &apos;\h&apos; for help. Type &apos;\c&apos; to clear the current input statement.</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| test               |</span><br><span class="line">| vsftpd             |</span><br><span class="line">+--------------------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [(none)]&gt; use vsftpd;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">MariaDB [vsftpd]&gt; select * from users;</span><br><span class="line">+----+-------+-------------------------------------------+</span><br><span class="line">| id | name  | password                                  |</span><br><span class="line">+----+-------+-------------------------------------------+</span><br><span class="line">|  1 | jerry | *9A94EE7D14C10908118B62D2DA88E6932E11E438 |</span><br><span class="line">|  2 | tom   | *67CF267D9D554496768C605C2D66754EAE874C12 |</span><br><span class="line">+----+-------+-------------------------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">MariaDB [vsftpd]&gt; exit</span><br><span class="line">Bye</span><br><span class="line">[root@CentOS7 pam_mysql-0.7RC1]# </span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">**迁移MariaDB的数据库默认数据存放目录，放到/nfs_data/目录中，形成NFS共享**</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">[root@CentOS7 /]# systemctl stop mariadb.service </span><br><span class="line"></span><br><span class="line">[root@CentOS7 /]# cp -r /var/lib/mysql/ /nfs_data/</span><br><span class="line"></span><br><span class="line">[root@CentOS7 /]#vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line">修改成：datadir=/nfs_data/mysql</span><br><span class="line"></span><br><span class="line">[root@CentOS7 /]#cd /nfs_data/</span><br><span class="line"></span><br><span class="line">[root@CentOS7 /]# chown -R mysql:mysql mysql/</span><br><span class="line"></span><br><span class="line">[root@CentOS7 /]#systemctl start mariadb.service </span><br><span class="line"></span><br><span class="line">[root@CentOS7 /]#systemctl status mariadb.service</span><br><span class="line"></span><br><span class="line">● mariadb.service - MariaDB database server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/mariadb.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 日 2017-03-26 15:16:34 CST; 18min ago</span><br><span class="line">  Process: 94278 ExecStartPost=/usr/libexec/mariadb-wait-ready $MAINPID (code=exited, status=0/SUCCESS)</span><br><span class="line">  Process: 94247 ExecStartPre=/usr/libexec/mariadb-prepare-db-dir %n (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 94277 (mysqld_safe)</span><br><span class="line">   CGroup: /system.slice/mariadb.service</span><br><span class="line">           ├─94277 /bin/sh /usr/bin/mysqld_safe --basedir=/usr</span><br><span class="line">           └─94435 /usr/libexec/mysqld --basedir=/usr --datadir=/nfs_data...</span><br><span class="line"></span><br><span class="line">3月 26 15:16:32 CentOS7 systemd[1]: Starting MariaDB database server...</span><br><span class="line">3月 26 15:16:32 CentOS7 mysqld_safe[94277]: 170326 15:16:32 mysqld_safe....</span><br><span class="line">3月 26 15:16:32 CentOS7 mysqld_safe[94277]: 170326 15:16:32 mysqld_safe...l</span><br><span class="line">3月 26 15:16:34 CentOS7 systemd[1]: Started MariaDB database server.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">这时候，两边机器的NFS目录都看看，OK啦</span><br></pre></td></tr></table></figure></p><p><strong>安装vsftpd</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS6 mysql]# yum install vsftpd</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Setting up Install Process</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * epel: mirrors.tuna.tsinghua.edu.cn</span><br><span class="line"> * extras: mirrors.aliyun.com</span><br><span class="line"> * updates: mirrors.aliyun.com</span><br><span class="line">Resolving Dependencies</span><br><span class="line">--&gt; Running transaction check</span><br><span class="line">---&gt; Package vsftpd.x86_64 0:2.2.2-21.el6 will be installed</span><br><span class="line">--&gt; Finished Dependency Resolution</span><br><span class="line"></span><br><span class="line">Dependencies Resolved</span><br><span class="line"></span><br><span class="line">============================================================================</span><br><span class="line"> Package         Arch            Version                Repository     Size</span><br><span class="line">============================================================================</span><br><span class="line">Installing:</span><br><span class="line"> vsftpd          x86_64          2.2.2-21.el6           base          155 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">============================================================================</span><br><span class="line">Install       1 Package(s)</span><br><span class="line"></span><br><span class="line">Total download size: 155 k</span><br><span class="line">Installed size: 340 k</span><br><span class="line">Is this ok [y/N]: y</span><br><span class="line">Downloading Packages:</span><br><span class="line">vsftpd-2.2.2-21.el6.x86_64.rpm                       | 155 kB     00:00     </span><br><span class="line">Running rpm_check_debug</span><br><span class="line">Running Transaction Test</span><br><span class="line">Transaction Test Succeeded</span><br><span class="line">Running Transaction</span><br><span class="line">  Installing : vsftpd-2.2.2-21.el6.x86_64                               1/1 </span><br><span class="line">  Verifying  : vsftpd-2.2.2-21.el6.x86_64                               1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  vsftpd.x86_64 0:2.2.2-21.el6                                              </span><br><span class="line"></span><br><span class="line">Complete!</span><br></pre></td></tr></table></figure><p><strong>配置vsftpd的pam文件</strong></p><p>[root@CentOS6 ~]# vim /etc/pam.d/vsftpd.mysql</p><p>输入以下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auth required pam_mysql.so user=vsftpd passwd=mageedu host=192.168.0.235 db=vsftpd table=users usercolumn=name passwdcolumn=password crypt=2</span><br><span class="line"></span><br><span class="line">account required pam_mysql.so user=vsftpd passwd=mageedu host=192.168.0.235 db=vsftpd table=users usercolumn=name passwdcolumn=password crypt=2</span><br></pre></td></tr></table></figure><p><strong>创建系统用户</strong></p><p>因为虚拟用户最终要映射为系统用户，所以得创建用于vsftpd映射使用滴用户啦。。。。。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS6 ~]# mkdir -pv /ftproot</span><br><span class="line">mkdir: created directory `/ftproot&apos;</span><br><span class="line"></span><br><span class="line">[root@CentOS6 /]# useradd -s /sbin/nologin -d /ftproot vuser</span><br></pre></td></tr></table></figure><p><strong>确保vuser的家目录其他用户能读能执行</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS6 /]# ll |grep ftproot/</span><br><span class="line">[root@CentOS6 /]# ll |grep ftpr</span><br><span class="line">drwx------    3 vuser vuser  4096 Mar 27 13:59 ftproot</span><br><span class="line">[root@CentOS6 /]# chmod +rx -R /ftproot/</span><br><span class="line">[root@CentOS6 /]# ll |grep ftpr</span><br><span class="line">drwxr-xr-x    3 vuser vuser  4096 Mar 27 13:59 ftproot</span><br><span class="line">[root@CentOS6 /]#</span><br></pre></td></tr></table></figure><p><strong>配置/etc/vsftpd/vsftpd.conf</strong></p><p>vim /etc/vsftpd/vsftpd.conf </p><p>修改 pam_service_name=vsftpd.mysql</p><p><strong>匿名用户只允许下载，不允许上传</strong></p><p>vim /etc/vsftpd/vsftpd.conf </p><p>anonymous_enable=YES  #允许匿名账户登录</p><p>anon_upload_enable=NO #不允许匿名用户上传文件</p><p><strong>禁锢所有的用户于其家目录当中</strong></p><p>chroot_local_user=YES #禁锢本地账户的家目录</p><p><strong>限制最大并发连接数为200</strong></p><p>max_clients=200 #最大允许的客户端连接数</p><p><strong>匿名用户的最大传输速率512KB/s</strong></p><p>local_max_rate=512000</p><p>写入配置文件后，重启vsftp服务即可。</p>]]></content>
      
      
        <tags>
            
            <tag> vsftp </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>建立samba共享</title>
      <link href="/2018/08/06/%E5%BB%BA%E7%AB%8Bsamba%E5%85%B1%E4%BA%AB/"/>
      <url>/2018/08/06/%E5%BB%BA%E7%AB%8Bsamba%E5%85%B1%E4%BA%AB/</url>
      <content type="html"><![CDATA[<p>数据目录为 /data     </p><p><strong>1）共享名为shared，工作组为whmall</strong></p><p>vim /etc/samba/smb.conf <a id="more"></a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">修改</span><br><span class="line">workgroup = MYGROUP</span><br><span class="line">为</span><br><span class="line">workgroup = whmall</span><br><span class="line"></span><br><span class="line">修改</span><br><span class="line">passdb backend = tdbsam</span><br><span class="line">为</span><br><span class="line">    passdb backend = smbpasswd</span><br><span class="line">    smb passwd file = /etc/samba/smbpasswd</span><br></pre></td></tr></table></figure><p><strong>2)添加组develop，添加用户gentoo,centos和ubuntu，其中gentoo和centos以develop为附加组，ubuntu不属于develop组；密码均为用户名</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 samba]<span class="comment"># groupadd develop</span></span><br><span class="line">[root@CentOS7 samba]<span class="comment"># useradd -G develop gentoo</span></span><br><span class="line">[root@CentOS7 samba]<span class="comment"># useradd -G develop centos</span></span><br><span class="line">[root@CentOS7 samba]<span class="comment"># useradd ubuntu</span></span><br><span class="line">[root@CentOS7 samba]<span class="comment">#  echo "gentoo"|  passwd --stdin gentoo</span></span><br><span class="line">更改用户 gentoo 的密码 。</span><br><span class="line">passwd：所有的身份验证令牌已经成功更新。</span><br><span class="line">[root@CentOS7 samba]<span class="comment"># echo "centos"|  passwd --stdin centos</span></span><br><span class="line">更改用户 centos 的密码 。</span><br><span class="line">passwd：所有的身份验证令牌已经成功更新。</span><br><span class="line">[root@CentOS7 samba]<span class="comment"># echo "ubuntu"|  passwd --stdin ubuntu</span></span><br></pre></td></tr></table></figure><p><strong>3)添加samba用户gentoo,centos和ubuntu，密码均为“111111”</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 samba]<span class="comment">#  smbpasswd -a gentoo</span></span><br><span class="line">New SMB password:</span><br><span class="line">Retype new SMB password:</span><br><span class="line">startsmbfilepwent_internal: file /etc/samba/smbpasswd did not exist. File successfully created.</span><br><span class="line">Added user gentoo.</span><br><span class="line">[root@CentOS7 samba]<span class="comment">#  smbpasswd -a centos</span></span><br><span class="line">New SMB password:</span><br><span class="line">Retype new SMB password:</span><br><span class="line">Added user centos.</span><br><span class="line">[root@CentOS7 samba]<span class="comment">#  smbpasswd -a ubuntu</span></span><br><span class="line">New SMB password:</span><br><span class="line">Retype new SMB password:</span><br><span class="line">Added user ubuntu.</span><br><span class="line">[root@CentOS7 samba]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><strong>4)此samba共享shared仅允许develop组具有写权限，其他用户只能以只读方式访问</strong></p><p>vim smb.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">末尾添加</span><br><span class="line">[shared]</span><br><span class="line">comment = whmall.com</span><br><span class="line">path = /data</span><br><span class="line">guest = yes </span><br><span class="line">writable = no</span><br><span class="line">write list = +develop</span><br></pre></td></tr></table></figure><p><strong>5)此samba共享服务仅允许来自于172.16.0.0/16网络的主机访问； </strong></p><p>vim smb.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">添加 </span><br><span class="line">hosts allow = 172.16.0.0/16</span><br></pre></td></tr></table></figure><p>启动samba服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 samba]<span class="comment"># systemctl start smb.service</span></span><br><span class="line">[root@CentOS7 samba]<span class="comment"># systemctl status smb.service</span></span><br><span class="line">● smb.service - Samba SMB Daemon</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/smb.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 四 2017-03-23 14:39:18 CST; 5s ago</span><br><span class="line"> Main PID: 101560 (smbd)</span><br><span class="line">   Status: <span class="string">"smbd: ready to serve connections..."</span></span><br><span class="line">   CGroup: /system.slice/smb.service</span><br><span class="line">           ├─101560 /usr/sbin/smbd</span><br><span class="line">           ├─101561 /usr/sbin/smbd</span><br><span class="line">           ├─101562 /usr/sbin/smbd</span><br><span class="line">           └─101563 /usr/sbin/smbd</span><br><span class="line"></span><br><span class="line">3月 23 14:39:18 CentOS7 systemd[1]: Starting Samba SMB Daemon...</span><br><span class="line">3月 23 14:39:18 CentOS7 smbd[101557]: [2017/03/23 14:39:18.773050,  0] .....)</span><br><span class="line">3月 23 14:39:18 CentOS7 smbd[101557]:   Unknown parameter encountered: <span class="string">"g..."</span></span><br><span class="line">3月 23 14:39:18 CentOS7 smbd[101557]: [2017/03/23 14:39:18.773117,  0] .....)</span><br><span class="line">3月 23 14:39:18 CentOS7 smbd[101557]:   Ignoring unknown parameter <span class="string">"guest"</span></span><br><span class="line">3月 23 14:39:18 CentOS7 systemd[1]: smb.service: Supervising process 101...s.</span><br><span class="line">3月 23 14:39:18 CentOS7 smbd[101560]: [2017/03/23 14:39:18.787425,  0] .....)</span><br><span class="line">3月 23 14:39:18 CentOS7 smbd[101560]:   STATUS=daemon <span class="string">'smbd'</span> finished sta...s</span><br><span class="line">3月 23 14:39:18 CentOS7 systemd[1]: Started Samba SMB Daemon.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show <span class="keyword">in</span> full.</span><br></pre></td></tr></table></figure><p><strong>PS： CentOS7最好关闭防火墙，还有SELinux</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@CentOS7 ~]<span class="comment"># systemctl list-unit-files |grep fire</span></span><br><span class="line">firewalld.service                             enabled </span><br><span class="line">[root@CentOS7 ~]<span class="comment"># systemctl stop firewalld.service </span></span><br><span class="line">[root@CentOS7 ~]<span class="comment"># systemctl disable firewalld.service </span></span><br><span class="line">Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</span><br><span class="line">Removed symlink /etc/systemd/system/basic.target.wants/firewalld.service.</span><br></pre></td></tr></table></figure><p><strong>亲测OK，有图有真相</strong></p><p>PS:这里我把hosts allow = 172.16.0.0/16  改为了hosts allow = 192.168.0.0/24</p><p>workgroup 改为WORKGROUP</p><p>这样就看到了，欧耶~</p><p><img src="http://i.imgur.com/F4LHTsz.png" alt=""></p>]]></content>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> samba </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>php编译成httpd模块形式和php以fpm工作为独立守护进程的方式来支持httpd详细过程</title>
      <link href="/2018/08/06/php%E7%BC%96%E8%AF%91%E6%88%90httpd%E6%A8%A1%E5%9D%97%E5%BD%A2%E5%BC%8F%E5%92%8Cphp%E4%BB%A5fpm%E5%B7%A5%E4%BD%9C%E4%B8%BA%E7%8B%AC%E7%AB%8B%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9D%A5%E6%94%AF%E6%8C%81httpd%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B/"/>
      <url>/2018/08/06/php%E7%BC%96%E8%AF%91%E6%88%90httpd%E6%A8%A1%E5%9D%97%E5%BD%A2%E5%BC%8F%E5%92%8Cphp%E4%BB%A5fpm%E5%B7%A5%E4%BD%9C%E4%B8%BA%E7%8B%AC%E7%AB%8B%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9D%A5%E6%94%AF%E6%8C%81httpd%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B/</url>
      <content type="html"><![CDATA[<p><strong>php编译成httpd模块形式</strong>   <a id="more"></a></p><p>略。。。。。。</p><p><strong>php以fpm工作为独立守护进程的方式来支持httpd</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">./configure –prefix=/opt/php5-fpm \</span><br><span class="line">–with-mysql=mysqlnd \</span><br><span class="line">–with-openssl \</span><br><span class="line">–with-mysqli=mysqlnd \</span><br><span class="line">–enable-mbstring \</span><br><span class="line">–with-freetype-dir \</span><br><span class="line">–with-jpeg-dir \ </span><br><span class="line">–with-png-dir \</span><br><span class="line">–with-zlib \</span><br><span class="line">–with-libxml-dir=/usr \</span><br><span class="line">–enable-xml \</span><br><span class="line">–enable-sockets \</span><br><span class="line">–enable-fpm \</span><br><span class="line">–with-mcrypt \</span><br><span class="line">–with-config-file-path=/opt/php5-fpm/conf \</span><br><span class="line">–with-config-file-scan-dir=/opt/php5-fpm/conf.d \</span><br><span class="line">–with-bz2</span><br></pre></td></tr></table></figure><p>添加了–enable-fpm选项 ，这是重点啊，各位记住。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>拷贝配置文件至/opt/php5-fpm/conf目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp php.ini-production /etc/php.ini</span><br></pre></td></tr></table></figure><p>拷贝php-fpm配置文件，并同时取消pid选项的注释</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/<span class="built_in">local</span>/php5/etc/php-fpm.conf.default  /usr/<span class="built_in">local</span>/php5/etc/php-fpm.conf</span><br><span class="line">vim /usr/<span class="built_in">local</span>/php5/etc/php-fpm.conf</span><br><span class="line">pid = /usr/<span class="built_in">local</span>/php5/var/run/php-fpm.pid</span><br></pre></td></tr></table></figure><p><strong>添加服务脚本</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#进入源码目录，拷贝开机启动服务文件</span></span><br><span class="line">cp init.d.php-fpm /etc/rc.d/init.d/php-fp</span><br><span class="line"></span><br><span class="line"><span class="comment">#加上执行属性</span></span><br><span class="line">chmod +x /etc/rc.d/init.d/php-fpm</span><br><span class="line"></span><br><span class="line"><span class="comment">#加入到开机启动服务</span></span><br><span class="line">chkconfig –add php-fpm</span><br></pre></td></tr></table></figure><p><strong>启动php-fpm</strong></p><p> service php-fpm start</p><p><strong>配置httpd</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># vim /etc/httpd24/httpd.conf</span><br><span class="line"></span><br><span class="line">#启用这两个模块:</span><br><span class="line"></span><br><span class="line">LoadModule proxy_module modules/mod_proxy.so</span><br><span class="line"></span><br><span class="line">LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so</span><br></pre></td></tr></table></figure><p><strong>添加文件类型</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加文件类型</span></span><br><span class="line">AddType application/x-httpd-php .php</span><br><span class="line">AddType application/x-httpd-php-source .phps</span><br><span class="line"></span><br><span class="line">添加php文件的访问通过fpm</span><br><span class="line">ProxyRequests Off</span><br><span class="line">ProxyPassMatch ^/(.*.php)$ fcgi://127.0.0.1:9000/usr/<span class="built_in">local</span>/apache24/htdocs/<span class="variable">$1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">找到 DirectoryIndex index.html</span><br><span class="line">改为</span><br><span class="line">DirectoryIndex index.php index.html</span><br></pre></td></tr></table></figure><p><strong>编辑php测试页并开启httpd进行测试</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/apache24/htdocs/</span><br><span class="line"></span><br><span class="line">vim index.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;h1&gt;phpfpmtest&lt;/h1&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">    phpinfo();</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost htdocs]# apachectl start</span><br><span class="line"></span><br><span class="line">AH00558: httpd: Could not reliably determine the server&apos;s fully qualified domain name, using localhost.</span><br><span class="line"></span><br><span class="line">localdomain. Set the &apos;ServerName&apos; directive globally to suppress this</span><br><span class="line"></span><br><span class="line">[root@localhost htdocs]# ss -tnls     </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">State       Recv-Q Send-Q                   Local Address:Port                     Peer Address:Port</span><br><span class="line"></span><br><span class="line">LISTEN      0      128                                 :::80                                 :::*     </span><br><span class="line"></span><br><span class="line">LISTEN      0      128                                 :::22                                 :::*     </span><br><span class="line"></span><br><span class="line">LISTEN      0      128                                  *:22                                  *:*     </span><br><span class="line"></span><br><span class="line">LISTEN      0      100                                ::1:25                                 :::*     </span><br><span class="line"></span><br><span class="line">LISTEN      0      100                          127.0.0.1:25                                  *:*     </span><br><span class="line"></span><br><span class="line">LISTEN      0      128                          127.0.0.1:6010                                *:*     </span><br><span class="line"></span><br><span class="line">LISTEN      0      128                                ::1:6010                               :::*     </span><br><span class="line"></span><br><span class="line">LISTEN      0      128                          127.0.0.1:6011                                *:*     </span><br><span class="line"></span><br><span class="line">LISTEN      0      128                                ::1:6011                               :::*     </span><br><span class="line"></span><br><span class="line">LISTEN      0      128                          127.0.0.1:9000                                *:*</span><br></pre></td></tr></table></figure><p>此时的Server API为FPM/FastCGI</p>]]></content>
      
      
        <tags>
            
            <tag> apache </tag>
            
            <tag> php </tag>
            
            <tag> fpm </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>自签证书使用户可以通过https访问站点</title>
      <link href="/2018/08/06/%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6%E4%BD%BF%E7%94%A8%E6%88%B7%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87https%E8%AE%BF%E9%97%AE%E7%AB%99%E7%82%B9/"/>
      <url>/2018/08/06/%E8%87%AA%E7%AD%BE%E8%AF%81%E4%B9%A6%E4%BD%BF%E7%94%A8%E6%88%B7%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87https%E8%AE%BF%E9%97%AE%E7%AB%99%E7%82%B9/</url>
      <content type="html"><![CDATA[<p><strong>生成私钥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@lampw pki]<span class="comment"># (umask 077; openssl genrsa -out /etc/pki/ca-trust/cakey.pem 8192)</span></span><br><span class="line">Generating RSA private key, 8192 bit long modulus</span><br><span class="line">...................................................................................................................++</span><br><span class="line">........................................................................................................................................................................................................................................................++</span><br><span class="line">e is 65537 (0x10001)</span><br></pre></td></tr></table></figure><a id="more"></a><p><strong>生成自签证书</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@lampw pki]<span class="comment"># openssl req -new -x509 -key /etc/pki/ca-trust/cakey.pem -out /etc/pki/ca-trust/cacert.pem -days 3655</span></span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">'.'</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN  </span><br><span class="line">State or Province Name (full name) [Some-State]:HA</span><br><span class="line">Locality Name (eg, city) []:ZZ</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:Tmall</span><br><span class="line">Organizational Unit Name (eg, section) []:Tmall</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:www2.stuX.com</span><br><span class="line">Email Address []:admin@stuX.com</span><br><span class="line">[root@lampw pki]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><strong>为CA提供所需的目录及文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@lampw pki]<span class="comment"># mkdir  -pv  /etc/pki/CA/&#123;certs,crl,newcerts&#125;</span></span><br><span class="line">mkdir: created directory `/etc/pki/CA<span class="string">'</span></span><br><span class="line"><span class="string">mkdir: created directory `/etc/pki/CA/certs'</span></span><br><span class="line">mkdir: created directory `/etc/pki/CA/crl<span class="string">'</span></span><br><span class="line"><span class="string">mkdir: created directory `/etc/pki/CA/newcerts'</span></span><br><span class="line">[root@lampw pki]<span class="comment"># touch  /etc/pki/CA/&#123;serial,index.txt&#125;</span></span><br><span class="line">[root@lampw pki]<span class="comment"># echo  01 &gt; /etc/pki/CA/serial</span></span><br><span class="line">[root@lampw pki]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><strong>用到证书的主机生成私钥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@lampw pki]<span class="comment"># mkdir  -pv  /etc/pki/CA/&#123;certs,crl,newcerts&#125;</span></span><br><span class="line">mkdir: created directory `/etc/pki/CA<span class="string">'</span></span><br><span class="line"><span class="string">mkdir: created directory `/etc/pki/CA/certs'</span></span><br><span class="line">mkdir: created directory `/etc/pki/CA/crl<span class="string">'</span></span><br><span class="line"><span class="string">mkdir: created directory `/etc/pki/CA/newcerts'</span></span><br><span class="line">[root@lampw pki]<span class="comment"># touch  /etc/pki/CA/&#123;serial,index.txt&#125;</span></span><br><span class="line">[root@lampw pki]<span class="comment"># echo  01 &gt; /etc/pki/CA/serial</span></span><br><span class="line">[root@lampw pki]<span class="comment">#  mkdir -pv /opt/apache24/ssl</span></span><br><span class="line">mkdir: created directory `/opt/apache24/ssl<span class="string">'</span></span><br><span class="line"><span class="string">[root@lampw pki]# cd /opt/apache24/ssl</span></span><br><span class="line"><span class="string">[root@lampw ssl]# (umask  077; openssl  genrsa -out  /opt/apache24/ssl/httpd.key 8192)</span></span><br><span class="line"><span class="string">Generating RSA private key, 8192 bit long modulus</span></span><br><span class="line"><span class="string">.............................................................................................................++</span></span><br><span class="line"><span class="string">....................................................++</span></span><br><span class="line"><span class="string">e is 65537 (0x10001)</span></span><br><span class="line"><span class="string">[root@lampw ssl]#</span></span><br></pre></td></tr></table></figure><p><strong>生成证书签署请求</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@lampw ssl]<span class="comment"># openssl  req  -new  -key  /opt/apache24/ssl/httpd.key  -out /opt/apache24/ssl/httpd.csr  -days  365</span></span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">'.'</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:CN</span><br><span class="line">State or Province Name (full name) [Some-State]:HA</span><br><span class="line">Locality Name (eg, city) []:ZZ</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:Tmall</span><br><span class="line">Organizational Unit Name (eg, section) []:Tmall</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:www2.stuX.com</span><br><span class="line">Email Address []:admin@stuX.com</span><br><span class="line"></span><br><span class="line">Please enter the following <span class="string">'extra'</span> attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br></pre></td></tr></table></figure><p><strong>将请求通过可靠方式发送给CA主机，这次是在同一台机器，我就略过，如果是生产环境，估计就是要发给可信的证书签署机构</strong></p><p>1、在CA主机上签署证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ssl]<span class="comment"># openssl ca  -in  /etc/httpd/ssl/httpd.csr  -out  /etc/pki/CA/certs/httpd.crt  -days  365</span></span><br><span class="line">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">Certificate Details:</span><br><span class="line">        Serial Number: 1 (0x1)</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Mar 22 03:49:48 2017 GMT</span><br><span class="line">            Not After : Mar 22 03:49:48 2018 GMT</span><br><span class="line">        Subject:</span><br><span class="line">            countryName               = CN</span><br><span class="line">            stateOrProvinceName       = HA</span><br><span class="line">            organizationName          = Tmall</span><br><span class="line">            organizationalUnitName    = ops</span><br><span class="line">            commonName                = www2.stuX.com</span><br><span class="line">            emailAddress              = admin@stuX.com</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Basic Constraints: </span><br><span class="line">                CA:FALSE</span><br><span class="line">            Netscape Comment: </span><br><span class="line">                OpenSSL Generated Certificate</span><br><span class="line">            X509v3 Subject Key Identifier: </span><br><span class="line">                EC:C4:48:10:BE:BD:1D:D2:48:38:17:B7:FD:0D:57:DE:51:B1:8F:64</span><br><span class="line">            X509v3 Authority Key Identifier: </span><br><span class="line">                keyid:ED:42:A1:59:88:A2:45:0A:F2:64:46:A6:BA:C9:7A:5D:E3:9C:FB:AE</span><br><span class="line"></span><br><span class="line">Certificate is to be certified until Mar 22 03:49:48 2018 GMT (365 days)</span><br><span class="line">Sign the certificate? [y/n]:y</span><br><span class="line"></span><br><span class="line">    1 out of 1 certificate requests certified, commit? [y/n]y</span><br><span class="line"></span><br><span class="line">    Write out database with 1 new entries</span><br><span class="line"></span><br><span class="line">    Data Base Updated</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@centos ssl]<span class="comment"># ls</span></span><br><span class="line">httpd.crt  httpd.csr  httpd.key</span><br></pre></td></tr></table></figure><p>​   </p><p>2、修改配置文件提供ssl服务</p><p>开启主配置文件的ssl调用，删除www2在httpd-vhosts中的定义</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Include /etc/httpd24/extra/httpd-ssl.conf</span><br><span class="line"></span><br><span class="line">~]# vim /etc/httpd24/extra/httpd-ssl.conf</span><br><span class="line"></span><br><span class="line">[root@localhost httpd24]# cat extra/httpd-ssl.conf | grep -v &quot;^#&quot;</span><br><span class="line"></span><br><span class="line">Listen 443</span><br><span class="line"></span><br><span class="line">SSLPassPhraseDialog  builtin</span><br><span class="line"></span><br><span class="line">&lt;VirtualHost 192.168.150.136:443&gt;</span><br><span class="line"></span><br><span class="line">DocumentRoot &quot;/web/vhost/www2&quot;</span><br><span class="line"></span><br><span class="line">ServerName www2.stuX.com:443</span><br><span class="line"></span><br><span class="line">ServerAdmin you@example.com</span><br><span class="line"></span><br><span class="line">ErrorLog &quot;/var/log/httpd/www2.err&quot;</span><br><span class="line"></span><br><span class="line">TransferLog &quot;/usr/local/apache24/logs/access_log&quot;</span><br><span class="line"></span><br><span class="line">SSLEngine on</span><br><span class="line"></span><br><span class="line">SSLCertificateFile &quot;/etc/httpd24/ssl/httpd.crt&quot;</span><br><span class="line"></span><br><span class="line">SSLCertificateKeyFile &quot;/etc/httpd24/ssl/httpd.key&quot;</span><br><span class="line"></span><br><span class="line">&lt;Directory &quot;/web/vhost/www2&quot;&gt;</span><br><span class="line"></span><br><span class="line"> AllowOverride None</span><br><span class="line"></span><br><span class="line">Options None</span><br><span class="line"></span><br><span class="line">Require all granted</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/Directory&gt;</span><br><span class="line"></span><br><span class="line">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure><p>主配置文件中启用ssl模块</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~]<span class="comment"># vim /etc/httpd24/httpd.conf</span></span><br><span class="line"></span><br><span class="line">LoadModule ssl_module modules/mod_ssl.so</span><br></pre></td></tr></table></figure><p>重启httpd服务后测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">httpd24]<span class="comment"># ss -tnl | grep 443</span></span><br><span class="line"></span><br><span class="line">LISTEN     0      128                      :::443                     :::*</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> CA </tag>
            
            <tag> SSL </tag>
            
            <tag> https </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Apache所支持的处理模型及应用环境</title>
      <link href="/2018/08/06/Apache%E6%89%80%E6%94%AF%E6%8C%81%E7%9A%84%E5%A4%84%E7%90%86%E6%A8%A1%E5%9E%8B%E5%8F%8A%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83/"/>
      <url>/2018/08/06/Apache%E6%89%80%E6%94%AF%E6%8C%81%E7%9A%84%E5%A4%84%E7%90%86%E6%A8%A1%E5%9E%8B%E5%8F%8A%E5%BA%94%E7%94%A8%E7%8E%AF%E5%A2%83/</url>
      <content type="html"><![CDATA[<p><strong>prefork：多进程模型，每个进程响应一个请求</strong></p><p>一个主进程：负责生成子进程及回收子进程；负责创建套接字；负责接收请求，并将其派发给某子进程进行处理；</p><p>n个子进程：每个子进程处理一个请求；</p><p>工作模型：会预先生成几个空闲进程，随时等待用于响应用户请求；最大空闲和最小空闲；<a id="more"></a></p><p><strong>worker：多进程多线程模型，每线程处理一个用户请求</strong></p><p>一个主进程：负责生成子进程；负责创建套接字；负责接收请求，并将其派发给某子进程进行处理；</p><p>多个子进程：每个子进程负责生成多个线程；</p><p>每个线程：负责响应用户请求；</p><p>并发响应数量：m*n</p><p>m：子进程数量</p><p>n：每个子进程所能创建的最大线程数量；</p><p><strong>event：事件驱动模型，多进程模型，每个进程响应多个请求</strong></p><p>一个主进程 ：负责生成子进程；负责创建套接字；负责接收请求，并将其派发给某子进程进行处理；</p><p>子进程：基于事件驱动机制直接响应多个请求；</p>]]></content>
      
      
        <tags>
            
            <tag> apache </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>一次完整的http请求处理过程</title>
      <link href="/2018/08/06/%E4%B8%80%E6%AC%A1%E5%AE%8C%E6%95%B4%E7%9A%84http%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E8%BF%87%E7%A8%8B/"/>
      <url>/2018/08/06/%E4%B8%80%E6%AC%A1%E5%AE%8C%E6%95%B4%E7%9A%84http%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E8%BF%87%E7%A8%8B/</url>
      <content type="html"><![CDATA[<p><strong>简介</strong><br>一次完整的HTTP请求过程从TCP三次握手建立连接成功后开始,客户端按照指定的格式开始向服务端发送HTTP请求，服务端接收请求后，解析HTTP请求，处理完业务逻辑，最后返回一个HTTP的响应给客户端，HTTP的响应内容同样有标准的格式。无论是什么客户端或者是什么服务端，大家只要按照HTTP的协议标准来实现的话，那么它一定是通用的。<a id="more"></a></p><p><strong>1、客户端发起http请求阶段</strong></p><p>客户端在与服务端TCP三次握手建立连接成功后</p><p>开始按照指定的格式开始向服务端发送HTTP请求</p><p>HTTP请求格式主要有四部分组成，分别是：请求行、请求头、空行、消息体，每部分内容占一行，如下图：<br><img src="http://i.imgur.com/M391Xco.png" alt=""></p><p>下面我们来详解一下这个来自客户端的http请求</p><p>请求行：请求行是请求消息的第一行，由三部分组成：分别是请求方法（GET/POST/DELETE/PUT/HEAD）、请求资源的URI路径、HTTP的版本号</p><p>请求头：请求头中的信息有和缓存相关的头（Cache-Control，If-Modified-Since）、客户端身份信息（User-Agent）等等。</p><p>消息体：请求体是客户端发给服务端的请求数据，这部分数据并不是每个请求必须的。</p><p><strong>2、服务端接收客户端http请求阶段</strong></p><p>服务端接收来自于网络上的主机请求报文中对某特定资源的一次请求的过程</p><p><strong>3、服务端处理客户端http请求阶段</strong></p><p>对请求报文进行解析，获取客户端请求的资源及请求方法等相关信息；</p><p>根据请求报文的头信息，来确定请求合适，编码等</p><p><strong>4、服务端根据客户端http请求与访问自己本地资源</strong></p><p>获取请求报文中请求的资源，根据请求，从应用-》系统内核-》驱动-》资源存放媒介（硬盘、内存）获取客户端需要的信息</p><p><strong>5、服务端构建http响应报文</strong></p><p>服务器接收处理完请求后返回一个HTTP响应消息给客户端。HTTP响应消息的格式包括：状态行、响应头、空行、消息体。每部分内容占一行。</p><p><img src="http://i.imgur.com/yNpPuHB.png" alt=""></p><p>状态行：状态行位于相应消息的第一行，有HTTP协议版本号，状态码和状态说明三部分构成。</p><p>响应头：响应头是服务器传递给客户端用于说明服务器的一些信息，以及将来继续访问该资源时的策略。</p><p>响应体：响应体是服务端返回给客户端的HTML文本内容，或者其他格式的数据，比如：视频流、图片或者音频数据。</p><p><strong>6、服务端将http响应报文发送给客户端</strong></p><p>就是在已建立的tcp链接之上将相应报文及客户请求的数据从应用层，传输层、传输层、链路层、物理层层层打包头依次传输到客户端的物理层、链路层、传输层、应用层层层解包，最后客户端获得自己http请求的数据。</p><p><strong>7、记录日志</strong></p><p>服务端记录http请求访问日志</p>]]></content>
      
      
        <tags>
            
            <tag> http </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>自建DNS总结</title>
      <link href="/2018/08/05/%E8%87%AA%E5%BB%BADNS%E6%80%BB%E7%BB%93/"/>
      <url>/2018/08/05/%E8%87%AA%E5%BB%BADNS%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<h3 id="DNS查询过程以及DNS服务器类别"><a href="#DNS查询过程以及DNS服务器类别" class="headerlink" title="DNS查询过程以及DNS服务器类别"></a>DNS查询过程以及DNS服务器类别</h3><p><strong>DNS查询过程</strong></p><p><img src="http://i.imgur.com/0jr6eA2.jpg" alt=""></p><p>1、在浏览器中输入<a href="http://www.qq.com域名，操作系统会先检查自己本地的hosts文件是否有这个网址映射关系，如果有，就先调用这个IP地址映射，完成域名解析。" target="_blank" rel="noopener">www.qq.com域名，操作系统会先检查自己本地的hosts文件是否有这个网址映射关系，如果有，就先调用这个IP地址映射，完成域名解析。</a> </p><p>2、如果hosts里没有这个域名的映射，则查找本地DNS解析器缓存，是否有这个网址映射关系，如果有，直接返回，完成域名解析。 </p><p>3、如果hosts与本地DNS解析器缓存都没有相应的网址映射关系，首先会找TCP/ip参数中设置的首选DNS服务器，在此我们叫它本地DNS服务器，此服务器收到查询时，如果要查询的域名，包含在本地配置区域资源中，则返回解析结果给客户机，完成域名解析，此解析具有权威性。 </p><p>4、如果要查询的域名，不由本地DNS服务器区域解析，但该服务器已缓存了此网址映射关系，则调用这个IP地址映射，完成域名解析，此解析不具有权威性。 <a id="more"></a></p><p>5、如果本地DNS服务器本地区域文件与缓存解析都失效，则根据本地DNS服务器的设置（是否设置转发器）进行查询，如果未用转发模式，本地DNS就把请求发至13台根DNS，根DNS服务器收到请求后会判断这个域名(.com)是谁来授权管理，并会返回一个负责该顶级域名服务器的一个IP。本地DNS服务器收到IP信息后，将会联系负责.com域的这台服务器。这台负责.com域的服务器收到请求后，如果自己无法解析，它就会找一个管理.com域的下一级DNS服务器地址(qq.com)给本地DNS服务器。当本地DNS服务器收到这个地址后，就会找qq.com域服务器，重复上面的动作，进行查询，直至找到<a href="http://www.qq.com主机。" target="_blank" rel="noopener">www.qq.com主机。</a> </p><p>6、如果用的是转发模式，此DNS服务器就会把请求转发至上一级DNS服务器，由上一级服务器进行解析，上一级服务器如果不能解析，或找根DNS或把转请求转至上上级，以此循环。不管是本地DNS服务器用是是转发，还是根提示，最后都是把结果返回给本地DNS服务器，由此DNS服务器再返回给客户机。</p><p>从客户端到本地DNS服务器是属于递归查询，而DNS服务器之间就是的交互查询就是迭代查询。</p><p><strong>DNS服务器类别</strong></p><p><strong>主域名服务器</strong></p><p>负责维护这个区域的所有域名信息，是特定的所有信息的权威信息源</p><p><strong>辅助域名服务器</strong></p><p>当主域名服务器出现故障、关闭或负载过重时，辅助域名服务器作为备份服务提供域名解析服务。辅助域名服务器中的区域文件内的数据是从另外一台域名服务器复制过来的，并不是直接输入的，也就是说这个区域文件只是一份副本，这里的数据是无法修改的。</p><p><strong>缓存服务器</strong></p><p>可运行域名服务器软件但没有域名数据库。它从某个远程服务器取得每次域名服务器查询的回答，一旦获取一个答案，就将它放在高速缓存中，以后查询相同的信息时就用它予以回答。缓存域名服务器不是权威性服务器，因为提供的所有信息都是间接信息。</p><p><strong>转发服务器</strong></p><p>负责所有非本地域名的本地查询。转发域名服务器接到查询请求时，在其缓存中查找，如找不到就把请求依次转发到指定的域名服务器，直到查询到结果为止，否则返回无法映射的结果。</p><h3 id="搭建一套DNS服务器，负责解析qq-com域名（自行设定主机名及IP）"><a href="#搭建一套DNS服务器，负责解析qq-com域名（自行设定主机名及IP）" class="headerlink" title="搭建一套DNS服务器，负责解析qq.com域名（自行设定主机名及IP）"></a>搭建一套DNS服务器，负责解析qq.com域名（自行设定主机名及IP）</h3><p>  (1)、能够对一些主机名进行正向解析和逆向解析；</p><p>  (2)、对子域cdn.qq.com进行子域授权，子域负责解析对应子域中的主机名；</p><p>  (3)、为了保证DNS服务系统的高可用性，请设计一套方案，并写出详细的实施过程</p><p>先来个架构图：</p><p><img src="http://i.imgur.com/OoFnAxj.jpg" alt=""></p><p><strong>先来安装bind</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@DNS2 ~]<span class="comment"># yum install bind</span></span><br><span class="line"></span><br><span class="line">[root@DNS2 ~]<span class="comment"># rpm -qa |grep bind  #查看安装的包和版本</span></span><br><span class="line"><span class="built_in">bind</span>-9.8.2-0.47.rc1.el6_8.4.x86_64</span><br><span class="line"><span class="built_in">bind</span>-libs-9.8.2-0.47.rc1.el6_8.4.x86_64</span><br><span class="line">PackageKit-device-rebind-0.5.8-26.el6.x86_64</span><br><span class="line"><span class="built_in">bind</span>-utils-9.8.2-0.47.rc1.el6_8.4.x86_64</span><br><span class="line">[root@DNS2 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>我是两台DNS测试机一起安装的，这里只列出其中同一台的安装操作命令。</p><p><strong>主配置文件之一：/etc/named.conf</strong></p><p><img src="http://i.imgur.com/wteqhjS.png" alt=""></p><p><strong>主配置文件之二：/etc/named.rfc1912.zones</strong></p><p>在文件尾部加上一下内容，这里就实现了能够对qq.com域名进行正向解析和逆向解析</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">"qq.com"</span> IN &#123;</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">"qq.com.zone"</span>;</span><br><span class="line">    allow-transter &#123; 192.168.0.244; &#125;; <span class="comment">#这里这行IP是从DNS服务器的IP</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"0.168.192.in-addr.arpa"</span> IN &#123;</span><br><span class="line">    <span class="built_in">type</span> master</span><br><span class="line">    file <span class="string">"0.168.192.zone"</span>;</span><br><span class="line">    allow-transter &#123; 192.168.0.244; &#125;; <span class="comment">#这里这行IP是从DNS服务器的IP</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>测试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@centos named]<span class="comment"># dig -x 192.168.0.116</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.47.rc1.el6_8.4 &lt;&lt;&gt;&gt; -x 192.168.0.116</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 31489</span><br><span class="line">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 1, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;116.0.168.192.in-addr.arpa.INPTR</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">116.0.168.192.in-addr.arpa. 3600 INPTRwww.qq.com.</span><br><span class="line">116.0.168.192.in-addr.arpa. 3600 INPTRns1.qq.com.</span><br><span class="line"></span><br><span class="line">;; AUTHORITY SECTION:</span><br><span class="line">0.168.192.in-addr.arpa.3600INNSns1.qq.com.</span><br><span class="line"></span><br><span class="line">;; ADDITIONAL SECTION:</span><br><span class="line">ns1.qq.com.3600INA192.168.0.116</span><br><span class="line"></span><br><span class="line">;; Query time: 0 msec</span><br><span class="line">;; SERVER: 127.0.0.1<span class="comment">#53(127.0.0.1)</span></span><br><span class="line">;; WHEN: Tue Feb 28 13:50:38 2017</span><br><span class="line">;; MSG SIZE  rcvd: 120</span><br><span class="line"></span><br><span class="line">[root@centos named]<span class="comment"># dig -t A www.qq.com</span></span><br><span class="line"></span><br><span class="line">; &lt;&lt;&gt;&gt; DiG 9.8.2rc1-RedHat-9.8.2-0.47.rc1.el6_8.4 &lt;&lt;&gt;&gt; -t A www.qq.com</span><br><span class="line">;; global options: +cmd</span><br><span class="line">;; Got answer:</span><br><span class="line">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 31217</span><br><span class="line">;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 1, ADDITIONAL: 1</span><br><span class="line"></span><br><span class="line">;; QUESTION SECTION:</span><br><span class="line">;www.qq.com.INA</span><br><span class="line"></span><br><span class="line">;; ANSWER SECTION:</span><br><span class="line">www.qq.com.3600INA192.168.0.116</span><br><span class="line"></span><br><span class="line">;; AUTHORITY SECTION:</span><br><span class="line">qq.com.3600INNSns1.qq.com.</span><br><span class="line"></span><br><span class="line">;; ADDITIONAL SECTION:</span><br><span class="line">ns1.qq.com.3600INA192.168.0.116</span><br><span class="line"></span><br><span class="line">;; Query time: 0 msec</span><br><span class="line">;; SERVER: 127.0.0.1<span class="comment">#53(127.0.0.1)</span></span><br><span class="line">;; WHEN: Tue Feb 28 13:51:04 2017</span><br><span class="line">;; MSG SIZE  rcvd: 82</span><br><span class="line"></span><br><span class="line">[root@centos named]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><strong>接下来配置对子域cdn.qq.com进行子域授权，子域负责解析对应子域中的主机名</strong>、</p><p>另外启动一台，安装bind</p><p>vim /etc/named.conf </p><p>vim /etc/named.rfc1912.zones  加入以下内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">"cdn.qq.com"</span> IN &#123;</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">"cdn.qq.com.zone"</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>​     </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">vim /var/named/cdn.qq.com.zone</span><br><span class="line"><span class="variable">$TTL</span> 3600</span><br><span class="line"><span class="variable">$ORIGIN</span> cdn.qq.com.</span><br><span class="line">@   IN  SOA ns1.cdn.qq.com. admin.qq.com. (</span><br><span class="line">        122701</span><br><span class="line">        2H</span><br><span class="line">        10M</span><br><span class="line">        1W</span><br><span class="line">        1D )</span><br><span class="line">    IN  NS  ns1</span><br><span class="line">ns1 IN  A   192.168.20.51</span><br><span class="line">www IN  A   192.168.20.199</span><br><span class="line"><span class="comment"># chown :named /var/named/cdn.qq.com.zone</span></span><br><span class="line"><span class="comment"># chmod 640 /var/named/cdn.qq.com.zone</span></span><br><span class="line">检查named配置文件及区域配置文件：</span><br><span class="line"><span class="comment"># named-checkconf</span></span><br><span class="line"><span class="comment"># named-checkzone cdn.qq.com /var/named/cdn.qq.com.zone</span></span><br><span class="line"><span class="comment"># systemctl start named.service</span></span><br><span class="line">在主域S1上的配置：</span><br><span class="line"><span class="comment"># vim /var/named/qq.com.zone</span></span><br><span class="line">cdn IN  NS  ns1.cdn</span><br><span class="line">ns1.cdn IN  A   192.168.20.51</span><br><span class="line"><span class="comment"># rndc reload</span></span><br><span class="line">测试解析：</span><br><span class="line"><span class="comment"># dig -t A www.cdn.qq.com</span></span><br></pre></td></tr></table></figure><h3 id="DNS服务器主从"><a href="#DNS服务器主从" class="headerlink" title="DNS服务器主从"></a>DNS服务器主从</h3><p>其实不难，就是很多细节要注意，我先贴配置文件吧</p><p>主机  192.168.0.116</p><p> /etc/named.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">options &#123;</span><br><span class="line">        listen-on port 53 &#123; 192.168.0.116; &#125;;</span><br><span class="line">//      listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class="line">        directory       <span class="string">"/var/named"</span>;</span><br><span class="line">        dump-file       <span class="string">"/var/named/data/cache_dump.db"</span>;</span><br><span class="line">        statistics-file <span class="string">"/var/named/data/named_stats.txt"</span>;</span><br><span class="line">        memstatistics-file <span class="string">"/var/named/data/named_mem_stats.txt"</span>;</span><br><span class="line">        allow-query     &#123; any; &#125;;</span><br><span class="line">        recursion yes;</span><br><span class="line"></span><br><span class="line">        dnssec-enable no;</span><br><span class="line">        dnssec-validation no;</span><br><span class="line">        dnssec-lookaside no;</span><br><span class="line">        /* Path to ISC DLV key */</span><br><span class="line">//      bindkeys-file <span class="string">"/etc/named.iscdlv.key"</span>;</span><br><span class="line"></span><br><span class="line">//      managed-keys-directory <span class="string">"/var/named/dynamic"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">logging &#123;</span><br><span class="line">        channel default_debug &#123;</span><br><span class="line">                file <span class="string">"data/named.run"</span>;</span><br><span class="line">                severity dynamic;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"."</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> hint;</span><br><span class="line">        file <span class="string">"named.ca"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">include <span class="string">"/etc/named.rfc1912.zones"</span>;</span><br><span class="line">include <span class="string">"/etc/named.root.key"</span>;</span><br></pre></td></tr></table></figure><p>从机 192.168.0.117</p><p> /etc/named.conf</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">options &#123;</span><br><span class="line">        listen-on port 53 &#123; 192.168.0.117; &#125;;</span><br><span class="line">//      listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class="line">        directory       <span class="string">"/var/named"</span>;</span><br><span class="line">        dump-file       <span class="string">"/var/named/data/cache_dump.db"</span>;</span><br><span class="line">        statistics-file <span class="string">"/var/named/data/named_stats.txt"</span>;</span><br><span class="line">        memstatistics-file <span class="string">"/var/named/data/named_mem_stats.txt"</span>;</span><br><span class="line">        allow-query     &#123; any; &#125;;</span><br><span class="line">        recursion yes;</span><br><span class="line"></span><br><span class="line">        dnssec-enable no;</span><br><span class="line">        dnssec-validation no;</span><br><span class="line">        dnssec-lookaside no;</span><br><span class="line">        /* Path to ISC DLV key */</span><br><span class="line">//      bindkeys-file <span class="string">"/etc/named.iscdlv.key"</span>;</span><br><span class="line"></span><br><span class="line">//      managed-keys-directory <span class="string">"/var/named/dynamic"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">logging &#123;</span><br><span class="line">        channel default_debug &#123;</span><br><span class="line">                file <span class="string">"data/named.run"</span>;</span><br><span class="line">                severity dynamic;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"."</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> hint;</span><br><span class="line">        file <span class="string">"named.ca"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">include <span class="string">"/etc/named.rfc1912.zones"</span>;</span><br><span class="line">include <span class="string">"/etc/named.root.key"</span>;</span><br></pre></td></tr></table></figure><p>打开辅助DNS服务器的/etc/named.rfc1912.zones文件，添加两个区域记录，这两个记录是主DNS服务器配置文件里已经存在的记录，一个是正向解析记录，一个是反向解析记录</p><p>type: slave，表示此时DNS服务器为辅助DNS服务器，于是下面一行就要定义主DNS服务器的IP地址，辅助DNS服务器才知道去哪里同步数据。辅助DNS服务器的资源类型数据文件通常保存在slaves目录，只需定义一个名称，文件内容通常是自动生成。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">"qq.com"</span> IN &#123;</span><br><span class="line">    <span class="built_in">type</span> slave;</span><br><span class="line">    file <span class="string">"slaves/qq.com.zone"</span>;</span><br><span class="line">    masters &#123; 192.168.0.116; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">"0.168.192.in-addr.arpa"</span> IN &#123;</span><br><span class="line">    <span class="built_in">type</span> slave;</span><br><span class="line">    file <span class="string">"slaves/192.168.0.116.zone"</span>;</span><br><span class="line">    masters &#123; 192.168.0.116; &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>修改主DNS服务器的数据文件，添加一条辅助DNS服务器记录，给辅助DNS服务器授权。</p><p>正向解析文件<br>vim /var/named/qq.com.zone</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TTL</span> 3600</span><br><span class="line"><span class="variable">$ORIGIN</span> qq.com.</span><br><span class="line">@   IN  SOA ns1.qq.com. admin.qq.com. (</span><br><span class="line">        2016122703</span><br><span class="line">        2H</span><br><span class="line">        10M</span><br><span class="line">        1W</span><br><span class="line">        1D )</span><br><span class="line">    IN  NS  ns1</span><br><span class="line">ns1 IN  A   192.168.0.116</span><br><span class="line">www IN  A   192.168.0.116</span><br><span class="line">cdn IN  NS  ns1.cdn</span><br><span class="line">ns1.cdn IN  A   192.168.0.117</span><br><span class="line">    IN  NS  ns2</span><br><span class="line">ns2 IN  A   192.168.0.117</span><br></pre></td></tr></table></figure><p>添加了一条NS记录，值为，ns2.qq.com.，对应的A记录也要增加一条，把IP地址指向对应的辅助DNS服务器的IP地址。修改完成后，记得要把序列号的值加1，用于通知辅助DNS服务器自动更新数据文件。</p><p>修改反向解析文件/var/named/0.168.192.zone</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TTL</span> 3600</span><br><span class="line"><span class="variable">$ORIGIN</span> 0.168.192.in-addr.arpa.</span><br><span class="line">@       IN      SOA     ns1.qq.com.  nsadmin.qq.com. (</span><br><span class="line">        16122702</span><br><span class="line">        1H</span><br><span class="line">        10M</span><br><span class="line">        3D</span><br><span class="line">        12H )</span><br><span class="line">         IN      NS      ns1.qq.com.</span><br><span class="line">116      IN      PTR     ns1.qq.com.</span><br><span class="line">116      IN      PTR     www.qq.com.</span><br><span class="line">         IN      NS      ns2.qq.com.</span><br><span class="line">117      IN      PTR     ns2.qq.com.</span><br></pre></td></tr></table></figure><p>同样的也增加了两条记录，一条辅助DNS服务器的NS记录和对应的PTR记录。修改完成后记得所序列号的值加1，用于通知辅助DNS服务器自动更新数据文件。</p><p>最后两边都把named服务重启一下，再rndc reload 就好</p>]]></content>
      
      
        <tags>
            
            <tag> DNS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>通讯加密及私有CA</title>
      <link href="/2018/08/05/%E9%80%9A%E8%AE%AF%E5%8A%A0%E5%AF%86%E5%8F%8A%E7%A7%81%E6%9C%89CA/"/>
      <url>/2018/08/05/%E9%80%9A%E8%AE%AF%E5%8A%A0%E5%AF%86%E5%8F%8A%E7%A7%81%E6%9C%89CA/</url>
      <content type="html"><![CDATA[<h3 id="记一次加密通讯的过程"><a href="#记一次加密通讯的过程" class="headerlink" title="记一次加密通讯的过程"></a>记一次加密通讯的过程</h3><p><img src="http://i.imgur.com/OTwBgQW.jpg" alt=""></p><p><strong>第一阶段：ClientHello：</strong><br>支持的协议版本，比如tls 1.2；<br>客户端生成一个随机数，稍后用户生成“会话密钥”<br>支持的加密算法，比如AES、3DES、RSA；<br>支持的压缩算法；<br>    <a id="more"></a><br><strong>第二阶段：ServerHello</strong><br>确认使用的加密通信协议版本，比如tls 1.2；<br>服务器端生成一个随机数，稍后用于生成“会话密钥”<br>确认使用的加密方法；<br>服务器证书；</p><p><strong>第三阶段：</strong><br>验正服务器证书，在确认无误后取出其公钥；（发证机构、证书完整性、证书持有者、证书有效期、吊销列表）<br>发送以下信息给服务器端：<br>一个随机数；<br>编码变更通知，表示随后的信息都将用双方商定的加密方法和密钥发送；<br>客户端握手结束通知；</p><p><strong>第四阶段：</strong><br>收到客户端发来的第三个随机数pre-master-key后，计算生成本次会话所有到的“会话密钥”；<br>向客户端发送如下信息：<br>编码变更通知，表示随后的信息都将用双方商定的加密方法和密钥发送；<br>服务端握手结束通知；</p><p><strong>下图来个通俗版的(密匙版本，可能不是完全吻合)：</strong></p><p><img src="http://i.imgur.com/X16Cqj1.jpg" alt=""></p><h3 id="创建私有CA的过程，以及为客户端发来的证书请求进行颁发证书"><a href="#创建私有CA的过程，以及为客户端发来的证书请求进行颁发证书" class="headerlink" title="创建私有CA的过程，以及为客户端发来的证书请求进行颁发证书"></a>创建私有CA的过程，以及为客户端发来的证书请求进行颁发证书</h3><p><strong>创建私有CA的过程</strong></p><p><strong>第一步：生成私钥</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos private]<span class="comment"># (umask 077; openssl genrsa -out /etc/pki/CA/private/jerry_cakey.pam 8192)</span></span><br><span class="line">Generating RSA private key, 8192 bit long modulus</span><br><span class="line">......................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................................++</span><br><span class="line">..........++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">[root@centos private]<span class="comment"># ll</span></span><br><span class="line">总用量 8</span><br><span class="line">-rw------- 1 root root 6363 2月  24 15:39 jerry_cakey.pam</span><br><span class="line">[root@centos private]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><strong>第二步：生成自签证书</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos private]<span class="comment"># openssl req -new -x509 -key /etc/pki/CA/private/cakey.pem -out /etc/pki/CA/cacert.pem -days 3655</span></span><br><span class="line"></span><br><span class="line">-new：生成新证书签署请求；</span><br><span class="line"></span><br><span class="line">-x509：生成自签格式证书，专用于创建私有CA时；</span><br><span class="line"></span><br><span class="line">-key：生成请求时用到的私有文件路径；</span><br><span class="line"></span><br><span class="line">-out：生成的请求文件路径；如果自签操作将直接生成签署过的证书；</span><br><span class="line"></span><br><span class="line">-days：证书的有效时长，单位是day；</span><br></pre></td></tr></table></figure><p>第三步：为CA提供所需的目录及文件；**</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos private]<span class="comment"># mkdir  -pv  /etc/pki/CA/&#123;certs,crl,newcerts&#125;</span></span><br><span class="line">[root@centos private]<span class="comment"># touch  /etc/pki/CA/&#123;serial,index.txt&#125;</span></span><br><span class="line">[root@centos private]<span class="comment"># echo  01 &gt; /etc/pki/CA/serial</span></span><br></pre></td></tr></table></figure><p><strong>为客户端发来的证书请求进行颁发证书</strong></p><p><strong>第一步:用到证书的主机生成私钥:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># cd /etc/httpd/ssl</span></span><br><span class="line">[root@centos ssl]<span class="comment"># (umask  077; openssl  genrsa -out  /etc/httpd/ssl/httpd.key  8192)</span></span><br><span class="line">Generating RSA private key, 8192 bit long modulus</span><br><span class="line">......................................................................................................................................................................................................................................................................++</span><br><span class="line">......................................................................................................................................................................................++</span><br><span class="line">e is 65537 (0x10001)</span><br><span class="line">[root@centos ssl]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><strong>第二步:生成证书签署请求</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ssl]<span class="comment">#  openssl  req  -new  -key  /etc/httpd/ssl/httpd.key  -out /etc/httpd/ssl/httpd.csr  -days  365</span></span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">'.'</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:Hubei</span><br><span class="line">Locality Name (eg, city) [Default City]:Wuhan</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:wanghuakeji</span><br><span class="line">Organizational Unit Name (eg, section) []:Ops</span><br><span class="line">Common Name (eg, your name or your server<span class="string">'s hostname) []:whmall.com</span></span><br><span class="line"><span class="string">Email Address []:caadmin@whmall.com</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Please enter the following '</span>extra<span class="string">' attributes</span></span><br><span class="line"><span class="string">to be sent with your certificate request</span></span><br><span class="line"><span class="string">A challenge password []:qweasdzxc</span></span><br><span class="line"><span class="string">An optional company name []:            </span></span><br><span class="line"><span class="string">[root@centos ssl]#</span></span><br></pre></td></tr></table></figure><p><strong>第三步:将请求通过可靠方式发送给CA主机</strong></p><p>两台主机就用scp，我这里是都在一台虚拟机上就用cp命令，过于简单，就不贴过程了</p><p><strong>第四步：在CA主机上签署证书</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ssl]<span class="comment"># openssl ca  -in  /etc/httpd/ssl/httpd.csr  -out  /etc/pki/CA/certs/httpd.crt  -days  365</span></span><br><span class="line">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">Certificate Details:</span><br><span class="line">        Serial Number: 1 (0x1)</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Feb 24 09:08:16 2017 GMT</span><br><span class="line">            Not After : Feb 24 09:08:16 2018 GMT</span><br><span class="line">        Subject:</span><br><span class="line">            countryName               = CN</span><br><span class="line">            stateOrProvinceName       = Hubei</span><br><span class="line">            organizationName          = FBI</span><br><span class="line">            organizationalUnitName    = Ops</span><br><span class="line">            commonName                = xxx.com</span><br><span class="line">            emailAddress              = caadmin@xxx.com</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Basic Constraints: </span><br><span class="line">                CA:FALSE</span><br><span class="line">            Netscape Comment: </span><br><span class="line">                OpenSSL Generated Certificate</span><br><span class="line">            X509v3 Subject Key Identifier: </span><br><span class="line">                D9:4A:37:A2:3E:C4:0D:B8:DF:BF:97:D2:DF:6F:21:6D:B5:56:E1:47</span><br><span class="line">            X509v3 Authority Key Identifier: </span><br><span class="line">                keyid:07:17:C7:46:2F:05:5C:12:D3:10:65:DE:58:83:36:A3:A9:0D:02:17</span><br><span class="line"></span><br><span class="line">Certificate is to be certified until Feb 24 09:08:16 2018 GMT (365 days)</span><br><span class="line">Sign the certificate? [y/n]:y</span><br><span class="line">1 out of 1 certificate requests certified, commit? [y/n]y</span><br><span class="line">Write out database with 1 new entries</span><br><span class="line">Data Base Updated</span><br><span class="line">[root@centos ssl]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>​    </p>]]></content>
      
      
        <tags>
            
            <tag> CA </tag>
            
            <tag> SSL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>脚本写到手抽筋</title>
      <link href="/2018/08/05/%E8%84%9A%E6%9C%AC%E5%86%99%E5%88%B0%E6%89%8B%E6%8A%BD%E7%AD%8B/"/>
      <url>/2018/08/05/%E8%84%9A%E6%9C%AC%E5%86%99%E5%88%B0%E6%89%8B%E6%8A%BD%E7%AD%8B/</url>
      <content type="html"><![CDATA[<h3 id="为运行于虚拟机上的CentOS-6添加一块新硬件，提供两个主分区"><a href="#为运行于虚拟机上的CentOS-6添加一块新硬件，提供两个主分区" class="headerlink" title="为运行于虚拟机上的CentOS 6添加一块新硬件，提供两个主分区"></a>为运行于虚拟机上的CentOS 6添加一块新硬件，提供两个主分区</h3><p>  (1) 为硬盘新建两个主分区；并为其安装grub；<br>  (2) 为硬盘的第一个主分区提供内核和ramdisk文件； 为第二个分区提供rootfs；<br>  (3) 为rootfs提供bash、ls、cat程序及所依赖的库文件；<br>  (4) 为grub提供配置文件；<br>  (5) 将新的硬盘设置为第一启动项并能够正常启动目标主机；<a id="more"></a></p><p><strong>为硬盘新建两个主分区</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># fdisk -l  #先来看看磁盘情况啊，你不看，一上来直接搞，小心搞出事情！！</span></span><br><span class="line"></span><br><span class="line">Disk /dev/sda: 171.8 GB, 171798691840 bytes</span><br><span class="line">255 heads, 63 sectors/track, 20886 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00098b32</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *           1          64      512000   83  Linux</span><br><span class="line">Partition 1 does not end on cylinder boundary.</span><br><span class="line">/dev/sda2              64       20887   167259136   8e  Linux LVM</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 42.9 GB, 42949672960 bytes</span><br><span class="line">255 heads, 63 sectors/track, 5221 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/vg_centos-lv_root: 170.2 GB, 170196467712 bytes</span><br><span class="line">255 heads, 63 sectors/track, 20691 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/vg_centos-lv_swap: 1073 MB, 1073741824 bytes</span><br><span class="line">255 heads, 63 sectors/track, 130 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br></pre></td></tr></table></figure><p>​    </p><p>不错不错，看到sdb了， 分的40G</p><p><strong>开始分区</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># fdisk /dev/sdb</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 42.9 GB, 42949672960 bytes</span><br><span class="line">255 heads, 63 sectors/track, 5221 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x86662f67</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 1</span><br><span class="line">First cylinder (1-5221, default 1): </span><br><span class="line">Using default value 1</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-5221, default 5221): +20G</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 42.9 GB, 42949672960 bytes</span><br><span class="line">255 heads, 63 sectors/track, 5221 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x86662f67</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1        2612    20980858+  83  Linux</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 2</span><br><span class="line">First cylinder (2613-5221, default 2613): </span><br><span class="line">Using default value 2613</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (2613-5221, default 5221): </span><br><span class="line">Using default value 5221</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 42.9 GB, 42949672960 bytes</span><br><span class="line">255 heads, 63 sectors/track, 5221 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x86662f67</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1        2612    20980858+  83  Linux</span><br><span class="line">/dev/sdb2            2613        5221    20956792+  83  Linux</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w</span><br><span class="line">The partition table has been altered!</span><br></pre></td></tr></table></figure><p><strong>分区完了就开始格式化了啊</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># mkfs.ext4 /dev/sdb1</span></span><br><span class="line">mke2fs 1.41.12 (17-May-2010)</span><br><span class="line">文件系统标签=</span><br><span class="line">操作系统:Linux</span><br><span class="line">块大小=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">分块大小=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">1313760 inodes, 5245214 blocks</span><br><span class="line">262260 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">第一个数据块=0</span><br><span class="line">Maximum filesystem blocks=4294967296</span><br><span class="line">161 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8160 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, </span><br><span class="line">4096000</span><br><span class="line"></span><br><span class="line">正在写入inode表: 完成                            </span><br><span class="line">Creating journal (32768 blocks): 完成</span><br><span class="line">Writing superblocks and filesystem accounting information: 完成</span><br><span class="line"></span><br><span class="line">This filesystem will be automatically checked every 21 mounts or</span><br><span class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</span><br><span class="line">[root@centos ~]<span class="comment"># mkfs.ext4 /dev/sdb2</span></span><br><span class="line">mke2fs 1.41.12 (17-May-2010)</span><br><span class="line">文件系统标签=</span><br><span class="line">操作系统:Linux</span><br><span class="line">块大小=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">分块大小=4096 (<span class="built_in">log</span>=2)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">1310720 inodes, 5239198 blocks</span><br><span class="line">261959 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">第一个数据块=0</span><br><span class="line">Maximum filesystem blocks=4294967296</span><br><span class="line">160 block groups</span><br><span class="line">32768 blocks per group, 32768 fragments per group</span><br><span class="line">8192 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, </span><br><span class="line">4096000</span><br><span class="line"></span><br><span class="line">正在写入inode表: 完成                            </span><br><span class="line">Creating journal (32768 blocks): 完成</span><br><span class="line">Writing superblocks and filesystem accounting information: 完成</span><br><span class="line"></span><br><span class="line">This filesystem will be automatically checked every 26 mounts or</span><br><span class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</span><br></pre></td></tr></table></figure><p><strong>挂载分区sdb1到/mnt/boot下</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos mnt]<span class="comment">#mkdir boot</span></span><br><span class="line">[root@centos mnt]<span class="comment">#mount /dev/sdb1 /mnt/boot</span></span><br></pre></td></tr></table></figure><p><strong>安装grub</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos mnt]<span class="comment"># grub-install --root-de</span></span><br><span class="line">[root@centos mnt]<span class="comment"># grub-install --root-directory=/mnt  /dev/sdb</span></span><br><span class="line">Probing devices to guess BIOS drives. This may take a long time.</span><br><span class="line">/dev/mapper/vg_centos-lv_root does not have any corresponding BIOS drive.</span><br><span class="line">[root@centos mnt]<span class="comment"># ll</span></span><br><span class="line">总用量 8</span><br><span class="line">drwxr-xr-x 3 root root 4096 2月  20 10:09 boot</span><br><span class="line">drwxr-xr-x 2 root root 4096 10月 18 10:41 hgfs</span><br><span class="line">[root@centos mnt]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><strong>复制内核及ramdisk文件到sdb1上</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos mnt]<span class="comment"># cp /boot/vmlinuz-2.6.32-642.13.1.el6.x86_64 /mnt/boot/vmlinuz</span></span><br><span class="line">[root@centos mnt]<span class="comment"># cp /boot/initramfs-2.6.32-642.13.1.el6.x86_64.img /mnt/boot/initramfs.img</span></span><br></pre></td></tr></table></figure><p><strong>在/mnt/boot/grub目录下编辑新建grub.conf文件</strong></p><p>   内容如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">default=0</span><br><span class="line">timeout=5</span><br><span class="line">title CentOS6(<span class="built_in">test</span>)</span><br><span class="line">root (hd0,0)</span><br><span class="line">kernel /vmlinuz ro root=/dev/sda2 selinux=0 init=/bin/bash</span><br><span class="line">initrd /initramfs.img</span><br></pre></td></tr></table></figure><p><strong>挂载分区/dev/sdb2到/mnt/sysroot下</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /mnt/sysroot</span><br><span class="line">mount /dev/sdb2 /mnt/sysroot/</span><br></pre></td></tr></table></figure><p><strong>建立FHS</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@centos sysroot]<span class="comment">#  mkdir -pv /mnt/sysroot/&#123;bin,dev,etc/&#123;rc.d/init.d,sysconfig/network-scripts&#125;,lib/modules,lib64,proc,sbin,sys,tmp,usr/local/&#123;bin,sbin&#125;,var/&#123;lock,log,run&#125;&#125;</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/bin"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/dev"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/etc"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/etc/rc.d"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/etc/rc.d/init.d"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/etc/sysconfig"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/etc/sysconfig/network-scripts"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/lib"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/lib/modules"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/lib64"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/proc"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/sbin"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/sys"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/tmp"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/usr"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/usr/local"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/usr/local/bin"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/usr/local/sbin"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/var"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/var/lock"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/var/log"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/mnt/sysroot/var/run"</span></span><br><span class="line">[root@centos sysroot]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p><strong>拷贝bash、ls、cat程序及其依赖库</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos sysroot]<span class="comment"># cp /bin/&#123;bash,ls,cat&#125; /mnt/sysroot/bin</span></span><br><span class="line"></span><br><span class="line">[root@centos bin]<span class="comment"># cp `ldd /bin/&#123;bash,ls,cat&#125;  |grep -oe "/lib.*[[:space:]]"|sort -u` /mnt/sysroot/lib64/</span></span><br><span class="line"></span><br><span class="line">[root@centos bin]<span class="comment"># chroot /mnt/sysroot</span></span><br></pre></td></tr></table></figure><p><strong>chroot先测试一下</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos bin]<span class="comment"># chroot /mnt/sysroot</span></span><br><span class="line">bash-4.1<span class="comment"># ls</span></span><br><span class="line">bin  dev  etc  lib  lib64  proc  sbin  sys  tmp  usr  var</span><br><span class="line">bash-4.1<span class="comment"># exit</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">[root@centos bin]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>OK，接下来挂载到另外一台虚拟机上测试一下，亲测成功。</p><h3 id="制作一个kickstart文件以及一个引导镜像。"><a href="#制作一个kickstart文件以及一个引导镜像。" class="headerlink" title="制作一个kickstart文件以及一个引导镜像。"></a>制作一个kickstart文件以及一个引导镜像。</h3><p>思路</p><ol><li>找到一个已安装好的centos的ks文件，一般位于/root/anaconda-ks.cfg，修修改改，生成一个自定义的ks.cfg文件。</li><li>放到解压的原版IOS到某目录，添加ks文件。</li><li>修改光盘的isolinux.cfg文件，在 append 指令后附加 ks 设置。</li><li>再生成自定义的ISO文件。</li><li>最后用此ISO去安装启动一台裸虚拟机测试是否能自动安装。</li></ol><p><strong>找到一个已安装好的centos的ks文件，一般位于/root/anaconda-ks.cfg，修修改改，生成一个自定义的ks.cfg文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#platform=x86, AMD64, 或 Intel EM64T</span></span><br><span class="line"><span class="comment">#version=DEVEL</span></span><br><span class="line"><span class="comment"># Firewall configuration</span></span><br><span class="line">firewall --disabled</span><br><span class="line"><span class="comment"># Install OS instead of upgrade</span></span><br><span class="line">install</span><br><span class="line"><span class="comment"># Use CDROM installation media</span></span><br><span class="line">cdrom</span><br><span class="line"><span class="comment"># Root password</span></span><br><span class="line">rootpw --iscrypted <span class="variable">$1</span><span class="variable">$Qo3PJbQH</span><span class="variable">$GyTUtGgr1U</span>.th4KTIrvfT1</span><br><span class="line"><span class="comment"># System authorization information</span></span><br><span class="line">auth  --useshadow  --passalgo=sha512</span><br><span class="line"><span class="comment"># Use graphical install</span></span><br><span class="line">graphical</span><br><span class="line">firstboot --<span class="built_in">disable</span></span><br><span class="line"><span class="comment"># System keyboard</span></span><br><span class="line">keyboard us</span><br><span class="line"><span class="comment"># System language</span></span><br><span class="line">lang zh_CN</span><br><span class="line"><span class="comment"># SELinux configuration</span></span><br><span class="line">selinux --disabled</span><br><span class="line"><span class="comment"># Installation logging level</span></span><br><span class="line">logging --level=info</span><br><span class="line"></span><br><span class="line"><span class="comment"># System timezone</span></span><br><span class="line">timezone  Asia/Shanghai</span><br><span class="line"><span class="comment"># Network information</span></span><br><span class="line">network  --bootproto=dhcp --device=eth1 --onboot=on</span><br><span class="line"><span class="comment"># System bootloader configuration</span></span><br><span class="line">bootloader --location=mbr</span><br><span class="line"><span class="comment"># Partition clearing information</span></span><br><span class="line">clearpart --all --initlabel </span><br><span class="line"><span class="comment"># Disk partitioning information</span></span><br><span class="line">part /boot --fstype=<span class="string">"ext4"</span> --size=500</span><br><span class="line">part swap --fstype=<span class="string">"swap"</span> --size=2000</span><br><span class="line">part / --fstype=<span class="string">"ext4"</span> --grow --size=1</span><br><span class="line"></span><br><span class="line">%packages</span><br><span class="line">@base</span><br><span class="line">@compat-libraries</span><br><span class="line">@graphical-admin-tools</span><br><span class="line">@legacy-unix</span><br><span class="line">@network-tools</span><br><span class="line">@xfce-desktop</span><br><span class="line">NetworkManager-openswan</span><br><span class="line">arptables_jf</span><br><span class="line">arpwatch</span><br><span class="line">audit-viewer</span><br><span class="line">authd</span><br><span class="line">cups-lpd</span><br><span class="line">dbench</span><br><span class="line">dropwatch</span><br><span class="line">dump</span><br><span class="line">ebtables</span><br><span class="line">ettercap</span><br><span class="line">finger</span><br><span class="line">finger-server</span><br><span class="line">firstaidkit-gui</span><br><span class="line">ipset</span><br><span class="line">iptraf</span><br><span class="line">iptstate</span><br><span class="line">krb5-appl-servers</span><br><span class="line">ksh</span><br><span class="line">lksctp-tools</span><br><span class="line">lshw-gui</span><br><span class="line">mipv6-daemon</span><br><span class="line">mksh</span><br><span class="line">mrtg</span><br><span class="line">ncompress</span><br><span class="line">netlabel_tools</span><br><span class="line">nmap</span><br><span class="line">openvpn</span><br><span class="line">policycoreutils-gui</span><br><span class="line">qstat</span><br><span class="line">rsh</span><br><span class="line">rsh-server</span><br><span class="line">rusers</span><br><span class="line">rusers-server</span><br><span class="line">rwho</span><br><span class="line">sabayon</span><br><span class="line">setroubleshoot</span><br><span class="line">stunnel</span><br><span class="line">system-config-kickstart</span><br><span class="line">system-config-lvm</span><br><span class="line">talk</span><br><span class="line">talk-server</span><br><span class="line">tcp_wrappers</span><br><span class="line">telnet</span><br><span class="line">telnet-server</span><br><span class="line">tftp</span><br><span class="line">vtun</span><br><span class="line">wireshark</span><br><span class="line">wireshark-gnome</span><br><span class="line">yumex</span><br><span class="line">-cpuspeed</span><br><span class="line">-irqbalance</span><br><span class="line">-mdadm</span><br><span class="line"></span><br><span class="line">%end</span><br></pre></td></tr></table></figure><p><strong>放到解压的原版IOS到某目录，添加ks文件</strong></p><p>我这里是用软碟通直接提取修改，所以就省略了</p><p>还有一个坑就是ks配置文件里面用cdrom参数制定本地光盘安装会报错，建议用url方式。这个坑踩得我受伤了，就不写了。</p><h3 id="应用服务服务脚本"><a href="#应用服务服务脚本" class="headerlink" title="应用服务服务脚本"></a>应用服务服务脚本</h3><p>  (1) 能接受四个参数：start, stop, restart, status<br>   start: 输出“starting 脚本名 finished.”<br>   …</p><p>  (2) 其它任意参数，均报错退出；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span>  <span class="keyword">in</span></span><br><span class="line">    start)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"starting <span class="variable">$0</span> finished"</span></span><br><span class="line">          ;;</span><br><span class="line"></span><br><span class="line">    stop)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"stopping <span class="variable">$0</span> finished"</span></span><br><span class="line">          ;;</span><br><span class="line"></span><br><span class="line">    restart)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"restarting <span class="variable">$0</span> finished"</span></span><br><span class="line">          ;;</span><br><span class="line"></span><br><span class="line">    status)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">" <span class="variable">$0</span> status"</span>                               </span><br><span class="line">          ;;</span><br><span class="line"></span><br><span class="line">        *)</span><br><span class="line">           <span class="built_in">echo</span> <span class="string">"Usage: <span class="variable">$prog</span> &#123;start|stop|restart|status&#125;"</span></span><br><span class="line">           <span class="built_in">exit</span> 1</span><br><span class="line">          ;;</span><br><span class="line"><span class="keyword">esac</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="判断给定的用户是否登录了当前系统"><a href="#判断给定的用户是否登录了当前系统" class="headerlink" title="判断给定的用户是否登录了当前系统"></a>判断给定的用户是否登录了当前系统</h3><p>  (1) 如果登录了，则显示用户登录，脚本终止；</p><p>  (2) 每3秒钟，查看一次用户是否登录；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">until who | grep <span class="string">"^logstash\&gt;"</span> &amp;&gt; /dev/null; <span class="keyword">do</span></span><br><span class="line">    sleep 3</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="显示用户选定要查看的信息；"><a href="#显示用户选定要查看的信息；" class="headerlink" title="显示用户选定要查看的信息；"></a>显示用户选定要查看的信息；</h3><p>   cpu) display cpu info</p><p>   mem) display memory info</p><p>   disk) display disk info</p><p>   quit) quit</p><p>   非此四项选择，则提示错误，并要求用户重新选择，只到其给出正确的选择为止；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">cat &lt;&lt; EOF</span><br><span class="line">Display information as following shown selection</span><br><span class="line">cpu) display cpu info</span><br><span class="line">mem) display memory info</span><br><span class="line">disk) display disk info</span><br><span class="line">quit) quit</span><br><span class="line">************************************************</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">"Please input your selection: "</span> selection</span><br><span class="line"></span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$selection</span> <span class="keyword">in</span></span><br><span class="line">    cpu) </span><br><span class="line">        lscpu</span><br><span class="line">        ;;</span><br><span class="line">    mem)</span><br><span class="line">        free -m</span><br><span class="line">        ;;</span><br><span class="line">    disk) </span><br><span class="line">        fdisk -l /dev/vd[a-z]</span><br><span class="line">        ;;</span><br><span class="line">    quit)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Bye Bye"</span></span><br><span class="line">        <span class="built_in">exit</span> 0</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Please input valid selection"</span></span><br><span class="line">        ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="尝试用shell函数"><a href="#尝试用shell函数" class="headerlink" title="尝试用shell函数"></a>尝试用shell函数</h3><p>  (1) 用函数实现返回一个用户的UID和SHELL；用户名通过参数传递而来；</p><p>  (2) 提示用户输入一个用户名或输入“quit”退出；</p><p>  当输入的是用户名，则调用函数显示用户信息；</p><p>  当用户输入quit，则退出脚本；进一步地：显示键入的用户相关信息后，再次提醒输出用户名或quit: </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">userInfo</span></span>() &#123;</span><br><span class="line">        <span class="built_in">local</span> userLine=$(grep <span class="variable">$1</span> /etc/passwd)</span><br><span class="line">        <span class="built_in">local</span> userSHELL=<span class="variable">$&#123;userLine##*:&#125;</span></span><br><span class="line">        <span class="built_in">local</span> userID=$(<span class="built_in">echo</span> <span class="variable">$userLine</span> | cut -f3 -d:)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"<span class="variable">$userSHELL</span> and <span class="variable">$userID</span>"</span></span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">quit</span></span>() &#123;</span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"<span class="variable">$1</span>"</span> == <span class="string">"quit"</span> ]; <span class="keyword">then</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"Bye Bye"</span></span><br><span class="line">        <span class="built_in">exit</span> 2</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="built_in">read</span> -p <span class="string">"Please input your username or input 'quit': "</span> choice</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ <span class="string">"<span class="variable">$choice</span>"</span> == <span class="string">"quit"</span> ]; <span class="keyword">then</span></span><br><span class="line">        quit <span class="variable">$choice</span></span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> id <span class="variable">$choice</span> &gt;&amp; /dev/null; <span class="keyword">then</span></span><br><span class="line">        userInfo <span class="variable">$choice</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="完成如下功能（使用shell函数）"><a href="#完成如下功能（使用shell函数）" class="headerlink" title="完成如下功能（使用shell函数）"></a>完成如下功能（使用shell函数）</h3><p>   (1) 提示用户输入一个可执行命令的名字；获取此命令依赖的所有库文件；</p><p>   (2) 复制命令文件至/mnt/sysroot目录下的对应的rootfs的路径上，例如，如果复制的文件原路径是/usr/bin/useradd，则复制到/mnt/sysroot/usr/bin/目录中；</p><p>   (3) 复制此命令依赖的各库文件至/mnt/sysroot目录下的对应的rootfs的路径上；规则同上面命令相关的要求；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">read</span> -p <span class="string">"Please input a command: "</span> cmd</span><br><span class="line"></span><br><span class="line">cmdPath=$(<span class="built_in">which</span> <span class="variable">$cmd</span> | grep bin)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cpCmd</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">cp <span class="variable">$cmdPath</span> /mnt/sysroot<span class="variable">$cmdpath</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Copy <span class="variable">$cmdPath</span> to path /mnt/sysroot/"</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">cpFile</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">libFile=$(ldd <span class="variable">$cmdPath</span> | grep -o <span class="string">"/[^[:space:]]\&#123;1,\&#125;"</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable">$libFile</span>; <span class="keyword">do</span></span><br><span class="line"></span><br><span class="line">    cp <span class="variable">$lib</span> /mnt/sysroot<span class="variable">$cmdPath</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Copy <span class="variable">$libFile</span> to path/mnt/sysroot/<span class="variable">$cmdPath</span>"</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cpCmd</span><br><span class="line"></span><br><span class="line">cpFile</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>CentOS系统的启动流程</title>
      <link href="/2018/08/05/CentOS%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/"/>
      <url>/2018/08/05/CentOS%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/</url>
      <content type="html"><![CDATA[<p>详细到每个过程系统做了哪些事情</p><a id="more"></a><p><img src="http://i.imgur.com/fCgoqDA.jpg" alt=""></p><p>启动过程 （PC架构）<br>   POST –&gt; Boot Sequence(BIOS) –&gt; Boot Loader (MBR)–&gt;GRUB—&gt; Kernel(ramdisk) –&gt; rootfs –&gt; switchroot –&gt; /sbin/init–&gt;(/etc/inittab, /etc/init/*.conf) –&gt; 设定默认运行级别&gt; 系统初始化脚本 –&gt; 关闭或启动对应级别下的服务 –&gt; 启动终端</p><p><strong>第一步：加电自检（POST）</strong></p><p>   系统加电之后，首先进行的硬件自检，一但通电后主板会自动读取ROM（只读）中的程序，进行加载，计算机会首先加载BIOS信息，BIOS信息是如此的重要，以至于计算机必须在最开始就找到它。检查各种硬件设备是否完整存在，如内存，硬盘，显示,IO设备等。如果有硬件故障的话将按两种情况理：对于严重故障(致命性故障)则停机，此时由于各种初始化操作还没完成，不能给出任何提示或信号；对于非严重故障则给出提示或声音报警信号，等待用户处理），如果没有故障，POST完成自己<br>的接力任务，将尾部工作交接给BIOS处理。</p><p><strong>第二步：系统引导过程Boot Sequence（BIOS）</strong></p><p>  POST 过程结束后，系统的控制权从 BISO 转交到 boot loader。Boot loader 一般存储在系统的硬盘上（传统的 BIOS/MBR 系统），这个时候机器不能获取外部的存储或者网络信息，一些重要的值（日期、时间、其他外部值）都是从CMOS里读取.</p><p>  POST（POST-power on self test)—&gt;ROM-&gt;CMOS(互补金属氧化物)-&gt;BIOS (Basic Input Output System，基础输入输出系统） </p><p>  BIOS（Basic Input/Output System）启动初始化硬件的工作，包括屏幕和键盘，内存检测，这个过程也被成为 POST（Power On Self Test），通过ROM加载自检程序，然后按照 CMOS RAM 中设置的启动设备查找顺序，来寻找可启动设备 。注：BIOS 程序嵌在主板的 ROM 芯片上的。</p><p><strong>第三步：启动加载器阶段Master Boot Loader(MBR)</strong></p><p> 硬盘上第0磁道第一个扇区被称为MBR，也就是Master Boot Record，即主引导记录，决定启动介质按照BIOS所设定的系统启动流程，根据引导次序(Boot Sequence)自上而下的寻找对应存储设备上操作系统的MBR。它的大小仅有512字节，但里面却存放了预启动信息、分区表信息。可分为两部分：</p><p>第一部分为引导（PRE-BOOT）区，占了 446个字节；</p><p>第二部分为分区表（PARTITION TABLE），共有64个字节，每个主分区占用16字节，记录硬盘的分区信息。（这就是为什么一块硬盘只能有4个主分区）分区表有效性标记会占用2字节。 </p><p>  预引导区的作用之一是找到标记为活动（ACTIVE）的分区，并将活动分区的引导区读入内存。剩余两个字节为结束标记。寻找 grub，读取配置文件/etc/grub.conf，决定默认启动项根据MBR所指引的活动分区上寻找系统分区中的 bootloader.在bootloader当中配置了所要引导操作系统的内核所在的位置，因此BIOS被载入内存以后，当它实现将控制权限转交给bootloader以后，bootloader接收整个系统的控制权限，而后根据用户的选择去读取相应操作系统中的内核，并将内核装载入内存的某个空间位置，解压缩，这时kernel就可以在内存中活动，并根据kernel本身功能在内存当中探索硬件并加载硬件驱动程序并完成内核初始化，bootloader会将控制权限转交给内核。 </p><p><strong>第四步：引导加载器阶段（GRUB加载器）</strong> </p><p>   对于GRUB来说，一个比较好的方面就是它包含了linux文件系统的支持。GRUB能够从ext2或者ext3文件系统中加载linux内核。一旦Bootloader的第一阶段已完成MBR（启动加载器阶段），并能找到实际的引导加载程序位置，第1阶段启动加载器加载引导程序到内存中开始第二阶段。GRUB引导加载器阶段它是通过将本来两阶段的boot loader转换成三个阶段的boot loader。</p><p>stage1个阶段 ：BIOS加载MBR里面的GRUB（属于第1阶段的文件），由于只有GRUB只占用446字节所以不能实现太多的功能，所以就有此阶段里面的文件来加载第1.5阶段的文件（/boot/grub下的文件）</p><p>stage1.5个阶段：这个阶段里面的就是加载识别文件系统的程序，来识别文件系统，不加载就无法识别文件系统，进而就找不到boot目录，由于GRUB是无法识别LVM，所以你不能把/boot分区设置为LVM，所以必须要把/boot单独分区    </p><p>stage2个阶段：这里面才是正在的开始寻找内核的过程，然后是启动内核</p><p>（当stage1.5的boot loader被加载并运行时，stage2 的boot loader才能被加载。）</p><p>   当stage2被加载时，GRUB能根据请求的情况显示一个可选内核的清单（在 /etc/grub.conf 中进行定义，同时还有几个软符号链接 /etc/grub/menu.lst 和 /etc/grub.conf)。你可以选择一个内核，修改其附加的内核参数。同时，你可以选择使用命令行的shell来对启动过程进行更深层次的手工控制。</p><p>GRUB的配置文件中的配置哪些信息</p><p> 在第二阶段boot loader加载到内存中后，就可以对文件系统进行查询了，同时，默认的内核镜像以及初始化内存盘镜像也被加载到内存中。</p><p>   根据grub设定的内核映像所在路径，系统读取内存映像，并进行解压缩操作。此时，屏幕一般会输出“Uncompressing Linux(解压内核中)”的提示。当解压缩内核完成后，屏幕输出“OK, booting the kernel(正在启动内核)”。</p><p><strong>第五步：加载kernel </strong></p><p>   GRUB把内核加载到内存后展开并运行，此时GRUB的任务已经完成，接下来内核将会接管并完成：</p><p>探测硬件—&gt;加载驱动—&gt;挂载根文件系统—&gt;切换至根文件系统（rootfs）—&gt;运行/sbin/init完成系统初始化</p><p>  内核一般都是压缩的，所以它的首要任务是解压缩，然后检查和分析系统的硬件并初始化内核里的硬件驱动程序。内核刚加载到内存的时候，文件系统还不能使用，它使用的是 Boot Loader 加载进内存的 initramfs。系统将解压后的内核放置在内存之中，并调用start_kernel()函数来启动一系列的初始化函数并初始化各种设备，完成Linux核心环境的建立。至此，Linux内核已经建立起来了，基于Linux的程序应该可以正常运行了。</p><p><strong>第六步：初始化initrd /etc/inittab</strong></p><p>  在核心加载完毕,进行完硬件侦测与驱动程序加载后,内核会启动第一个进程/sbin/init, init进程将会读取/etc/inittab，init进程是系统所有进程的起点，你可以把它比拟成系统所有进程的老祖宗，没有这个进程，系统中任何进程都不会启动。</p><p>  /etc/inittab最主要的功能就是准备软件运行的环境，包括系统的主机名称、网络配置、语系处理、文件系统格式及其他服务的启动等,而所有的动作都根据在/etc/inittab中的配置.将会执行/etc/inittab来设定系统运行的默认级别，</p><p>  init进程首先会读取/etc/inittab文件，根据inittab文件中的内容依次执行<br>  设定系统运行的默认级别（id:3:initdefault:）<br>  执行系统初始化脚本文件（si::sysinit:/etc/rc.d/rc.sysinit）<br>  执行在该运行级别下所启动或关闭对应的服务（l3:3:wait:/etc/rc.d/rc 3）<br>  启动6个虚拟终端</p><p>  0-6：7个级别的定义</p><p>  0：关机, shutdown</p><p>1：单用户模式(singleuser)，root用户，无须认证；维护模式；</p><p>2：多用户模式(multiuser)，会启动网络功能，但不会启动NFS；维护模式；</p><p>3：多用户模式(mutliuser)，完全功能模式；文本界面；</p><p>4：预留级别：目前无特别使用目的，但习惯以同3级别功能使用；</p><p>5：多用户模式(multi user)，完全功能模式，图形界面；</p><p>6：重启，reboot</p><p>许多程序需要开机启动。它们在Windows叫做”服务”（service），在Linux就叫做”守护进程”（daemon）。init进程的一大任务，就是去运行这些开机启动的程序。但是，不同的场合需要启动不同的程序，比如用作服务器时，需要启动Apache，用作桌面就不需要。</p><p>Linux允许为不同的场合，分配不同的开机启动程序，这就叫做”运行级别”（runlevel）。也就是说，启动时根据”运行级别”，确定要运行哪些程序。</p><p>要访问根文件系统必须要加载根文件系统所在的设备，而这时根文件系统又没有挂载，要挂载根文件系统有需要根文件系统的驱动程序，这是一个典型的先有鸡先有蛋的问题！为解决这个问题，GRUB在加载内核同时，也把initrd加载到内存中并运行.那么initrd又起到了什么作用哪？</p><p>initrd展开后的文件    </p><p>linux中/下的文件<br>       我们可以看到，其实initrd文件其实是一个虚拟的根文件系统，里面有bin、lib、lib64、sys、var、etc、sysroot、dev、proc、tmp等根目录，它的功能就是讲内核与真正的根建立联系，内核通过它加载根文件系统的驱动程序，然后以读写方式挂载根文件系统，至此，内核加载完成。</p><p><strong>第七步：运行/sbin/init，进行系统初始化</strong></p><p>   /sbin/init 最主要的功能就是准备软件运行的环境，包括系统的主机名称、网络配置、语系处理、文件系统格式及其他服务的启动等,而所有的动作都根据在/etc/inittab中的配置.init首先运行/etc/init/rcS.conf脚本</p><p><strong>第八步：启动系统服务/etc/rc.d/rc.sysinit</strong></p><p>可以看到，init进程通过执行/etc/rc.d/rcS.conf首先调用了/etc/rc.d/rc.sysinit，对系统做初始化设置，设置好整个系统环境。我们来看看这个脚本都是做了些什么哪？</p><p>   事实上init执行/etc/rc.d/rc.sysinit的初始化将会做很多设置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">1、获得网络环境 </span><br><span class="line"></span><br><span class="line">2、挂载设备 </span><br><span class="line"></span><br><span class="line">3、开机启动画面Plymouth（取替了过往的 RHGB） </span><br><span class="line"></span><br><span class="line">4、判断是否启用SELinux </span><br><span class="line"></span><br><span class="line">5、显示于开机过程中的欢迎画面 </span><br><span class="line"></span><br><span class="line">6、初始化硬件 </span><br><span class="line"></span><br><span class="line">7、用户自定义模块的加载 </span><br><span class="line"></span><br><span class="line">8、配置内核的参数 </span><br><span class="line"></span><br><span class="line">9、设置主机名 </span><br><span class="line"></span><br><span class="line">10、同步存储器 </span><br><span class="line"></span><br><span class="line">11、设备映射器及相关的初始化 </span><br><span class="line"></span><br><span class="line">12、初始化软件磁盘阵列（RAID） </span><br><span class="line"></span><br><span class="line">13、初始化 LVM 的文件系统功能 </span><br><span class="line"></span><br><span class="line">14、检验磁盘文件系统（fsck） </span><br><span class="line"></span><br><span class="line">15、设置磁盘配额(quota) </span><br><span class="line"></span><br><span class="line">16、重新以可读写模式挂载系统磁盘 </span><br><span class="line"></span><br><span class="line">17、更新quota（非必要） </span><br><span class="line"></span><br><span class="line">18、启动系统虚拟随机数生成器 </span><br><span class="line"></span><br><span class="line">19、配置机器（非必要） </span><br><span class="line"></span><br><span class="line">20、清除开机过程当中的临时文件 </span><br><span class="line"></span><br><span class="line">21、创建ICE目录 </span><br><span class="line"></span><br><span class="line">22、启动交换分区（swap） </span><br><span class="line"></span><br><span class="line">23、将开机信息写入/var/log/dmesg文件中</span><br></pre></td></tr></table></figure><p><strong>第九步：启动配置文件/etc/rc.d/rc.n</strong></p><p>设定完系统默认运行级别以后，接着调用/etc/rc.d/rc脚本，/etc/rc.d, 里面存放了rc.local, rc.sysinit, init.d, rcX.d (X包括0-6对应相对runlevel).这个脚本接收默认运行级别参数后，依脚本设置启用或停止/etc/rc.d/rc[0-6].d/中相应的程序。</p><p>/etc/rc.d/rc3].d/下的脚本文件在系统初始化阶段，脚本名字以K开头的,表示STOP动作（关闭）,名字以S开头,表示Start动作（启动）,文件名K/S 后面的的数字代表优先级，名称中的数字表示执行次序（优先级）,数字越小表示越先执行，优先级越高</p><p><strong>第十步：用户自定义开机启动程序 (/etc/rc.d/rc.local)</strong></p><p>  系统根据runlevel启动完rcX.d中的脚本之后,会调用rc.local脚本,如果你有一个脚本命令不论在3和5都想开机启动,那么就添加于此,免去rc3.d和rc5.d分别增加启动脚本工作量.最后，将执行/etc/rc.d/rc.local脚本，可以根据自己的需求将一些执行命令或者脚本写到其中，当开机时就可以加载。</p><p><strong>第十一步：打印登录提示符</strong></p><p>   系统初始化完成后，init给出用户登录提示符（login）或者图形化登录界面，用户输入用户和密码登陆后，系统会为用户分配一个用户ID（uid）和组ID（gid），这两个ID是用户的身份标识，用于检测用户运行程序时的身份验证。登录成功后，整个系统启动流程运行完毕！</p>]]></content>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>脚本小练</title>
      <link href="/2018/08/05/%E8%84%9A%E6%9C%AC%E5%B0%8F%E7%BB%83/"/>
      <url>/2018/08/05/%E8%84%9A%E6%9C%AC%E5%B0%8F%E7%BB%83/</url>
      <content type="html"><![CDATA[<p>1、判断当前系统上所有用户的shell是否为可登录shell（即用户的shell不是/sbin/nologin）；分别这两类用户的个数；通过字符串比较来实现；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#脚本内容</span></span><br><span class="line">[root@centos script]<span class="comment"># cat week9_title1.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author Jerry</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Display shell is nologin user's shell count </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"The shell is  nologin user count is <span class="variable">$(grep -o "nologin" /etc/passwd |wc -l)</span>"</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#Display shell not's nologin user's shell count </span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"The shell not's nologin user count is <span class="variable">$(grep -v "nologin" /etc/passwd |wc -l)</span>"</span> </span><br><span class="line"></span><br><span class="line"><span class="comment">#测试脚本</span></span><br><span class="line">[root@centos script]<span class="comment"># bash week9_title1.sh </span></span><br><span class="line">The shell is  nologin user count is 25</span><br><span class="line">The shell not<span class="string">'s nologin user count is 7</span></span><br><span class="line"><span class="string">[root@centos script]#</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>2、写一个脚本</p><p>(1) 获取当前主机的主机名，保存于hostname变量中；</p><p>(2) 判断此变量的值是否为localhost，如果是，则将当前主机名修改为<a href="http://www.docker.com；" target="_blank" rel="noopener">www.docker.com；</a></p><p>(3) 否则，则显示当前主机名；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@centos script]<span class="comment"># cat week9_title2.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author Jerry</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">hostname=$(hostname)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$hostname</span> == <span class="string">"localhost"</span> ];<span class="keyword">then</span></span><br><span class="line">hostname www.docker.com</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"current hostname is:<span class="variable">$hostname</span>"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"current hostname is:<span class="variable">$hostname</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">[root@centos script]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>3、写一个脚本，完成如下功能</p><p>(1) 传递一个磁盘设备文件路径给脚本，判断此设备是否存在；</p><p>(2) 如果存在，则显示此设备上的所有分区信息；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos script]<span class="comment"># cat week9_title3.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author Jerry</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[ <span class="variable">$#</span> -lt 1 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"please atleast input on"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -b <span class="variable">$1</span> ];<span class="keyword">then</span></span><br><span class="line">    fdisk -l <span class="variable">$1</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"nothing"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>​    </p><p>4、写一个脚本，完成如下功能, 脚本能够接受一个参数；</p><p>   (1) 如果参数1为quit，则显示退出脚本，并执行正常退出；</p><p>   (2) 如果参数1为yes，则显示继续执行脚本；</p><p>   (3) 否则，参数1为其它任意值，均执行非正常退出；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@centos script]<span class="comment"># bash week9_title4.sh </span></span><br><span class="line">please input one atleast</span><br><span class="line">error!!!!!</span><br><span class="line">[root@centos script]<span class="comment"># bash week9_title4.sh quit</span></span><br><span class="line"><span class="built_in">exit</span>....</span><br><span class="line">[root@centos script]<span class="comment"># bash week9_title4.sh yes</span></span><br><span class="line">go!go! go! </span><br><span class="line">[root@centos script]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line">[root@centos script]<span class="comment"># </span></span><br><span class="line">[root@centos script]<span class="comment"># cat week9_title4.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author Jerry</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">[ <span class="variable">$#</span> -eq 0 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"please input one atleast"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">yes)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"go!go! go! "</span></span><br><span class="line">;;</span><br><span class="line">    </span><br><span class="line">quit)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"exit...."</span></span><br><span class="line">    <span class="built_in">exit</span> 0</span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line">*)</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"error!!!!!"</span></span><br><span class="line">    <span class="built_in">exit</span> 2</span><br><span class="line">;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">esac</span></span><br><span class="line">[root@centos script]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>5、写一个脚本，完成如下功能</p><p>   传递一个参数给脚本，此参数为gzip、bzip2或者xz三者之一；</p><p>   (1) 如果参数1的值为gzip，则使用tar和gzip归档压缩/etc目录至/backups目录中，并命名为/backups/etc-20160613.tar.gz；</p><p>   (2) 如果参数1的值为bzip2，则使用tar和bzip2归档压缩/etc目录至/backups目录中，并命名为/backups/etc-20160613.tar.bz2；</p><p>   (3) 如果参数1的值为xz，则使用tar和xz归档压缩/etc目录至/backups目录中，并命名为/backups/etc-20160613.tar.xz；</p><p>   (4) 其它任意值，则显示错误压缩工具，并执行非正常退出；</p><p>​    </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@www /]<span class="comment"># cat /script/week9_title5.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">       <span class="built_in">echo</span> <span class="string">"give me a argument,the argument is gzip bzip2 xz "</span></span><br><span class="line">       <span class="built_in">exit</span> 19</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    mkdir /backups &amp;&gt; /dev/null</span><br><span class="line"></span><br><span class="line">       <span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">       gzip)</span><br><span class="line">        tar -zcvf  /backups/etc-`date +%Y%m%d`.tar.gz /etc</span><br><span class="line">        ;;</span><br><span class="line">       bzip2)</span><br><span class="line">        tar -jvf  /backups/etc-`date +%Y%m%d`.tar.bz2 /etc</span><br><span class="line">        ;;</span><br><span class="line">       xz)</span><br><span class="line">        tar -Jvf  /backups/etc-`date +%Y%m%d`.tar.xz /etc</span><br><span class="line">        ;;</span><br><span class="line">       *)</span><br><span class="line">         <span class="built_in">echo</span> <span class="string">"error!!!"</span></span><br><span class="line">         ;;</span><br><span class="line">       <span class="keyword">esac</span></span><br><span class="line">[root@www /]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>6、写一个脚本，接受一个路径参数：</p><p>   (1) 如果为普通文件，则说明其可被正常访问；</p><p>   (2) 如果是目录文件，则说明可对其使用cd命令；</p><p>   (3) 如果为符号链接文件，则说明是个访问路径；</p><p>   (4) 其它为无法判断；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@www script]<span class="comment"># cat week9_title6.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author Jerry</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Check whether the user is to script a path parameter</span></span><br><span class="line">[ <span class="variable">$#</span> -lt 1 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"Please give a path to the script parameters"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"这是一个普通文件，可以被正常访问"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> [ -d <span class="variable">$1</span> ];<span class="keyword">then</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"这是一个目录文件，可以使用cd命令"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> [ -h <span class="variable">$1</span> ];<span class="keyword">then</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"这是一个符号链接文件，它是一个访问路径"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">elif</span> [ ! -h <span class="variable">$1</span> ] &amp;&amp; [ ! -d <span class="variable">$1</span> ] &amp;&amp; [ ! -f <span class="variable">$1</span> ];<span class="keyword">then</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"这是什么鬼，不想跟你说话并向你扔了一只狗！！！"</span></span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>7、写一个脚本，取得当前主机的主机名，判断</p><p>   (1) 如果主机名为空或为localhost，或为””(none)””，则将其命名为mail.magedu.com；</p><p>   (2) 否则，显示现有的主机名即可；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">hostname=$(hostname)</span><br><span class="line"><span class="keyword">if</span> [ -z <span class="string">"<span class="variable">$hostname</span>"</span> -o <span class="string">"<span class="variable">$hostname</span>"</span> == <span class="string">"localhost"</span> -o  <span class="string">"<span class="variable">$hostname</span>"</span> == <span class="string">"none"</span> ];<span class="keyword">then</span></span><br><span class="line">    hostname mail.magedu.com</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"<span class="variable">$hostname</span>"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>8、写一脚本，接受一个用户名为参数；</p><p>   (1) 如果用户的id号为0,则显示其为管理员；</p><p>   (2) 如果用户的id号大于0且小于500, 则显示其为系统用户；</p><p>   (3) 否则，则显示其为普通用户；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"input argu"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">    userid=$(id -u)</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$userid</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"admin"</span></span><br><span class="line"><span class="keyword">elif</span> [ <span class="variable">$userid</span> -gt 0 -a <span class="variable">$userid</span> -lt 500 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"system"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"user"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>10、写一个脚本，传递一个用户名参数给脚本；</p><p>   (1) 如果用户的id号大于等于500，且其默认shell为以sh结尾的字符串，则显示“a user can log system.”类的字符串；</p><p>   (2) 否则，则显示无法登录系统；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"input argu"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line">    userid=grep ^<span class="variable">$1</span> /etc/passwd | grep sh$ | cut -d: -f3</span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$userid</span> -ge 500 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">" a user can log system"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"nologin"</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure><p>11、写一个脚本，完成如下任务 ：</p><p>   (1) 按顺序分别复制/var/log目录下的每个直接文件或子目录至/tmp/test1-testn目录中；</p><p>   (2) 复制目录时，才使用cp -r命令；</p><p>   (3) 复制文件时使用cp命令；</p><p>   (4) 复制链接文件时使用cp -d命令；</p><p>   (5) 余下的所有类型，使用cp -a命令；”</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">'ls /var/log'</span>;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> [ -d <span class="variable">$i</span> ];<span class="keyword">then</span></span><br><span class="line">        cp -r /var/<span class="built_in">log</span>/<span class="variable">$i</span> /tmp/<span class="built_in">test</span>/test1-testn/<span class="variable">$i</span></span><br><span class="line">    <span class="keyword">elif</span> [ -f <span class="variable">$i</span> ];<span class="keyword">then</span></span><br><span class="line">        cp /var/<span class="built_in">log</span>/<span class="variable">$i</span> /tmp/<span class="built_in">test</span>/test1-testn/<span class="variable">$i</span></span><br><span class="line">    <span class="keyword">elif</span> [ -L <span class="variable">$i</span> ];<span class="keyword">then</span></span><br><span class="line">        cp -d /var/<span class="built_in">log</span>/<span class="variable">$i</span> /tmp/<span class="built_in">test</span>/test1-testn/<span class="variable">$i</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        cp -a /var/<span class="built_in">log</span>/<span class="variable">$i</span> /tpm/<span class="built_in">test</span>/test1-testn/<span class="variable">$i</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>OSI七层模型及脚本小工具</title>
      <link href="/2018/08/02/%E8%84%9A%E6%9C%AC%E5%B0%8F%E5%B7%A5%E5%85%B7/"/>
      <url>/2018/08/02/%E8%84%9A%E6%9C%AC%E5%B0%8F%E5%B7%A5%E5%85%B7/</url>
      <content type="html"><![CDATA[<h3 id="网桥、集线器、二层交换机、三层交换机、路由器的功能、使用场景与区别。"><a href="#网桥、集线器、二层交换机、三层交换机、路由器的功能、使用场景与区别。" class="headerlink" title="网桥、集线器、二层交换机、三层交换机、路由器的功能、使用场景与区别。"></a>网桥、集线器、二层交换机、三层交换机、路由器的功能、使用场景与区别。</h3><p>集线器是属于物理层的设备，可以理解为一根网线中间串接出了多个接口，这么多接口共享这一根网线的带宽，<br>因此这些接口上的设备在使得网络时就会出现冲突，或者‘道路’挤占的情况。（所有的设备在一个广播域，冲突域中），集线器现在很少使用了。</p><p>交换机、网桥都是数据链路层的设备，网桥的出现就是为了解决集线器多个接口共处于一个冲突域的问题，网桥具有2个接口，<br>且每个接口设备发送接收数据都是独立的互不影响（每个接口是一个冲突域）。现在这种设备不再使用。<br>交换机可以理解为是一个多接口的网桥，当然具备了网桥分割冲突的功能（每个接口是一个冲突域）。<br>但是交换机（2层交换机）所有接口都在一个广播域中。</p><p>路由器属于网络层设备，路由器不但可以隔离冲突域，同时也可以隔离广播。每个接口是一个冲突域，一个广播域。<br>路由器对于广播数据包不做转发。路由器根据3层地址（现用的IP地址）进行转发数据包到相应的接口。实现不同的IP网段互相通讯。</p><p>二层交换机属数据链路层设备，可以识别数据包中的MAC地址信息，根据MAC地址进行转发，并将这些MAC地址与对应的端口记录在自己内部的一个地址表中。<a id="more"></a></p><p>三层交换机就是具有部分路由器功能的交换机，三层交换机的最重要目的是加快大型局域网内部的数据交换，<br>所具有的路由功能也是为这目的服务的，能够做到一次路由，多次转发。对于数据包转发等规律性的过程由硬件高速实现，<br>而像路由信息更新、路由表维护、路由计算、路由确定等功能，由软件实现。三层交换技术就是二层交换技术+三层转发技术。<br>传统交换技术是在OSI网络标准模型第二层–数据链路层进行操作的，<br>而三层交换技术是在网络模型中的第三层实现了数据包的高速转发，既可实现网络路由功能，又可根据不同网络状况做到最优网络性能。</p><h3 id="IP地址的分类及子网掩码的表示形式及其作用"><a href="#IP地址的分类及子网掩码的表示形式及其作用" class="headerlink" title="IP地址的分类及子网掩码的表示形式及其作用"></a>IP地址的分类及子网掩码的表示形式及其作用</h3><p><strong>IP地址分类</strong></p><p>一般分类是指ipv4,<br>IP地址有5类，A类到E类，各用在不同类型的网络中。地址分类反映了网络的大小以及数据包是单播还是组播的。</p><p>A类到C类地址用于单点编址方法，但每一类代表着不同的网络大小。<br>A类地址（1.0.0.0-126.255.255.255）用于最大型的网络，该网络的节点数可达16,777,216个。</p><p>B类地址（128.0.0.0-191.255.255.25 5）用于中型网络，节点数可达65,536个。</p><p>C类地址（192.0.0.0-223.255.255.255）用于256个节点以下的小型网络的单点网络通信。</p><p>D类地址并不反映网络的大小，只是用于组播，用来指定所分配的接收组播的节点组，这个节点组由组播订阅成员组成。<br>D类地址的范围为224.0.0.0-239.255.255.255。</p><p>E类（240.0.0.0-255.255.255.254）地址用于试验。</p><p><img src="http://i.imgur.com/CeQISYa.jpg" alt=""></p><p><strong>作用</strong></p><p>子网掩码是一个32位地址，是与IP地址结合使用的一种技术。</p><p>它的主要作用有两个，<br>一是用于屏蔽IP地址的一部分以区别网络标识和主机标识，并说明该IP地址是在局域网上，还是在远程网上。<br>二是用于将一个大的IP网络划分为若干小的子网络。</p><p>使用子网是为了减少IP的浪费。因为随着互联网的发展，越来越多的网络产生，有的网络多则几百台，<br>有的只有区区几台，这样就浪费了很多IP地址，所以要划分子网。使用子网可以提高网络应用的效率。</p><p>通过IP 地址的二进制与子网掩码的二进制进行与运算，确定某个设备的网络地址和主机号，<br>也就是说通过子网掩码分辨一个网络的网络部分和主机部分。</p><p>子网掩码一旦设置，网络地址和主机地址就固定了。子网一个最显著的特征就是具有子网掩码。<br>与IP地址相同，子网掩码的长度也是32位，也可以使用十进制的形式。<br>例如，为二进制形式的子网掩码：1111 1111.1111 1111.1111 1111.0000 0000，采用十进制的形式为：255.255.255.0。</p><p>通过计算机的子网掩码判断两台计算机是否属于同一网段的方法是，将计算机十进制的IP地址和子网掩码转换为二进制的形式，<br>然后进行二进制“与”(AND)计算（全1则得1，不全1则得0），如果得出的结果是相同的，那么这两台计算机就属于同一网段。</p><p><strong>子网掩码表现形式</strong></p><p>IP标识法<br>一个完整IP描述包含IP 地址和子网掩码</p><p>具体标识有两种</p><p>点分十进制<br>192.168.0.n  255.255.255.0（点分十进制） </p><p>这种暂时成为简写吧，懒人写法<br>192.168.0.n/24 （/24表示子网掩码二进制标识法中前面24位1）</p><h3 id="计算机网络的分层模型（OSI模型和TCP-IP模型）及每一层的功能及涉及到的物理设备有哪些。"><a href="#计算机网络的分层模型（OSI模型和TCP-IP模型）及每一层的功能及涉及到的物理设备有哪些。" class="headerlink" title="计算机网络的分层模型（OSI模型和TCP/IP模型）及每一层的功能及涉及到的物理设备有哪些。"></a>计算机网络的分层模型（OSI模型和TCP/IP模型）及每一层的功能及涉及到的物理设备有哪些。</h3><p><strong>OSI模型</strong></p><p><img src="http://i.imgur.com/YO5Nz0D.gif" alt=""></p><p><strong>常见对应各层的设备</strong><br>   物理层：网卡，网线，集线器，中继器，调制解调器</p><p>   数据链路层：网桥，交换机</p><p>   网络层：路由器</p><p>   网关工作在第四层传输层及其以上</p><p><strong>物理层</strong><br>在OSI参考模型中，物理层（Physical Layer）是参考模型的最低层，也是OSI模型的第一层。</p><p>物理层的主要功能是：<br>利用传输介质为数据链路层提供物理连接，实现比特流的透明传输。物理层的作用是实现相邻计算机节点之间比特流的透明传送，尽可能屏蔽掉具体传输介质和物理设备的差异。使其上面的数据链路层不必考虑网络的具体传输介质是什么。“透明传送比特流”表示经实际电路传送后的比特流没有发生变化，对传送的比特流来说，这个电路好像是看不见的。</p><p><strong>数据链路层</strong><br>数据链路层（Data Link Layer）是OSI模型的第二层，负责建立和管理节点间的链路。该层的主要功能是：通过各种控制协议，将有差错的物理信道变为无差错的、能可靠传输数据帧的数据链路。<br>在计算机网络中由于各种干扰的存在，物理链路是不可靠的。因此，这一层的主要功能是在物理层提供的比特流的基础上，通过差错控制、流量控制方法，使有差错的物理线路变为无差错的数据链路，即提供可靠的通过物理介质传输数据的方法。</p><p>该层通常又被分为介质访问控制（MAC）和逻辑链路控制（LLC）两个子层。</p><p>1、MAC子层的主要任务是解决共享型网络中多用户对信道竞争的问题，完成网络介质的访问控制；</p><p>2、LC子层的主要任务是建立和维护网络连接，执行差错校验、流量控制和链路控制。</p><p>数据链路层的具体工作是接收来自物理层的位流形式的数据，并封装成帧，传送到上一层；同样，也将来自上层的数据帧，拆装为位流形式的数据转发到物理层；并且，还负责处理接收端发回的确认帧的信息，以便提供可靠的数据传输。</p><p><strong>网络层</strong><br>网络层（Network Layer）是OSI模型的第三层，它是OSI参考模型中最复杂的一层，也是通信子网的最高一层。它在下两层的基础上向资源子网提供服务。其主要任务是：通过路由选择算法，为报文或分组通过通信子网选择最适当的路径。该层控制数据链路层与传输层之间的信息转发，建立、维持和终止网络的连接。具体地说，数据链路层的数据在这一层被转换为数据包，然后通过路径选择、分段组合、顺序、进/出路由等控制，将信息从一个网络设备传送到另一个网络设备。<br>一般地，数据链路层是解决同一网络内节点之间的通信，而网络层主要解决不同子网间的通信。例如在广域网之间通信时，必然会遇到路由（即两节点间可能有多条路径）选择问题。 </p><p>在实现网络层功能时，需要解决的主要问题如下：<br>寻址：<br>数据链路层中使用的物理地址（如MAC地址）仅解决网络内部的寻址问题。在不同子网之间通信时，为了识别和找到网络中的设备，每一子网中的设备都会被分配一个唯一的地址。由于各子网使用的物理技术可能不同，因此这个地址应当是逻辑地址（如IP地址）。</p><p>交换：<br>规定不同的信息交换方式。常见的交换技术有：线路交换技术和存储转发技术，后者又包括报文交换技术和分组交换技术。</p><p>路由算法：<br>当源节点和目的节点之间存在多条路径时，本层可以根据路由算法，通过网络为数据分组选择最佳路径，并将信息从最合适的路径由发送端传送到接收端。</p><p>连接服务：<br>与数据链路层流量控制不同的是，前者控制的是网络相邻节点间的流量，后者控制的是从源节点到目的节点间的流量。其目的在于防止阻塞，并进行差错检测。</p><p><strong>传输层</strong><br>OSI下3层的主要任务是数据通信，上3层的任务是数据处理。而传输层（Transport Layer）是OSI模型的第4层。因此该层是通信子网和资源子网的接口和桥梁，起到承上启下的作用。</p><p>该层的主要任务是：<br>向用户提供可靠的端到端的差错和流量控制，保证报文的正确传输。传输层的作用是向高层屏蔽下层数据通信的细节，即向用户透明地传送报文。该层常见的协议：TCP/IP中的TCP协议、Novell网络中的SPX协议和微软的NetBIOS/NetBEUI协议。</p><p>传输层提供会话层和网络层之间的传输服务，这种服务从会话层获得数据，并在必要时，对数据进行分割。然后，传输层将数据传递到网络层，并确保数据能正确无误地传送到网络层。因此，传输层负责提供两节点之间数据的可靠传送，当两节点的联系确定之后，传输层则负责监督工作。</p><p>综上，传输层的主要功能如下：<br>传输连接管理：提供建立、维护和拆除传输连接的功能。传输层在网络层的基础上为高层提供“面向连接”和“面向无接连”的两种服务。</p><p>处理传输差错：提供可靠的“面向连接”和不太可靠的“面向无连接”的数据传输服务、差错控制和流量控制。在提供“面向连接”服务时，通过这一层传输的数据将由目标设备确认，如果在指定的时间内未收到确认信息，数据将被重发，监控服务质量。</p><p><strong>会话层</strong><br>会话层（Session Layer）是OSI模型的第5层，是用户应用程序和网络之间的接口，主要任务是：向两个实体的表示层提供建立和使用连接的方法。将不同实体之间的表示层的连接称为会话。因此会话层的任务就是组织和协调两个会话进程之间的通信，并对数据交换进行管理。<br>用户可以按照半双工、单工和全双工的方式建立会话。当建立会话时，用户必须提供他们想要连接的远程地址。而这些地址与MAC（介质访问控制子层）地址或网络层的逻辑地址不同，它们是为用户专门设计的，更便于用户记忆。域名（DN）就是一种网络上使用的远程地址例如：<a href="http://www.163.com就是一个域名。" target="_blank" rel="noopener">www.163.com就是一个域名。</a></p><p>会话层的具体功能如下：</p><p>会话管理：<br>允许用户在两个实体设备之间建立、维持和终止会话，并支持它们之间的数据交换。例如提供单方向会话或双向同时会话，并管理会话中的发送顺序，以及会话所占用时间的长短。</p><p>会话流量控制：<br>提供会话流量控制和交叉会话功能。</p><p>寻址：<br>使用远程地址建立会话连接。</p><p>出错控制：<br>从逻辑上讲会话层主要负责数据交换的建立、保持和终止，但实际的工作却是接收来自传输层的数据，并负责纠正错误。会话控制和远程过程调用均属于这一层的功能。但应注意，此层检查的错误不是通信介质的错误，而是磁盘空间、打印机缺纸等类型的高级错误。</p><p><strong>表示层</strong><br>表示层（Presentation Layer）是OSI模型的第六层，它对来自应用层的命令和数据进行解释，对各种语法赋予相应的含义，并按照一定的格式传送给会话层。其主要功能是“处理用户信息的表示问题，如编码、数据格式转换和加密解密”等。</p><p>表示层的具体功能如下：</p><p>数据格式处理：<br>协商和建立数据交换的格式，解决各应用程序之间在数据格式表示上的差异。</p><p>数据的编码：<br>处理字符集和数字的转换。例如由于用户程序中的数据类型（整型或实型、有符号或无符号等）、用户标识等都可以有不同的表示方式，因此，在设备之间需要具有在不同字符集或格式之间转换的功能。</p><p>压缩和解压缩：<br>为了减少数据的传输量，这一层还负责数据的压缩与恢复。</p><p>数据的加密和解密：<br>可以提高网络的安全性。</p><p><strong>应用层</strong><br>应用层（Application Layer）是OSI参考模型的最高层，它是计算机用户，以及各种应用程序和网络之间的接口，其功能是直接向用户提供服务，完成用户希望在网络上完成的各种工作。它在其他6层工作的基础上，负责完成网络中应用程序与网络操作系统之间的联系，建立与结束使用者之间的联系，并完成网络用户提出的各种网络服务及应用所需的监督、管理和服务等各种协议。此外，该层还负责协调各个应用程序间的工作。<br>应用层为用户提供的服务和协议有：文件服务、目录服务、文件传输服务（FTP）、远程登录服务（Telnet）、电子邮件服务（E-mail）、打印服务、安全服务、网络管理服务、数据库服务等。上述的各种网络服务由该层的不同应用协议和程序完成，不同的网络操作系统之间在功能、界面、实现技术、对硬件的支持、安全可靠性以及具有的各种应用程序接口等各个方面的差异是很大的。</p><p>应用层的主要功能如下：</p><p>用户接口：<br>应用层是用户与网络，以及应用程序与网络间的直接接口，使得用户能够与网络进行交互式联系。<br>实现各种服务：该层具有的各种应用程序可以完成和实现用户请求的各种服务。</p><p><strong>OSI 7层模型的小结</strong><br>由于OSI是一个理想的模型，因此一般网络系统只涉及其中的几层，很少有系统能够具有所有的7层，并完全遵循它的规定。<br>在7层模型中，每一层都提供一个特殊的网络功能。从网络功能的角度观察：下面4层（物理层、数据链路层、网络层和传输层）主要提供数据传输和交换功能，即以节点到节点之间的通信为主；第4层作为上下两部分的桥梁，是整个网络体系结构中最关键的部分；而上3层（会话层、表示层和应用层）则以提供用户与应用程序之间的信息和数据处理功能为主。简言之，下4层主要完成通信子网的功能，上3层主要完成资源子网的功能。</p><p><strong>TCP/IP模型</strong></p><p><img src="http://i.imgur.com/EoJ2Exf.jpg" alt=""></p><p><strong>TCP/IP模型包括4层：</strong></p><p>　　网络接口层–对应OSI参考模型的物理层和数据链路层；</p><p>　　网络层–对应OSI参考模型的网络层；</p><p>　　运输层–对应OSI参考模型的运输层；</p><p>　　应用层–对应OSI参考模型的5、6、7层。</p><p><strong>TCP/IP协议的主要特点如下：</strong></p><p><strong>高可靠性</strong></p><p>TCP/IP采用重新确认的方法保证数据的可靠传输，并采用“窗口”流量控制机制使可靠性得到进一步保证。</p><p><strong>安全性</strong></p><p>为建立TCP连接，在连接的每一端都必须与该连接的安全性控制达成一致。IP在它的控制分组头中有若干字段允许有选择地对传输的信息实施保护。</p><p><strong>灵活性</strong></p><p>TCP/IP要求下层支持该协议，而对上层应用协议不作特殊要求。因此，TCP/IP的使用不受传输介质和网络应用软件的限制。</p><p><strong>总结</strong></p><p>从网络通信的观点来看，Internet是一个由TCP/IP把各个国家、机构、部门的内部网络连接起来的庞大的数据通信网； 从信息资源的角度来看，Internet是一个集各个领域、部门内各种信息资源，以共享为目的的信息资源网；从技术的角度来看，Internet是一个“不同网络互连的网络（网际网）”,是由许多网络（包括局域网、城域网和广域网）互连形成的。</p><h3 id="下面来看看网络的相关操作和脚本"><a href="#下面来看看网络的相关操作和脚本" class="headerlink" title="下面来看看网络的相关操作和脚本"></a>下面来看看网络的相关操作和脚本</h3><h3 id="将Linux主机接入到TCP-IP网络的步骤。（手动指定的方式）"><a href="#将Linux主机接入到TCP-IP网络的步骤。（手动指定的方式）" class="headerlink" title="将Linux主机接入到TCP/IP网络的步骤。（手动指定的方式）"></a>将Linux主机接入到TCP/IP网络的步骤。（手动指定的方式）</h3><p><strong>我就不瞎BB了，直接上操作步骤，分centos和ubuntu两种操作系统，这是一道送分题。</strong></p><p>总体来说有以下几步：</p><p>1、配置IP地址和掩码</p><p>2、配置网关</p><p>3、配置dns的IP地址</p><p><strong>CentOS6</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line"></span><br><span class="line">TYPE=Ethernet        <span class="comment">#90%以上都是以太网啦</span></span><br><span class="line">BOOTPROTO=none       <span class="comment">#如果是自动获取，此处是DHCP，手动指定就是none</span></span><br><span class="line">IPADDR=192.168.0.243 <span class="comment">#修改此处</span></span><br><span class="line">PREFIX=24            <span class="comment">#修改此处</span></span><br><span class="line">GATEWAY=192.168.0.1  <span class="comment">#修改此处</span></span><br><span class="line">DNS1=202.103.44.150  <span class="comment">#修改此处</span></span><br><span class="line">DNS2=202.103.24.68   <span class="comment">#修改此处</span></span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=yes</span><br><span class="line">IPV6INIT=no</span><br><span class="line">NAME=eth0</span><br><span class="line">UUID=b33d04cb-b415-4874-b5a2-e201bb20b46e   <span class="comment">#网卡的唯一标识</span></span><br><span class="line">ONBOOT=yes          <span class="comment">#是否开机启动</span></span><br><span class="line"></span><br><span class="line">最后：wq  保存退出，  再执行 service network restart  <span class="comment">#使其生效</span></span><br></pre></td></tr></table></figure><p><strong>Ubuntu 14.04</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># vim /etc/network/interfaces   #配置IP、掩码、网关</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># This file describes the network interfaces available on your system</span></span><br><span class="line"><span class="comment"># and how to activate them. For more information, see interfaces(5).</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The loopback network interface</span></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line"><span class="comment"># The primary network interface</span></span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet static</span><br><span class="line">address 192.168.0.245</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line">gateway 192.168.0.1</span><br><span class="line"></span><br><span class="line">root@ubuntu:~<span class="comment"># vim /etc/resolvconf/resolv.conf.d/base   #配置DNS</span></span><br><span class="line"></span><br><span class="line">nameserver 202.103.24.68</span><br><span class="line">nameserver 202.103.44.150</span><br><span class="line"></span><br><span class="line">最后：wq  保存退出</span><br><span class="line"></span><br><span class="line">root@ubuntu:~<span class="comment"># service networking restart   #使其生效</span></span><br></pre></td></tr></table></figure><p>​    </p><h3 id="为Linux主机配置网络信息的方式"><a href="#为Linux主机配置网络信息的方式" class="headerlink" title="为Linux主机配置网络信息的方式"></a>为Linux主机配置网络信息的方式</h3><p>方法一：使用ifconfig或者ip 临时添加网络信息，并使用route命令添加默认网关</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">**注意：所有操作均使用root用户**</span><br><span class="line">修改IP：</span><br><span class="line">ifconfig eth0 192.168.0.66</span><br><span class="line">则直接将第一张网卡的IP修改成192.168.0.66</span><br><span class="line"></span><br><span class="line">增加IP：</span><br><span class="line">ifconfig eth0 add 192.168.2.77 <span class="comment">#增加一个IP</span></span><br><span class="line">ifconfig eth0:0 broadcast 192.168.2.255 <span class="comment">##修改刚刚增加IP的广播地址</span></span><br><span class="line"></span><br><span class="line">再增加一个IP：</span><br><span class="line">ifconfig eth0:0 add 10.10.44.145</span><br><span class="line">ifconfig eth0:0:1 broadcast 10.10.44.255 <span class="comment">#修改刚刚增加IP的广播地址</span></span><br><span class="line"></span><br><span class="line">上述增加完，立刻生效，但是机器重新启动后，就无效了。</span><br><span class="line">route add -net 192.168.0.0/24 gw 192.168.0.1 dev eth1 <span class="comment">#增加网关</span></span><br><span class="line"></span><br><span class="line">[root@centos ~]<span class="comment"># vim /etc/resolv.conf  #增加dns</span></span><br><span class="line">[root@centos ~]<span class="comment"># cat /etc/resolv.conf </span></span><br><span class="line"><span class="comment">#Generated by NetworkManager</span></span><br><span class="line">nameserver 202.103.44.150</span><br><span class="line">nameserver 202.103.24.68</span><br></pre></td></tr></table></figure><p>​    不过这种方法是临时的，服务器一重启就失效了</p><p>​    </p><p>方法二：使用修改/etc/sysconfig/network-scripts/ifcfg-IF_NAME文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># vim /etc/sysconfig/network-scripts/ifcfg-eth0</span></span><br><span class="line">ifcfg-IFACE 配置文件参数：</span><br><span class="line">DEVICE：此配置文件对应的设备的名称；</span><br><span class="line">ONBOOT：在系统引导过程中，是否激活此接口；</span><br><span class="line">UUID：此设备的惟一标识；</span><br><span class="line">IPV6INIT：是否初始化 IPv6；</span><br><span class="line">BOOTPROTO：激活此接口时使用什么协议来配置接口属性，常用的有 dhcp、bootp、</span><br><span class="line">static、none；</span><br><span class="line">TYPE：接口类型，常见的有 Ethernet, Bridge；</span><br><span class="line">DNS1：第一 DNS 服务器指向；</span><br><span class="line">DNS2：备用 DNS 服务器指向；</span><br><span class="line">DOMAIN：DNS 搜索域；</span><br><span class="line">IPADDR： IP 地址；</span><br><span class="line">NETMASK：子网掩码；CentOS 7 支持使用 PREFIX 以长度方式指明子网掩码；</span><br><span class="line">GATEWAY：默认网关；</span><br><span class="line">USERCTL：是否允许普通用户控制此设备；</span><br><span class="line">PEERDNS：如果 BOOTPROTO 的值为“dhcp”，是否允许 dhcp server 分配的 dns 服务器指</span><br><span class="line">向覆盖本地手动指定的 DNS 服务器指向；默认为允许；</span><br><span class="line">HWADDR：设备的 MAC 地址；     </span><br><span class="line"></span><br><span class="line">[root@centos ~]<span class="comment"># cat /etc/resolv.conf #示例</span></span><br><span class="line"><span class="comment"># Generated by NetworkManager</span></span><br><span class="line">nameserver 202.103.44.150</span><br><span class="line">nameserver 202.103.24.68</span><br><span class="line">[root@centos ~]<span class="comment"># cat /etc/sysconfig/network-scripts/ifcfg-eth0 </span></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">IPADDR=192.168.0.243</span><br><span class="line">PREFIX=24</span><br><span class="line">GATEWAY=192.168.0.1</span><br><span class="line">DNS1=202.103.44.150</span><br><span class="line">DNS2=202.103.24.68</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=yes</span><br><span class="line">IPV6INIT=no</span><br><span class="line">NAME=eth0</span><br><span class="line">UUID=b33d04cb-b415-4874-b5a2-e201bb20b46e</span><br><span class="line">ONBOOT=yes</span><br></pre></td></tr></table></figure><p>一般最常用的就是这两种了。</p><h3 id="用ping命令探测172-16-250-1-172-16-250-254之间的所有主机的在线状态；在线的主机使用绿色显示；不在线的主使用红色显示"><a href="#用ping命令探测172-16-250-1-172-16-250-254之间的所有主机的在线状态；在线的主机使用绿色显示；不在线的主使用红色显示" class="headerlink" title="用ping命令探测172.16.250.1-172.16.250.254之间的所有主机的在线状态；在线的主机使用绿色显示；不在线的主使用红色显示"></a>用ping命令探测172.16.250.1-172.16.250.254之间的所有主机的在线状态；在线的主机使用绿色显示；不在线的主使用红色显示</h3><p>一开始我很茫然，无从下手，用for循环，记得for循环大了会占用内存空间，例如ping B类局域网地址的话，就想着不用for，用while或者until实现可否，折腾了一天多的时间（处女座作的），精益求精，经过N次死循环及失败，于是有了下面的脚本:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[root@centos Jerry_go]<span class="comment"># wc -l ping4.sh </span></span><br><span class="line">14 ping4.sh</span><br><span class="line">[root@centos Jerry_go]<span class="comment"># cat ping4.sh </span></span><br><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment">#ping IP</span></span><br><span class="line"><span class="comment">#Author Jerry</span></span><br><span class="line"></span><br><span class="line">ip=0</span><br><span class="line"><span class="keyword">while</span> [ <span class="variable">$ip</span> -lt 254 ];<span class="keyword">do</span></span><br><span class="line">ip=$[<span class="variable">$ip</span>+1] </span><br><span class="line">ping -c 2 192.168.0.<span class="variable">$ip</span> &gt;&gt; /dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? == 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;32m 192.168.0.<span class="variable">$ip</span> ok \e[0m"</span> &amp;&amp; <span class="built_in">continue</span> </span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;31m 192.168.0.<span class="variable">$ip</span> no response \e[0m"</span> &amp;&amp; <span class="built_in">continue</span> </span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@centos Jerry_go]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>执行效果：</p><p><img src="http://i.imgur.com/SEJr8bx.png" alt=""></p><p><strong>用for实现</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@centos Jerry_go]<span class="comment"># cat ping.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#ping ip</span></span><br><span class="line"><span class="comment">#Author Jerry</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((i=1;i&lt;255;i++));<span class="keyword">do</span></span><br><span class="line">    ping -w 1 -c 1 172.16.250.<span class="variable">$i</span> &amp;&gt;/dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\e[1;32m 172.16.250.<span class="variable">$i</span> ok \e[0m"</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> -e <span class="string">"\e[1;31m 172.16.250.<span class="variable">$i</span> no response \e[0m"</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">[root@centos Jerry_go]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>经测试效果一样</p><h3 id="描述每个网络接口的配置文件中各个参数的含义和其所对应的值"><a href="#描述每个网络接口的配置文件中各个参数的含义和其所对应的值" class="headerlink" title="描述每个网络接口的配置文件中各个参数的含义和其所对应的值"></a>描述每个网络接口的配置文件中各个参数的含义和其所对应的值</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ifcfg-IFACE配置文件参数：</span><br><span class="line">DEVICE：此配置文件对应的设备的名称；</span><br><span class="line">ONBOOT：在系统引导过程中，是否激活此接口；</span><br><span class="line">UUID：此设备的惟一标识；</span><br><span class="line">IPV6INIT：是否初始化IPv6；</span><br><span class="line">BOOTPROTO：激活此接口时使用什么协议来配置接口属性，常用的有dhcp、bootp、static、none；</span><br><span class="line">TYPE：接口类型，常见的有Ethernet, Bridge；</span><br><span class="line">DNS1：第一DNS服务器指向；</span><br><span class="line">DNS2：备用DNS服务器指向；</span><br><span class="line">DOMAIN：DNS搜索域；</span><br><span class="line">IPADDR： IP地址；</span><br><span class="line">NETMASK：子网掩码；CentOS 7支持使用PREFIX以长度方式指明子网掩码；</span><br><span class="line">GATEWAY：默认网关；</span><br><span class="line">USERCTL：是否允许普通用户控制此设备；</span><br><span class="line">PEERDNS：如果BOOTPROTO的值为“dhcp”，是否允许dhcp server分配的dns服务器指向覆盖本地手动指定的DNS服务器指向；默认为允许；</span><br><span class="line">HWADDR：设备的MAC地址；</span><br><span class="line"></span><br><span class="line">NM_CONTROLLED：是否使用NetworkManager服务来控制接口；</span><br></pre></td></tr></table></figure><h3 id="给网络接口配置多个地址，有哪些方式？"><a href="#给网络接口配置多个地址，有哪些方式？" class="headerlink" title="给网络接口配置多个地址，有哪些方式？"></a>给网络接口配置多个地址，有哪些方式？</h3><p>这个也分快捷跟永久两种方式。主要用到ifconfig</p><p>快捷方式呢，即生效，如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># ifconfig eth0:0 192.168.3.243 netmask 255.255.255.0 up </span></span><br><span class="line">[root@centos ~]<span class="comment"># ifconfig eth0:1 192.168.3.2 netmask 255.255.255.0 up </span></span><br><span class="line">[root@centos ~]<span class="comment"># ip addr show  #查看网卡IP地址方法一</span></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link/ether 00:0c:29:04:bd:c1 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.0.243/24 brd 192.168.0.255 scope global eth0</span><br><span class="line">    inet 192.168.3.243/24 brd 192.168.3.255 scope global eth0:0</span><br><span class="line">    inet 192.168.3.2/24 brd 192.168.3.255 scope global secondary eth0:1</span><br><span class="line">[root@centos ~]<span class="comment"># ifconfig #查看网卡IP地址方法二</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 00:0C:29:04:BD:C1  </span><br><span class="line">          inet addr:192.168.0.243  Bcast:192.168.0.255  Mask:255.255.255.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:8122248 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:51751 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:526472342 (502.0 MiB)  TX bytes:3884350 (3.7 MiB)</span><br><span class="line"></span><br><span class="line">eth0:0    Link encap:Ethernet  HWaddr 00:0C:29:04:BD:C1  </span><br><span class="line">          inet addr:192.168.3.243  Bcast:192.168.3.255  Mask:255.255.255.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line"></span><br><span class="line">eth0:1    Link encap:Ethernet  HWaddr 00:0C:29:04:BD:C1  </span><br><span class="line">          inet addr:192.168.3.2  Bcast:192.168.3.255  Mask:255.255.255.0</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:290 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:290 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:26660 (26.0 KiB)  TX bytes:26660 (26.0 KiB)</span><br><span class="line"></span><br><span class="line">[root@centos ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>永久方式呢，稍微麻烦点，不过永久嘛，一劳永逸，值得</p><p>是仿照/etc/sysconfig/network-scripts/ifcfg-eth0增加一文件根据网络虚拟接口的名字进行命名<br>例如ifcfg-eth0:0或者ifcfg-eth0:1等等 </p><p><strong>开始飙车了啊，系好安全带！</strong></p><p><img src="http://i.imgur.com/XtjrnlJ.gif" alt=""></p><p><strong>[root@centos ~]# cd /etc/sysconfig/network-scripts/</strong></p><p><strong>[root@centos network-scripts]# cp ifcfg-eth0 ifcfg-eth0:0</strong></p><p><img src="http://i.imgur.com/fmsMaXU.png" alt=""></p><p><strong>[root@centos network-scripts]# vim ifcfg-eth0:0</strong></p><p><img src="http://i.imgur.com/Sppht0x.png" alt=""></p><p>保存退出，重启系统，再看。应该是没问题的啦。</p><h3 id="常用的网络管理类工具及使用方法。"><a href="#常用的网络管理类工具及使用方法。" class="headerlink" title="常用的网络管理类工具及使用方法。"></a>常用的网络管理类工具及使用方法。</h3><p>ifconfig命令:接口及地址查看和管理</p><p>可以使用ifconfig命令配置网卡属性,设置后立即生效，重启后失效。</p><p>显示活动接口信息 ifconfig eth0</p><p>显示所有接口信息 ifconfig -a</p><p>启用或禁用给定接口 ifconfig eth0 up/down</p><p>设置IP地址及掩码 ifconfig eth0 172.168.1.100/24</p><p>route命令：路由查看及管理</p><p>添加主机路由 route add -host 192.168.1.3 gw 172.16.0.1 dev eth0</p><p>添加网络路由 route add -net 192.168.0.0/24 gw 172.16.0.1 dev eth0</p><p>添加默认路由 route add default gw 172.16.0.1</p><p>删除主机路由 route del -host 192.168.1.3</p><p>删除网络路由 route del -net 192.168.0.0 netmask 255.255.255.0</p><p>netstat命令:打印网络连接，路由表，接口统计信息</p><p>以数字形式显示TCP协议相关所有状态 netstat -tan</p><p>以数字形式显示UDP协议相关所有状态 netstat -uan</p><p>以数字形式显示TCP协议相关的监听状态 netstat -tnl</p><p>以数字形式显示UDP协议相关的监听状态 netstat -unl</p><p>显示内核路由表 netstat -r</p><p>显示所有接口统计数据 netstat -i</p><p>显示指定接口信息 netstat -I eth0</p><p>dig命令:解析DNS地址工具</p><p>正解DNS 域名至IP地址 dig -t A <a href="http://www.magedu.com" target="_blank" rel="noopener">www.magedu.com</a></p><p>反解DNS IP地址至域名 dig -x 127.0.0.1</p><p>ip命令:显示/操纵路由，设备，策略路由和隧道</p><p>禁用接口 ip link set dev eth0 down</p><p>启用接口 ip link set dev eth0 up</p><p>显示接口信息 ip link show dev eth0</p><p>显示主地址 ip addr show dev eth0 primary</p><p>显示次地址 ip addr show dev eth0 secondary</p><p>添加IP地址 ip addr add 172.16.100.13/16 dev eth0</p><p>添加网卡别名 ip addr add 172.16.100.13/16 dev eth0 label ‘eth:0’</p><p>删除别名 ip addr flush dev eth0 label ‘eth0:0’</p><p>添加主路由 ip route add 192.168.1.3 via 172.16.0.1 dev eth0</p><p>添加网络路由 ip route add 192.168.0.0/16 via 172.16.0.1 dev eth0</p><p>添加默认路由 ip route add default via 127.16.0.1</p><p>删除路由 ip route del 192.168.1.3</p><p>查看路由 ip route show</p><p>清空路由 ip route flush dev eth0</p><p>ss命令:显示网络连接工具<br>参数用法同netstat</p><p>指定显示某种状态ss -t state established ‘( dport = :ssh or sport = :ssh )’</p><h3 id="Linux系统软件包管理方法（安装、升级、卸载等操作）"><a href="#Linux系统软件包管理方法（安装、升级、卸载等操作）" class="headerlink" title="Linux系统软件包管理方法（安装、升级、卸载等操作）"></a>Linux系统软件包管理方法（安装、升级、卸载等操作）</h3><p>Linux的软件系统包管理那就好玩了，根据这多年的使用经验，主要分为yum和apt两大系列，</p><p>Debian 及其衍生产品如：Ubuntu、Linux Mint 和 Raspbian 的包格式为.deb文件，APT 是最常见包操作命令，可：搜索库、安装包及其依赖和管理升级,而要直接安装现成.deb包时需要使用dpkg命令。</p><p>APT还自吹有超级牛力，有图有真相:</p><p><img src="http://i.imgur.com/YTRW8SC.png" alt=""></p><p>CentOS、Fedora 及 Red Hat 系列 Linux 使用RPM包文件，并使用yum命令管理包文件及与软件库交互。在最新的 Fedora 版本中，yum命令已被dnf取代进行包管理,而要直接安装现成.rpm包时需要使用rpm命令。</p><p>好嘛，都是利器啊。下边且看我分解。</p><p><img src="http://i.imgur.com/8bK5w7n.gif" alt=""></p><h3 id="RPM-包的安装-升级-查询-卸载"><a href="#RPM-包的安装-升级-查询-卸载" class="headerlink" title="RPM 包的安装 / 升级 / 查询 / 卸载"></a>RPM 包的安装 / 升级 / 查询 / 卸载</h3><p>一个 RPM 包包含了已压缩的软件文件集以及该软件的内容信息（在头文件中保存），通常表现为以 .rpm 扩展名结尾的文件，例如 package.rpm 。对其操作，需要使用 rpm 命令。下面介绍 rpm 工具的参数和使用方法。</p><p><strong>RPM 命令常用参数</strong></p><p>RPM 的常规使用方法为 rpm -参数 package.rpm  ( 更多信息，请查阅帮助 $man rpm)：</p><p>-q 在系统中查询软件或查询指定 rpm 包的内容信息</p><p>-i 在系统中安装软件</p><p>-U 在系统中升级软件</p><p>-e 在系统中卸载软件</p><p>-h 用 #(hash) 符显示 rpm 安装过程</p><p>-v 详述安装过程</p><p>-p 表明对 RPM 包进行查询，通常和其它参数同时使用，如：<br>-qlp 查询某个 RPM 包中的所有文件列表<br>-qip 查询某个 RPM 包的内容信息</p><p><strong>RPM 命令参数使用方法</strong><br>以上参数有些需要组合使用，比如说 rpm -h package.rpm 是没有意义的，但 rpm -ih package.rpm 即表示安装 package 并用 # 符显示安装进度。</p><p><strong>安装 RPM 包</strong></p><p>rpm -ivh package.rpm</p><p><strong>升级 RPM 包命令</strong></p><p>rpm -Uvh package.rpm</p><p><strong>卸载 RPM 包命令</strong></p><p>rpm -ev package</p><p><strong>查询 RPM 包中包含的文件列表命令</strong></p><p>rpm -qlp package</p><p><strong>查询 RPM 包中包含的文件列表命令</strong></p><p>rpm -qlp package</p><p><strong>查询 RPM 包中包含的内容信息命令</strong></p><p>rpm -qip package</p><p><strong>查询系统中所有已安装 RPM 包</strong></p><p>rpm -qa</p><h3 id="DEB-包的安装-升级-查询-卸载"><a href="#DEB-包的安装-升级-查询-卸载" class="headerlink" title="DEB 包的安装 / 升级 / 查询 / 卸载"></a>DEB 包的安装 / 升级 / 查询 / 卸载</h3><p>一个 DEB 包包含了已压缩的软件文件集以及该软件的内容信息（在头文件中保存），通常表现为以 .deb 扩展名结尾的文件，例如 package.deb 。对其操作，需要使用 dpkg 命令。下面介绍 dpkg 工具的参数和使用方法，并以 IBM Lotus Notes 在 UBUNTU 904 安装为例做具体说明。</p><p><strong>DPKG 命令常用参数</strong></p><p>DPKG 的常规使用方法为 dpkg -参数 Package(.rpm),( 更多信息，请查阅帮助 $man rpm)</p><p>-l 在系统中查询软件内容信息</p><p>–info 在系统中查询软件或查询指定 rpm 包的内容信息</p><p>-i 在系统中安装 / 升级软件</p><p>-r 在系统中卸载软件 , 不删除配置文件</p><p>-P 在系统中卸载软件以及其配置文件</p><p><strong>DPKG 命令参数使用方法</strong></p><p><strong>安装 DEB 包命令</strong></p><p>dpkg -i package.deb</p><p><strong>升级 DEB 包命令</strong></p><p>dpkg -i package.deb ( 和安装命令相同）</p><p><strong>卸载 DEB 包命令</strong></p><p>dpkg -r package.deb # 不卸载配置文件或 </p><p>dpkg -P package.deb # 卸载配置文件</p><p><strong>查询 DEB 包中包含的文件列表命令</strong></p><p>dpkg-deb -c package.deb</p><p><strong>查询 DEB 包中包含的内容信息命令</strong></p><p>dpkg –info package.deb</p><p><strong>查询系统中所有已安装 DEB 包</strong></p><p>dpkg -l package</p><h3 id="YUM-APT"><a href="#YUM-APT" class="headerlink" title="YUM/APT"></a>YUM/APT</h3><p>大多数 Linux 都使用本地数据库来存储远程可用的包仓库列表，所以在安装或升级包之前最好更新一下这个数据库。</p><p><strong>Debian/Ubuntu</strong></p><p>sudo apt-get update</p><p><strong>CentOS</strong></p><p>yum check-update</p><p><strong>Fedora</strong></p><p>dnf check-update</p><p><strong>升级已安装的包</strong></p><p><strong>Debian/Ubuntu</strong>    </p><p>sudo apt-get upgrade    #仅升级已安装的软件包</p><p>sudo apt-get dist-upgrade    #可添加或删除程序包，以满足新的依赖。</p><p><strong>CentOS</strong>    </p><p>sudo yum update     </p><p><strong>Fedora</strong>    </p><p>sudo dnf upgrade</p><p><strong>查找/搜索软件包</strong></p><p><strong>Debian/Ubuntu</strong><br>apt-cache search  #搜索内容     </p><p><strong>CentOS</strong><br>yum search     #搜索内容<br>yum search all #搜索内容    搜索所有内容，包括包描述。</p><p><strong>Fedora</strong><br>dnf search     #搜索内容<br>dnf search all #搜索内容    搜索所有内容，包括包描述。</p><p><strong>查看某个软件包信息</strong></p><p><strong>Debian/Ubuntu</strong>    </p><p>apt-cache show 包名    #显示有关软件包的本地缓存信息</p><p>dpkg -s 包名         #显示包的当前安装状态</p><p><strong>CentOS</strong>    </p><p>yum info 包名     </p><p>yum deplist 包名    #列出包的以来</p><p><strong>Fedora</strong><br>dnf info 包名<br>dnf repoquery –requires 包名  #列出包的以来</p><p><strong>从软件仓库安装包</strong></p><p>一旦我们知道某个软件包的名称之后，便可以使用如下命令从软件仓库安装包。</p><p><strong>Debian/Ubuntu</strong></p><p>sudo apt-get install 包名<br>sudo apt-get install 包1 包2 …       #安装所有列出的包<br>sudo apt-get install -y 包名       #无需提示直接安装</p><p><strong>CentOS</strong><br>sudo yum install 包名<br>sudo yum install 包1 包2 …         #安装所有列出的包<br>sudo yum install -y 包名               #无需提示直接安装</p><p><strong>Fedora</strong><br>sudo dnf install 包名<br>sudo dnf install 包1 包2 …         #安装所有列出的包<br>sudo dnf install -y 包名               #无需提示直接安装</p><h3 id="使用发行版光盘作为yum-repository"><a href="#使用发行版光盘作为yum-repository" class="headerlink" title="使用发行版光盘作为yum repository"></a>使用发行版光盘作为yum repository</h3><p>1、将主机base源及media源备份并将media源切换至iso mount目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /]<span class="comment"># cd /etc/yum.repos.d</span></span><br><span class="line">[root@centos yum.repos.d]<span class="comment"># mv CentOS-Base.repo CentOS-Base.repo.bak</span></span><br><span class="line">[root@centos yum.repos.d]<span class="comment"># cp CentOS-Media.repo CentOS-Media.repo.bak</span></span><br><span class="line">[root@centos yum.repos.d]<span class="comment"># vim CentOS-Media.repo</span></span><br></pre></td></tr></table></figure><p><img src="http://i.imgur.com/IsPfQwB.png" alt=""></p><p>2、将iso光盘插入光驱或将iso包挂载到机器中（本次测试直接将iso挂载到虚拟机centos中）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos /]<span class="comment"># mkdir /media/CentOS   #建立光盘挂载目录 ，其实就是跟CentOS-Media.repo里面默认的一样啦</span></span><br><span class="line"></span><br><span class="line">[root@centos dev]<span class="comment"># mount /dev/sr0 /media/CentOS/   #挂载光盘</span></span><br></pre></td></tr></table></figure><p>3、测试安装policycoreutils-python</p><p>先清空yum的缓存，再重建yum缓存，看看从光盘的yum repository能否正常读取。</p><p><img src="http://i.imgur.com/vAkQtzi.png" alt=""></p><p>貌似是OK的。</p><p>再来一发</p><p><img src="http://i.imgur.com/HN3jFqR.png" alt=""><br>大功告成！</p><h3 id="完成以下功能"><a href="#完成以下功能" class="headerlink" title="完成以下功能"></a>完成以下功能</h3><p>   (1) 假设某目录(/etc/rc.d/rc3.d/)下分别有K开头的文件和S开头的文件若干；</p><p>   (2) 显示所有以K开头的文件的文件名，并且给其附加一个stop字符串；</p><p>   (3) 显示所有以S开头的文件的文件名，并且给其附加一个start字符串；</p><p>   (4) 分别统计S开头和K开头的文件各有多少；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#定义统计文件个数的变量，初始化啦</span></span><br><span class="line">filename_S_sum=0</span><br><span class="line">filename_K_sum=0</span><br><span class="line"></span><br><span class="line"><span class="comment">#利用for循环列表支持文件路径*通配S开头的文件</span></span><br><span class="line"><span class="keyword">for</span> filename_S <span class="keyword">in</span> /etc/rc.d/rc3.d/S*;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> $(basename <span class="variable">$filename_S</span>) start</span><br><span class="line">        <span class="built_in">let</span> filename_S_sum++</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#利用for循环列表支持文件路径*通配S开头的文件</span></span><br><span class="line"><span class="keyword">for</span> filename_K <span class="keyword">in</span> /etc/rc.d/rc3.d/K*;<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> $(basename <span class="variable">$filename_K</span>) stop</span><br><span class="line">        <span class="built_in">let</span> filename_K_sum++</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"There is <span class="variable">$filename_S_sum</span> files by S At the beginning of the file name"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"There is <span class="variable">$filename_K_sum</span> files by K At the beginning of the file name"</span></span><br></pre></td></tr></table></figure><p>​    </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@centos Jerry_go]<span class="comment"># bash week8_title12-2.sh &gt; week8_title12-2.txt &amp;&amp; cat week8_title12-2.txt </span></span><br><span class="line">S01sysstat start</span><br><span class="line">S02lvm2-monitor start</span><br><span class="line">S10network start</span><br><span class="line">S11portreserve start</span><br><span class="line">S12rsyslog start</span><br><span class="line">S22messagebus start</span><br><span class="line">S23NetworkManager start</span><br><span class="line">S25blk-availability start</span><br><span class="line">S26haldaemon start</span><br><span class="line">S26udev-post start</span><br><span class="line">S55memcached start</span><br><span class="line">S55sshd start</span><br><span class="line">S58ntpd start</span><br><span class="line">S90crond start</span><br><span class="line">S95atd start</span><br><span class="line">S99local start</span><br><span class="line">K01smartd stop</span><br><span class="line">K05wdaemon stop</span><br><span class="line">K10psacct stop</span><br><span class="line">K10saslauthd stop</span><br><span class="line">K16abrt-ccpp stop</span><br><span class="line">K16abrtd stop</span><br><span class="line">K30spice-vdagentd stop</span><br><span class="line">K50kdump stop</span><br><span class="line">K61nfs-rdma stop</span><br><span class="line">K75netfs stop</span><br><span class="line">K75ntpdate stop</span><br><span class="line">K75quota_nld stop</span><br><span class="line">K84wpa_supplicant stop</span><br><span class="line">K87restorecond stop</span><br><span class="line">K88auditd stop</span><br><span class="line">K89netconsole stop</span><br><span class="line">K89rdisc stop</span><br><span class="line">K92ip6tables stop</span><br><span class="line">K92iptables stop</span><br><span class="line">K95firstboot stop</span><br><span class="line">K95rdma stop</span><br><span class="line">K99rngd stop</span><br><span class="line">There is 16 files by S At the beginning of the file name</span><br><span class="line">There is 22 files by K At the beginning of the file name</span><br></pre></td></tr></table></figure><p>完成以下功能<br>   (1) 脚本能接受用户名作为参数；</p><p>   (2) 计算此些用户的ID之和；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@centos Jerry_go]<span class="comment"># cat week8_title13.sh  #开始装逼</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">[ <span class="variable">$#</span> -lt 1 ] &amp;&amp; <span class="built_in">echo</span> “At least input one users name ” &amp;&amp; <span class="built_in">exit</span> 1  <span class="comment">#提前判断一下，最少输入一个脚本参数并提示用户</span></span><br><span class="line">userid_sum=0   <span class="comment">#初始化userid_sum变量</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> user <span class="keyword">in</span> $*;<span class="keyword">do</span>  <span class="comment">#开始用for循环，$*参数表示读取脚本后的任意个参数作为循环列表</span></span><br><span class="line"><span class="keyword">if</span> id <span class="variable">$user</span> &amp;&gt; /dev/null;<span class="keyword">then</span>  <span class="comment">#判断一下用户是否存在</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$user</span> userid is <span class="variable">$(id -u $user)</span>"</span>  <span class="comment">#显示每次循环的当前系统用户的ID</span></span><br><span class="line"><span class="built_in">let</span> userid_sum+=$(id -u <span class="variable">$user</span>)  <span class="comment">#变量自增</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"<span class="variable">$user</span> is not an existing user"</span>  <span class="comment">#如果用户不存在，输出提示给用户</span></span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"They're userid sum is <span class="variable">$userid_sum</span>"</span>  <span class="comment">#输出用户ID的总和</span></span><br></pre></td></tr></table></figure><p>​        </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos Jerry_go]<span class="comment"># bash week8_title13.sh root bin jerry sshd FBI</span></span><br><span class="line">root userid is 0</span><br><span class="line">bin userid is 1</span><br><span class="line">jerry userid is 500</span><br><span class="line">sshd userid is 74</span><br><span class="line">FBI is not an existing user</span><br><span class="line">They<span class="string">'re userid sum is 575</span></span><br><span class="line"><span class="string">[root@centos Jerry_go]#</span></span><br></pre></td></tr></table></figure><p>   (1) 传递一些目录给此脚本；</p><p>   (2) 逐个显示每个目录的所有一级文件或子目录的内容类型；</p><p>   (3) 统计一共有多少个目录；且一共显示了多少个文件的内容类型；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@centos Jerry_go]<span class="comment"># cat week8_title14.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author Jerry</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Not less than one script parameters</span></span><br><span class="line">[ <span class="variable">$#</span> -lt 1 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"please aleast input one directory"</span> &amp;&amp; <span class="built_in">exit</span> 1</span><br><span class="line"></span><br><span class="line"><span class="comment">#Judge whether the script parameters of the input from the user directory</span></span><br><span class="line">[ -d $* ] || <span class="built_in">echo</span> <span class="string">"Please enter the directory!!!"</span> </span><br><span class="line">dsum=0</span><br><span class="line">fsum=0</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> file_name <span class="keyword">in</span> <span class="variable">$1</span>;<span class="keyword">do</span></span><br><span class="line">ls -l $* |awk <span class="string">'&#123;print $NF&#125;'</span></span><br><span class="line">    <span class="built_in">let</span> dsum+=$(ls -l $* |grep ^d |wc -l)        </span><br><span class="line"><span class="built_in">let</span> fsum+=$(ls -l $* |grep -v ^d |wc -l)  </span><br><span class="line"><span class="built_in">shift</span> </span><br><span class="line"><span class="built_in">break</span>  </span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"the directories sum:<span class="variable">$dsum</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"the file sum:<span class="variable">$fsum</span>"</span></span><br></pre></td></tr></table></figure><p>​    </p><p>写一个脚本<br>  通过命令行传递一个参数给脚本，参数为用户名</p><p>  如果用户的id号大于等于500，则显示此用户为普通用户；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos jerry_go]<span class="comment"># cat week8_title14.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Determine the user's input</span></span><br><span class="line">grep <span class="string">"^<span class="variable">$1</span>\&gt;"</span> /etc/passwd &amp;&gt; /dev/null || <span class="built_in">echo</span> <span class="string">"Please enter a user name"</span> </span><br><span class="line"></span><br><span class="line">userid=$(id -u <span class="variable">$1</span>)</span><br><span class="line"></span><br><span class="line">[ <span class="variable">$userid</span> -ge 500 ] &amp;&amp; <span class="built_in">echo</span> <span class="string">"This is a  common user,it's userid is <span class="variable">$userid</span> "</span> || <span class="built_in">echo</span> <span class="string">"This is a  system user,it's userid is <span class="variable">$userid</span> "</span></span><br></pre></td></tr></table></figure><p>写一个脚本<br>   (1) 添加10用户user1-user10；密码同用户名；</p><p>   (2) 用户不存在时才添加；存在时则跳过；</p><p>   (3) 最后显示本次共添加了多少用户；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">declare</span> -i num</span><br><span class="line"><span class="keyword">for</span>((i=1;i&lt;11;i++))&#123;</span><br><span class="line">    <span class="keyword">if</span> ! id user<span class="variable">$i</span> &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        useradd user<span class="variable">$i</span></span><br><span class="line">        <span class="built_in">echo</span> user<span class="variable">$i</span>:user<span class="variable">$i</span> | chpasswd</span><br><span class="line">        <span class="built_in">let</span> num++</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Add <span class="variable">$num</span> users!"</span></span><br></pre></td></tr></table></figure><p>用ping命令测试172.16.250.20-172.16.250.100以内有哪些主机在线，将在线的显示出来；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">net=<span class="string">"172.16.250."</span></span><br><span class="line"><span class="keyword">for</span>((i=20;i&lt;=100;i++))&#123;</span><br><span class="line">    ping -c 1 <span class="variable">$net</span><span class="variable">$i</span> &amp;&gt; /dev/null</span><br><span class="line">    <span class="keyword">if</span> [ $? -eq 0 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="variable">$net</span><span class="variable">$i</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>打印九九乘法表；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@centos jerry_go]<span class="comment"># bash week8_title18.sh </span></span><br><span class="line">1*1=1</span><br><span class="line">1*2=22*2=4</span><br><span class="line">1*3=32*3=63*3=9</span><br><span class="line">1*4=42*4=83*4=124*4=16</span><br><span class="line">1*5=52*5=103*5=154*5=205*5=25</span><br><span class="line">1*6=62*6=123*6=184*6=245*6=306*6=36</span><br><span class="line">1*7=72*7=143*7=214*7=285*7=356*7=427*7=49</span><br><span class="line">1*8=82*8=163*8=244*8=325*8=406*8=487*8=568*8=64</span><br><span class="line">1*9=92*9=183*9=274*9=365*9=456*9=547*9=638*9=729*9=81</span><br><span class="line"></span><br><span class="line">[root@centos jerry_go]<span class="comment"># cat week8_title18.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> ((i=1;i&lt;=9;i++))&#123;</span><br><span class="line">    <span class="keyword">for</span>((j=1;j&lt;=i;j++));<span class="keyword">do</span></span><br><span class="line">        <span class="built_in">echo</span> -e -n <span class="string">"<span class="variable">$j</span>*<span class="variable">$i</span>=<span class="variable">$(($i*$j)</span>)\t"</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line">    <span class="built_in">echo</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>脚本又见脚本</title>
      <link href="/2018/08/02/%E8%84%9A%E6%9C%AC%E5%8F%88%E8%A7%81%E8%84%9A%E6%9C%AC/"/>
      <url>/2018/08/02/%E8%84%9A%E6%9C%AC%E5%8F%88%E8%A7%81%E8%84%9A%E6%9C%AC/</url>
      <content type="html"><![CDATA[<p>创建一个10G分区，并格式为ext4文件系统；</p><p>(1) 要求其block大小为2048, 预留空间百分比为2, 卷标为MYDATA, 默认挂载属性包含acl；</p><p>(2) 挂载至/data/mydata目录，要求挂载时禁止程序自动运行，且不更新文件的访问时间戳；<a id="more"></a></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># fdisk -l   #不写注释的都是耍流氓</span></span><br><span class="line"></span><br><span class="line">Disk /dev/sda: 171.8 GB, 171798691840 bytes</span><br><span class="line">255 heads, 63 sectors/track, 20886 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00098b32</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *           1          64      512000   83  Linux</span><br><span class="line">Partition 1 does not end on cylinder boundary.</span><br><span class="line">/dev/sda2              64       20887   167259136   8e  Linux LVM</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 10.7 GB, 10737418240 bytes   <span class="comment">#创建一个10G分区</span></span><br><span class="line">255 heads, 63 sectors/track, 1305 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000 </span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/vg_centos-lv_root: 170.2 GB, 170196467712 bytes</span><br><span class="line">255 heads, 63 sectors/track, 20691 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/vg_centos-lv_swap: 1073 MB, 1073741824 bytes</span><br><span class="line">255 heads, 63 sectors/track, 130 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br><span class="line"></span><br><span class="line">[root@centos ~]<span class="comment"># fdisk /dev/sdb </span></span><br><span class="line">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel</span><br><span class="line">Building a new DOS disklabel with disk identifier 0x248136bc.</span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, until you decide to write them.</span><br><span class="line">After that, of course, the previous content won<span class="string">'t be recoverable.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">WARNING: DOS-compatible mode is deprecated. It'</span>s strongly recommended to</span><br><span class="line">         switch off the mode (<span class="built_in">command</span> <span class="string">'c'</span>) and change display units to</span><br><span class="line">         sectors (<span class="built_in">command</span> <span class="string">'u'</span>).</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 1</span><br><span class="line">First cylinder (1-1305, default 1): </span><br><span class="line">Using default value 1</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-1305, default 1305): </span><br><span class="line">Using default value 1305</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): wq</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br><span class="line">[root@centos ~]<span class="comment"># fdisk -l</span></span><br><span class="line"></span><br><span class="line">Disk /dev/sda: 171.8 GB, 171798691840 bytes</span><br><span class="line">255 heads, 63 sectors/track, 20886 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00098b32</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *           1          64      512000   83  Linux</span><br><span class="line">Partition 1 does not end on cylinder boundary.</span><br><span class="line">/dev/sda2              64       20887   167259136   8e  Linux LVM</span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 10.7 GB, 10737418240 bytes</span><br><span class="line">255 heads, 63 sectors/track, 1305 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x248136bc</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1               1        1305    10482381   83  Linux</span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/vg_centos-lv_root: 170.2 GB, 170196467712 bytes</span><br><span class="line">255 heads, 63 sectors/track, 20691 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br><span class="line"></span><br><span class="line">Disk /dev/mapper/vg_centos-lv_swap: 1073 MB, 1073741824 bytes</span><br><span class="line">255 heads, 63 sectors/track, 130 cylinders</span><br><span class="line">Units = cylinders of 16065 * 512 = 8225280 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk identifier: 0x00000000</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># mkfs -b 2048 -t ext4 -L MYDATA -m 2 /dev/sdb1  #格式为ext4文件系统，其block大小为2048, 预留空间百分比为2, 卷标为MYDATA</span></span><br><span class="line">mke2fs 1.41.12 (17-May-2010)</span><br><span class="line">文件系统标签=MYDATA</span><br><span class="line">操作系统:Linux</span><br><span class="line">块大小=2048 (<span class="built_in">log</span>=1)</span><br><span class="line">分块大小=2048 (<span class="built_in">log</span>=1)</span><br><span class="line">Stride=0 blocks, Stripe width=0 blocks</span><br><span class="line">655360 inodes, 5241190 blocks</span><br><span class="line">262059 blocks (5.00%) reserved <span class="keyword">for</span> the super user</span><br><span class="line">第一个数据块=0</span><br><span class="line">Maximum filesystem blocks=542113792</span><br><span class="line">320 block groups</span><br><span class="line">16384 blocks per group, 16384 fragments per group</span><br><span class="line">2048 inodes per group</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">16384, 49152, 81920, 114688, 147456, 409600, 442368, 802816, 1327104, </span><br><span class="line">2048000, 3981312</span><br><span class="line"></span><br><span class="line">正在写入inode表: 完成                            </span><br><span class="line">Creating journal (32768 blocks): 完成</span><br><span class="line">Writing superblocks and filesystem accounting information: 完成</span><br><span class="line"></span><br><span class="line">This filesystem will be automatically checked every 20 mounts or</span><br><span class="line">180 days, whichever comes first.  Use tune2fs -c or -i to override.</span><br><span class="line"></span><br><span class="line">[root@centos ~]<span class="comment"># tune2fs -o acl /dev/sdb1  #默认挂载属性包含acl</span></span><br><span class="line">tune2fs 1.41.12 (17-May-2010)</span><br><span class="line">[root@centos ~]<span class="comment"># mkdir -p /data/mydata &amp;&amp; mount -o noexec,noatime /dev/sdb1 /data/mydata #挂载至/data/mydata目录，要求挂载时禁止程序自动运行，且不更新文件的访问时间戳</span></span><br><span class="line">[root@centos ~]<span class="comment"># echo $? </span></span><br><span class="line">0</span><br><span class="line">[root@centos ~]<span class="comment"># cd /data/</span></span><br><span class="line">[root@centos data]<span class="comment"># ll</span></span><br><span class="line">总用量 2</span><br><span class="line">drwxr-xr-x 3 root root 2048 12月 26 17:36 mydata</span><br><span class="line">[root@centos data]<span class="comment"># cd mydata/</span></span><br><span class="line">[root@centos mydata]<span class="comment"># ll</span></span><br><span class="line">总用量 16</span><br><span class="line">drwx------ 2 root root 16384 12月 26 17:36 lost+found</span><br><span class="line">[root@centos mydata]<span class="comment"># df -h</span></span><br><span class="line">Filesystem            Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/vg_centos-lv_root</span><br><span class="line">                      156G  3.8G  145G   3% /</span><br><span class="line">tmpfs                 1.9G   72K  1.9G   1% /dev/shm</span><br><span class="line">/dev/sda1             477M  160M  292M  36% /boot</span><br><span class="line">/dev/sdb1             9.8G   13M  9.3G   1% /data/mydata</span><br><span class="line">[root@centos mydata]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>2、创建一个大小为1G的swap分区，并创建好文件系统，并启用之；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># fdisk /dev/sdb </span></span><br><span class="line">Device contains neither a valid DOS partition table, nor Sun, SGI or OSF disklabel</span><br><span class="line">Building a new DOS disklabel with disk identifier 0x70af3aab.</span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, until you decide to write them.</span><br><span class="line">After that, of course, the previous content won<span class="string">'t be recoverable.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Warning: invalid flag 0x0000 of partition table 4 will be corrected by w(rite)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">WARNING: DOS-compatible mode is deprecated. It'</span>s strongly recommended to</span><br><span class="line">         switch off the mode (<span class="built_in">command</span> <span class="string">'c'</span>) and change display units to</span><br><span class="line">         sectors (<span class="built_in">command</span> <span class="string">'u'</span>).</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line"></span><br><span class="line">Command action</span><br><span class="line">   e   extended</span><br><span class="line">   p   primary partition (1-4)</span><br><span class="line">p</span><br><span class="line">Partition number (1-4): 1</span><br><span class="line">First cylinder (1-130, default 1): </span><br><span class="line">Using default value 1</span><br><span class="line">Last cylinder, +cylinders or +size&#123;K,M,G&#125; (1-130, default 130): </span><br><span class="line">Using default value 130</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br><span class="line"> </span><br><span class="line">[root@centos ~]<span class="comment"># mkswap /dev/sdb1</span></span><br><span class="line">Setting up swapspace version 1, size = 1044188 KiB</span><br><span class="line">no label, UUID=85de9eea-a86d-48f4-a24d-00615a9812f8</span><br><span class="line">[root@centos ~]<span class="comment"># swapon /dev/sdb1 </span></span><br><span class="line">[root@centos ~]<span class="comment"># free -m</span></span><br><span class="line">             total       used       free     shared    buffers     cached</span><br><span class="line">Mem:          3816        517       3299          1         27        289</span><br><span class="line">-/+ buffers/cache:        200       3615</span><br><span class="line">Swap:         1019          0       1019</span><br><span class="line">[root@centos ~]<span class="comment"># echo "/dev/sdb1 swap swap defaults 0 0" &gt;&gt; /etc/fstab #swap现已加入开机挂载全家桶！</span></span><br></pre></td></tr></table></figure><p>3、获取并列出当前系统上的所有磁盘设备；显示每个磁盘设备上每个分区相关的空间使用信息；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@centos gogogogogogogogoo]<span class="comment"># cat DiskInfo_Jerry.sh  #马哥说过，脚本就是命令的拼凑，所以，命令学好，脚本风骚。</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author: Jerry</span></span><br><span class="line">lsblk</span><br><span class="line">df -ahT</span><br><span class="line"></span><br><span class="line">[root@centos gogogogogogogogoo]<span class="comment"># bash DiskInfo_Jerry.sh </span></span><br><span class="line">NAME                          MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda                             8:0    0   160G  0 disk </span><br><span class="line">├─sda1                          8:1    0   500M  0 part /boot</span><br><span class="line">└─sda2                          8:2    0 159.5G  0 part </span><br><span class="line">  ├─vg_centos-lv_root (dm-0)  253:0    0 158.5G  0 lvm  /</span><br><span class="line">  └─vg_centos-lv_swap (dm-1)  253:1    0     1G  0 lvm  </span><br><span class="line">sdb                             8:16   0    10G  0 disk </span><br><span class="line">└─sdb1                          8:17   0    10G  0 part </span><br><span class="line">  ├─vg_mage-mylv1-real (dm-3) 253:3    0     5G  0 lvm  </span><br><span class="line">  │ ├─vg_mage-mylv1 (dm-2)    253:2    0     5G  0 lvm  </span><br><span class="line">  │ └─vg_mage-snvg1 (dm-5)    253:5    0     5G  1 lvm  </span><br><span class="line">  └─vg_mage-snvg1-cow (dm-4)  253:4    0   160M  1 lvm  </span><br><span class="line">    └─vg_mage-snvg1 (dm-5)    253:5    0     5G  1 lvm  </span><br><span class="line">sdc                             8:32   0    60G  0 disk </span><br><span class="line">└─sdc1                          8:33   0    60G  0 part </span><br><span class="line"></span><br><span class="line">Filesystem           Type                 Size  Used Avail Use% Mounted on</span><br><span class="line">/dev/mapper/vg_centos-lv_root</span><br><span class="line">                     ext4                 156G  3.4G  145G   3% /</span><br><span class="line">proc                 proc                    0     0     0    - /proc</span><br><span class="line">sysfs                sysfs                   0     0     0    - /sys</span><br><span class="line">devpts               devpts                  0     0     0    - /dev/pts</span><br><span class="line">tmpfs                tmpfs                1.9G   68K  1.9G   1% /dev/shm</span><br><span class="line">/dev/sda1            ext4                 477M   35M  418M   8% /boot</span><br><span class="line">/dev/mapper/vg_mage-mylv1</span><br><span class="line">                     ext4                 4.8G   10M  4.6G   1% /users</span><br><span class="line">none                 binfmt_misc             0     0     0    - /proc/sys/fs/binfmt_misc</span><br><span class="line">vmware-vmblock       fuse.vmware-vmblock     0     0     0    - /var/run/vmblock-fuse</span><br><span class="line"></span><br><span class="line">[root@centos gogogogogogogogoo]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>4、总结RAID的各个级别及其组合方式和性能的不同；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">RAID-0: </span><br><span class="line">读、写性能提升；</span><br><span class="line">可用空间：N*min(S1,S2,...)</span><br><span class="line">无容错能力</span><br><span class="line">最少磁盘数：2, 2+</span><br><span class="line"></span><br><span class="line">RAID-1：</span><br><span class="line">读性能提升、写性能略有下降；</span><br><span class="line">可用空间：1*min(S1,S2,...)</span><br><span class="line">有冗余能力</span><br><span class="line">最少磁盘数：2, 2+</span><br><span class="line"></span><br><span class="line">RAID-4：</span><br><span class="line">1101, 0110, 1011</span><br><span class="line"></span><br><span class="line">RAID-5：</span><br><span class="line">读、写性能提升</span><br><span class="line">可用空间：(N-1)*min(S1,S2,...)</span><br><span class="line">有容错能力：1块磁盘</span><br><span class="line">最少磁盘数：3, 3+</span><br><span class="line"></span><br><span class="line">RAID-6：</span><br><span class="line">读、写性能提升</span><br><span class="line">可用空间：(N-2)*min(S1,S2,...)</span><br><span class="line">有容错能力：2块磁盘</span><br><span class="line">最少磁盘数：4, 4+</span><br></pre></td></tr></table></figure><p>​        </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">混合类型</span><br><span class="line">RAID-10：</span><br><span class="line">读、写性能提升</span><br><span class="line">可用空间：N*min(S1,S2,...)/2</span><br><span class="line">有容错能力：每组镜像最多只能坏一块；</span><br><span class="line">最少磁盘数：4, 4+</span><br></pre></td></tr></table></figure><p>5、创建一个大小为10G的RAID1，要求有一个空闲盘，而且CHUNK大小为128k;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">生产环境都是用服务器自带的磁盘阵列卡来做raid，具体详见各厂商的操作文档，此题我就跳过了，请老湿原谅我的直接。</span><br></pre></td></tr></table></figure><p>6、创建一个大小为4G的RAID5设备，chunk大小为256k，格式化ext4文件系统，要求可开机自动挂载至/backup目录，而且不更新访问时间戳，且支持acl功能；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">生产环境都是用服务器自带的磁盘阵列卡来做raid，具体详见各厂商的操作文档，此题我就跳过了，请老湿原谅我的直接。</span><br><span class="line">更新访问时间戳我要说一下，生产环境一般都是要更新访问时间戳的</span><br></pre></td></tr></table></figure><p>7、接受一个以上文件路径作为参数；显示每个文件拥有的行数；总结说明本次共为几个文件统计了其行数；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@centos gogogogogogogogoo]<span class="comment"># bash Sum_wc-l.sh /etc/ssh/sshd_config /etc/fstab /etc/rc.local </span></span><br><span class="line">Number of rows <span class="keyword">in</span> /etc/ssh/sshd_config is 138</span><br><span class="line">Number of rows <span class="keyword">in</span> /etc/fstab is 16</span><br><span class="line">Number of rows <span class="keyword">in</span> /etc/rc.local is 7</span><br><span class="line">total of 3  files</span><br><span class="line">[root@centos gogogogogogogogoo]<span class="comment"># cat Sum_wc-l.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 1 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"At least one filesname "</span></span><br><span class="line">    <span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> $*;<span class="keyword">do</span></span><br><span class="line">       line=$(cat <span class="variable">$i</span> | wc -l)</span><br><span class="line">       <span class="built_in">echo</span> <span class="string">"Number of rows in <span class="variable">$i</span> is <span class="variable">$line</span>"</span></span><br><span class="line">    <span class="keyword">done</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"total of <span class="variable">$#</span>  files"</span></span><br><span class="line">[root@centos gogogogogogogogoo]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>8、传递两个以上字符串当作用户名；创建这些用户；且密码同用户名；(总结说明共创建了几个用户；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@centos gogogogogogogogoo]<span class="comment"># bash Creat_user.sh </span></span><br><span class="line">At least two username </span><br><span class="line">[root@centos gogogogogogogogoo]<span class="comment"># bash Creat_user.sh abb1 abb2 abb3 abb4</span></span><br><span class="line">Add user abb1 finished</span><br><span class="line">Add user abb2 finished</span><br><span class="line">Add user abb3 finished</span><br><span class="line">Add user abb4 finished</span><br><span class="line">total of Create 4 users</span><br><span class="line">[root@centos gogogogogogogogoo]<span class="comment"># cat Creat_user.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$#</span> -lt 2 ];<span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"At least two username "</span></span><br><span class="line">    <span class="built_in">exit</span> 2</span><br><span class="line"><span class="keyword">fi</span>    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> $*;<span class="keyword">do</span></span><br><span class="line">        <span class="keyword">if</span> grep <span class="string">"^<span class="variable">$i</span>\&gt;"</span> /etc/passwd &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line">        </span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"User <span class="variable">$i</span> exists"</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    useradd <span class="variable">$i</span></span><br><span class="line">            <span class="built_in">echo</span> <span class="variable">$i</span> | passwd --stdin <span class="variable">$i</span> &amp;&gt; /dev/null</span><br><span class="line">            <span class="built_in">echo</span> <span class="string">"Add user <span class="variable">$i</span> finished"</span></span><br><span class="line">        <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">done</span> </span><br><span class="line">    </span><br><span class="line"><span class="built_in">echo</span> <span class="string">"total of Create <span class="variable">$#</span> users"</span></span><br><span class="line">[root@centos gogogogogogogogoo]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>9、新建20个用户，visitor1-visitor20；计算他们的ID之和；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@centos gogogogogogogogoo]<span class="comment"># bash sum_userid.sh </span></span><br><span class="line">The users ID sum is: 10330</span><br><span class="line">[root@centos gogogogogogogogoo]<span class="comment"># cat sum_userid.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">num=0</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..20&#125;;<span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> id visitor<span class="variable">$i</span> &amp;&gt; /dev/null;<span class="keyword">then</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"visitor<span class="variable">$i</span> exists"</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            useradd visitor<span class="variable">$i</span></span><br><span class="line">        id=$(grep <span class="string">"^visitor<span class="variable">$i</span>\&gt;"</span> /etc/passwd | cut -d: -f 3)</span><br><span class="line">        <span class="built_in">let</span> num+=<span class="variable">$id</span></span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"The users ID sum is: <span class="variable">$num</span>"</span></span><br><span class="line">[root@centos gogogogogogogogoo]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>10、分别统计/etc/rc.d/rc.sysinit、/etc/rc.d/init.d/functions和/etc/fstab文件中以#号开头的行数之和，以及总的空白行数；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[root@centos jerry_go]<span class="comment"># cat title10-2.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author:Jerry</span></span><br><span class="line"><span class="comment">#Description</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> [ -e <span class="variable">$1</span> ]; <span class="keyword">then</span></span><br><span class="line">        jinghao1=$(grep <span class="string">"^#"</span> <span class="variable">$1</span> | wc -l)</span><br><span class="line">        blank_line1=$(grep <span class="string">"^$"</span> <span class="variable">$1</span> | wc -l)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"The file <span class="variable">$1</span> Jinghao_lines:<span class="variable">$jinghao1</span>    Blank_lines:<span class="variable">$blank_line1</span>  "</span> </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"The file <span class="variable">$1</span> no exist"</span></span><br><span class="line">        <span class="built_in">exit</span> 2</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> [ -e <span class="variable">$2</span> ]; <span class="keyword">then</span></span><br><span class="line">        jinghao2=$(grep <span class="string">"^#"</span> <span class="variable">$2</span> | wc -l)</span><br><span class="line">        blank_line2=$(grep <span class="string">"^$"</span> <span class="variable">$2</span> | wc -l)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"The file <span class="variable">$2</span> Jinghao_lines:<span class="variable">$jinghao2</span>    Blank_lines:<span class="variable">$blank_line2</span>  "</span> </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"The file <span class="variable">$2</span> no exist"</span></span><br><span class="line">        <span class="built_in">exit</span> 2</span><br><span class="line">   <span class="keyword">fi</span></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">if</span> [ -e <span class="variable">$3</span> ]; <span class="keyword">then</span></span><br><span class="line">        jinghao3=$(grep <span class="string">"^#"</span> <span class="variable">$3</span> | wc -l)</span><br><span class="line">        blank_line3=$(grep <span class="string">"^$"</span> <span class="variable">$3</span> | wc -l)</span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"The file <span class="variable">$3</span> Jinghao_lines:<span class="variable">$jinghao3</span>    Blank_lines:<span class="variable">$blank_line3</span>  "</span>  </span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">echo</span> <span class="string">"The file <span class="variable">$3</span> no exist"</span></span><br><span class="line">        <span class="built_in">exit</span> 2</span><br><span class="line">    <span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Total jinghao lines: $[<span class="variable">$jinghao1</span>+<span class="variable">$jinghao2</span>+<span class="variable">$jinghao3</span>]"</span>   </span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"Total blank lines: $[<span class="variable">$blank_line1</span>+<span class="variable">$blank_line2</span>+<span class="variable">$blank_line3</span>]"</span> &amp;&amp; <span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><p>​    </p><p>​    </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">走一个！come on baby！</span><br><span class="line">[root@centos jerry_go]<span class="comment"># bash title10-2.sh /etc/rc.d/rc.sysinit /etc/rc.d/init.d/functions /etc/fstab </span></span><br><span class="line">The file /etc/rc.d/rc.sysinit Jinghao_lines:44    Blank_lines:100  </span><br><span class="line">The file /etc/rc.d/init.d/<span class="built_in">functions</span> Jinghao_lines:43    Blank_lines:105  </span><br><span class="line">The file /etc/fstab Jinghao_lines:8    Blank_lines:1  </span><br><span class="line">Total jinghao lines: 95</span><br><span class="line">Total blank lines: 206</span><br><span class="line">[root@centos jerry_go]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line">异常的走一个！ 欧耶！</span><br><span class="line">[root@centos jerry_go]<span class="comment"># bash title10-2.sh /etc/rc.d/rc.sysinit /etc/rc.d/init.d/funct234ions /etc/fstab </span></span><br><span class="line">The file /etc/rc.d/rc.sysinit Jinghao_lines:44    Blank_lines:100  </span><br><span class="line">The file /etc/rc.d/init.d/funct234ions no exist</span><br><span class="line">[root@centos jerry_go]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">异常的再走一个！    </span><br><span class="line">[root@centos jerry_go]<span class="comment"># bash title10-2.sh /etc/rc.d/rc.sysinit /etc/rc.d/init.d/functions /etc/fst123ab </span></span><br><span class="line">The file /etc/rc.d/rc.sysinit Jinghao_lines:44    Blank_lines:100  </span><br><span class="line">The file /etc/rc.d/init.d/<span class="built_in">functions</span> Jinghao_lines:43    Blank_lines:105  </span><br><span class="line">The file /etc/fst123ab no exist</span><br><span class="line">[root@centos jerry_go]<span class="comment"># </span></span><br><span class="line">   </span><br><span class="line">最后发现井号的英文是well number ， 脚本里面用拼音实在是很low，不过我是刚开始嘛，who care......</span><br></pre></td></tr></table></figure><p>11、显示当前系统上所有默认shell为bash的用户的用户名、UID以及此类所有用户的UID之和；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@centos jerry_go]<span class="comment"># cat week7_title11.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author:Jerry</span></span><br><span class="line"><span class="comment">#Description</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">grep <span class="string">"bin/bash$"</span> /etc/passwd  |cut -d<span class="string">":"</span> -f1,3</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `grep <span class="string">"bin/bash$"</span> /etc/passwd  |awk -F <span class="string">":"</span> <span class="string">'&#123;print $3&#125;'</span>`;<span class="keyword">do</span></span><br><span class="line">    <span class="built_in">let</span> sum+=<span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line">               </span><br><span class="line"> <span class="built_in">echo</span> <span class="string">"Users ID sum is:<span class="variable">$sum</span>"</span></span><br><span class="line"></span><br><span class="line">[root@centos jerry_go]<span class="comment"># bash week7_title11.sh </span></span><br><span class="line">root:0</span><br><span class="line">magedu:500</span><br><span class="line">mamamamam:501</span><br><span class="line">magedu1:502</span><br><span class="line">abb1:503</span><br><span class="line">abb2:504</span><br><span class="line">abb3:505</span><br><span class="line">abb4:506</span><br><span class="line">visitor1:507</span><br><span class="line">visitor2:508</span><br><span class="line">visitor3:509</span><br><span class="line">visitor4:510</span><br><span class="line">visitor5:511</span><br><span class="line">visitor6:512</span><br><span class="line">visitor7:513</span><br><span class="line">visitor8:514</span><br><span class="line">visitor9:515</span><br><span class="line">visitor10:516</span><br><span class="line">visitor11:517</span><br><span class="line">visitor12:518</span><br><span class="line">visitor13:519</span><br><span class="line">visitor14:520</span><br><span class="line">visitor15:521</span><br><span class="line">visitor16:522</span><br><span class="line">visitor17:523</span><br><span class="line">visitor18:524</span><br><span class="line">visitor19:525</span><br><span class="line">visitor20:526</span><br><span class="line">Users ID sum is:13851</span><br></pre></td></tr></table></figure><p>12、显示当前系统上所有，拥有附加组的用户的用户名；并说明共有多少个此类用户；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@centos jerry_go]<span class="comment"># bash week7_title12.sh </span></span><br><span class="line">bin</span><br><span class="line">daemon</span><br><span class="line">sys</span><br><span class="line">adm</span><br><span class="line">lp</span><br><span class="line">mail</span><br><span class="line">haldaemon</span><br><span class="line">This users has 7.</span><br><span class="line"></span><br><span class="line">[root@centos jerry_go]<span class="comment"># cat week7_title12.sh </span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author:Jerry</span></span><br><span class="line"><span class="comment">#Description</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">grep -v <span class="string">":$"</span> /etc/group |awk -F <span class="string">":"</span> <span class="string">'&#123;print $1&#125;'</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"This users has <span class="variable">$(grep -v ":$" /etc/group |awk -F ":" '&#123;print $1&#125;'|wc -l)</span>."</span></span><br></pre></td></tr></table></figure><p>13、创建一个由至少两个物理卷组成的大小为20G的卷组；要求，PE大小为8M；而在卷组中创建一个大小为5G的逻辑卷mylv1，格式化为ext4文件系统，开机自动挂载至/users目录，支持acl；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># pvdisplay   #先看看环境</span></span><br><span class="line">  --- Physical volume ---</span><br><span class="line">  PV Name               /dev/sda2</span><br><span class="line">  VG Name               vg_centos</span><br><span class="line">  PV Size               159.51 GiB / not usable 3.00 MiB</span><br><span class="line">  Allocatable           yes (but full)</span><br><span class="line">  PE Size               4.00 MiB</span><br><span class="line">  Total PE              40834</span><br><span class="line">  Free PE               0</span><br><span class="line">  Allocated PE          40834</span><br><span class="line">  PV UUID               1O2YO5-7puR-3Pfu-nR15-tqCc-JjPN-giIZeh</span><br><span class="line">   </span><br><span class="line">  <span class="string">"/dev/sdb1"</span> is a new physical volume of <span class="string">"10.00 GiB"</span></span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line">  PV Name               /dev/sdb1</span><br><span class="line">  VG Name               </span><br><span class="line">  PV Size               10.00 GiB</span><br><span class="line">  Allocatable           NO</span><br><span class="line">  PE Size               0   </span><br><span class="line">  Total PE              0</span><br><span class="line">  Free PE               0</span><br><span class="line">  Allocated PE          0</span><br><span class="line">  PV UUID               dmUkps-1j6e-q50O-yOh8-nBlT-lw6t-nGKnat</span><br><span class="line">   </span><br><span class="line">  <span class="string">"/dev/sdc1"</span> is a new physical volume of <span class="string">"60.00 GiB"</span></span><br><span class="line">  --- NEW Physical volume ---</span><br><span class="line">  PV Name               /dev/sdc1</span><br><span class="line">  VG Name               </span><br><span class="line">  PV Size               60.00 GiB</span><br><span class="line">  Allocatable           NO</span><br><span class="line">  PE Size               0   </span><br><span class="line">  Total PE              0</span><br><span class="line">  Free PE               0</span><br><span class="line">  Allocated PE          0</span><br><span class="line">  PV UUID               WfoY2H-efkl-qx0z-Yetm-wyV0-3lUU-u815Aq</span><br><span class="line">   </span><br><span class="line">[root@centos ~]<span class="comment"># vgcreate -s 8m vg_mage /dev/sdb1 /dev/sdc1  #创建一个由至少两个物理卷组成的大小为20G的卷组，我这里不止了，无伤大雅。</span></span><br><span class="line">  Volume group <span class="string">"vg_mage"</span> successfully created</span><br><span class="line">[root@centos ~]<span class="comment"># lvcreate -L 5G -n mylv1 vg_mage &amp;&amp; mkfs.ext4 /dev/vg_mage/mylv1 #在卷组中创建一个大小为5G的逻辑卷mylv1，格式化为ext4文件系统</span></span><br><span class="line">[root@centos ~]<span class="comment"># mkdir /users &amp;&amp; echo "/dev/vg_mage/mylv1 /users ext4 defaults,acl 0 0" &gt;&gt; /etc/fstab  #自动挂载至/users目录，支持acl</span></span><br><span class="line">[root@centos ~]<span class="comment"># cat /etc/fstab </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># /etc/fstab</span></span><br><span class="line"><span class="comment"># Created by anaconda on Thu Jun 23 18:40:21 2016</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Accessible filesystems, by reference, are maintained under '/dev/disk'</span></span><br><span class="line"><span class="comment"># See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">/dev/mapper/vg_centos-lv_root /                       ext4    defaults        1 1</span><br><span class="line">UUID=7b714956-acd7-44cb-af53-4eacde793fd9 /boot                   ext4    defaults        1 2</span><br><span class="line"><span class="comment">#/dev/mapper/vg_centos-lv_swap swap                    swap    defaults        0 0</span></span><br><span class="line">tmpfs                   /dev/shm                tmpfs   defaults        0 0</span><br><span class="line">devpts                  /dev/pts                devpts  gid=5,mode=620  0 0</span><br><span class="line">sysfs                   /sys                    sysfs   defaults        0 0</span><br><span class="line">proc                    /proc                   proc    defaults        0 0</span><br><span class="line">/dev/vg_mage/mylv1 /users ext4 defaults,acl 0 0</span><br><span class="line"></span><br><span class="line"> [root@centos ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>14、新建用户magedu；其家目录为/users/magedu，而后su切换至此用户，复制多个文件至家目录；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># useradd magedu -d /users/magedu</span></span><br><span class="line">[root@centos ~]<span class="comment"># su - magedu</span></span><br><span class="line">[magedu@centos ~]$ cp /etc/*.conf ~</span><br><span class="line">[magedu@centos ~]$ ls -al</span><br><span class="line">总用量 188</span><br><span class="line">drwx------  4 magedu magedu  4096 12月 27 12:52 .</span><br><span class="line">drwxr-xr-x. 4 root   root    4096 12月 27 12:48 ..</span><br><span class="line">-rw-r--r--  1 magedu magedu   148 12月 27 12:52 asound.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu    18 5月  11 2016 .bash_logout</span><br><span class="line">-rw-r--r--  1 magedu magedu   176 5月  11 2016 .bash_profile</span><br><span class="line">-rw-r--r--  1 magedu magedu   124 5月  11 2016 .bashrc</span><br><span class="line">-rw-r--r--  1 magedu magedu  1780 12月 27 12:52 cas.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu 21214 12月 27 12:52 dnsmasq.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu   519 12月 27 12:52 dracut.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu    20 12月 27 12:52 fprintd.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu     0 12月 27 12:52 gai.conf</span><br><span class="line">drwxr-xr-x  2 magedu magedu  4096 11月 12 2010 .gnome2</span><br><span class="line">-rw-r--r--  1 magedu magedu     9 12月 27 12:52 host.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu     0 12月 27 12:52 init.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu  8120 12月 27 12:52 kdump.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu   449 12月 27 12:52 krb5.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu  1662 12月 27 12:52 latrace.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu    47 12月 27 12:52 ld.so.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu  2293 12月 27 12:52 libuser.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu   662 12月 27 12:52 logrotate.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu 10814 12月 27 12:52 ltrace.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu   827 12月 27 12:52 mke2fs.conf</span><br><span class="line">drwxr-xr-x  4 magedu magedu  4096 6月  23 2016 .mozilla</span><br><span class="line">-rw-r--r--  1 magedu magedu  2620 12月 27 12:52 mtools.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu  1688 12月 27 12:52 nsswitch.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu  1698 12月 27 12:52 ntp.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu   370 12月 27 12:52 pm-utils-hd-apm-restore.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu   789 12月 27 12:52 prelink.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu   966 12月 27 12:52 readahead.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu    81 12月 27 12:52 resolv.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu  2875 12月 27 12:52 rsyslog.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu   216 12月 27 12:52 sestatus.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu  6717 12月 27 12:52 smartd.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu   256 12月 27 12:52 sos.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu  1800 12月 27 12:52 sysctl.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu  1309 12月 27 12:52 tpvmlp.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu    45 12月 27 12:52 Trolltech.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu   485 12月 27 12:52 updatedb.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu  3008 12月 27 12:52 warnquota.conf</span><br><span class="line">-rw-r--r--  1 magedu magedu   969 12月 27 12:52 yum.conf</span><br><span class="line">[magedu@centos ~]$</span><br></pre></td></tr></table></figure><p>​    </p><p>15、扩展mylv1至9G，确保扩展完成后原有数据完全可用；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lvextend -L +4G /dev/mapper/myvg-mylv1 </span><br><span class="line">resize2fs /dev/mapper/myvg-mylv1</span><br></pre></td></tr></table></figure><p>16、缩减mylv1至7G，确保缩减完成后原有数据完全可用；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># umount /dev/vg_mage/mylv1</span></span><br><span class="line"><span class="comment"># e2fsck -f /dev/vg_mage/mylv1</span></span><br><span class="line"><span class="comment"># resize2fs /dev/vg_mage/mylv11 7G</span></span><br><span class="line"><span class="comment"># lvreduce -L 7G /dev/vg_mage/mylv1</span></span><br><span class="line"><span class="comment"># mount /dev/vg_mage/mylv1 /users/</span></span><br></pre></td></tr></table></figure><p>17、对mylv1创建快照，并通过备份数据；要求保留原有的属主属组等信息；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos users]<span class="comment"># lvcreate -s -l 20 -n snvg1 -p r /dev/vg_mage/mylv1</span></span><br><span class="line">Logical volume <span class="string">"snvg1"</span> created.</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Vim编辑器和脚本小试牛刀</title>
      <link href="/2018/08/02/Vim%E7%BC%96%E8%BE%91%E5%99%A8%E5%92%8C%E8%84%9A%E6%9C%AC%E5%B0%8F%E8%AF%95%E7%89%9B%E5%88%80/"/>
      <url>/2018/08/02/Vim%E7%BC%96%E8%BE%91%E5%99%A8%E5%92%8C%E8%84%9A%E6%9C%AC%E5%B0%8F%E8%AF%95%E7%89%9B%E5%88%80/</url>
      <content type="html"><![CDATA[<p>VIM很强大，但是万变不离其宗，最核心的三模式以下图表示：</p><p><img src="http://i.imgur.com/6np2y0D.jpg" alt=""></p><h3 id="1、复制-etc-rc-d-rc-sysinit文件至-tmp目录，将-tmp-rc-sysinit文件中的以至少一个空白字符开头的行的行首加-；"><a href="#1、复制-etc-rc-d-rc-sysinit文件至-tmp目录，将-tmp-rc-sysinit文件中的以至少一个空白字符开头的行的行首加-；" class="headerlink" title="1、复制/etc/rc.d/rc.sysinit文件至/tmp目录，将/tmp/rc.sysinit文件中的以至少一个空白字符开头的行的行首加#；"></a>1、复制/etc/rc.d/rc.sysinit文件至/tmp目录，将/tmp/rc.sysinit文件中的以至少一个空白字符开头的行的行首加#；</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/^[[:blank:]]\+.*/\0<span class="comment">#/g</span></span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="2、复制-boot-grub-grub-conf至-tmp目录中，删除-tmp-grub-conf文件中的行首的空白字符；"><a href="#2、复制-boot-grub-grub-conf至-tmp目录中，删除-tmp-grub-conf文件中的行首的空白字符；" class="headerlink" title="2、复制/boot/grub/grub.conf至/tmp目录中，删除/tmp/grub.conf文件中的行首的空白字符；"></a>2、复制/boot/grub/grub.conf至/tmp目录中，删除/tmp/grub.conf文件中的行首的空白字符；</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/^[[:space:]]\+//g</span><br></pre></td></tr></table></figure><h3 id="3、删除-tmp-rc-sysinit文件中的以-开头，且后面跟了至少一个空白字符的行行的-和空白字符"><a href="#3、删除-tmp-rc-sysinit文件中的以-开头，且后面跟了至少一个空白字符的行行的-和空白字符" class="headerlink" title="3、删除/tmp/rc.sysinit文件中的以#开头，且后面跟了至少一个空白字符的行行的#和空白字符"></a>3、删除/tmp/rc.sysinit文件中的以#开头，且后面跟了至少一个空白字符的行行的#和空白字符</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/^<span class="comment">#[[:blank:]]\+//g</span></span><br></pre></td></tr></table></figure><h3 id="4、为-tmp-grub-conf文件中前三行的行首加-号；"><a href="#4、为-tmp-grub-conf文件中前三行的行首加-号；" class="headerlink" title="4、为/tmp/grub.conf文件中前三行的行首加#号；"></a>4、为/tmp/grub.conf文件中前三行的行首加#号；</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:1,3s/^/\0<span class="comment">#/g</span></span><br></pre></td></tr></table></figure><h3 id="5、将-etc-yum-repos-d-CentOS-Media-repo文件中所有的enabled-0或gpgcheck-0的最后的0修改为1；"><a href="#5、将-etc-yum-repos-d-CentOS-Media-repo文件中所有的enabled-0或gpgcheck-0的最后的0修改为1；" class="headerlink" title="5、将/etc/yum.repos.d/CentOS-Media.repo文件中所有的enabled=0或gpgcheck=0的最后的0修改为1；"></a>5、将/etc/yum.repos.d/CentOS-Media.repo文件中所有的enabled=0或gpgcheck=0的最后的0修改为1；</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:%s/\(enabled\|gpgcheck\)=0/\1=1/g</span><br></pre></td></tr></table></figure><h3 id="6、每4小时执行一次对-etc目录的备份，备份至-backup目录中，保存的目录名为形如etc-201504020202"><a href="#6、每4小时执行一次对-etc目录的备份，备份至-backup目录中，保存的目录名为形如etc-201504020202" class="headerlink" title="6、每4小时执行一次对/etc目录的备份，备份至/backup目录中，保存的目录名为形如etc-201504020202"></a>6、每4小时执行一次对/etc目录的备份，备份至/backup目录中，保存的目录名为形如etc-201504020202</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* */4 * * * /usr/bin/cp /etc /backup/etc-$(date +%Y%m%d%H%M)/</span><br></pre></td></tr></table></figure><h3 id="7、每周2，4，6备份-var-log-messages文件至-backup-messages-logs-目录中，保存的文件名形如messages-20150402"><a href="#7、每周2，4，6备份-var-log-messages文件至-backup-messages-logs-目录中，保存的文件名形如messages-20150402" class="headerlink" title="7、每周2，4，6备份/var/log/messages文件至/backup/messages_logs/目录中，保存的文件名形如messages-20150402"></a>7、每周2，4，6备份/var/log/messages文件至/backup/messages_logs/目录中，保存的文件名形如messages-20150402</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* * * * 2,4,6   /usr/bin/cp /var/<span class="built_in">log</span>/messages /backupmessages_logs/messages-$(date +%Y%m%d)</span><br></pre></td></tr></table></figure><h3 id="8、每天每两小时取当前系统-proc-meminfo文件中的所有以S开头的信息至-stats-memory-txt文件中"><a href="#8、每天每两小时取当前系统-proc-meminfo文件中的所有以S开头的信息至-stats-memory-txt文件中" class="headerlink" title="8、每天每两小时取当前系统/proc/meminfo文件中的所有以S开头的信息至/stats/memory.txt文件中"></a>8、每天每两小时取当前系统/proc/meminfo文件中的所有以S开头的信息至/stats/memory.txt文件中</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* */2 * * * /usr/bin/grep -E <span class="string">"S.*"</span> /proc/meminfo&gt;&gt;/stats/memory.txt</span><br></pre></td></tr></table></figure><h3 id="9、工作日的工作时间内，每两小时执行一次echo-“howdy”"><a href="#9、工作日的工作时间内，每两小时执行一次echo-“howdy”" class="headerlink" title="9、工作日的工作时间内，每两小时执行一次echo “howdy”"></a>9、工作日的工作时间内，每两小时执行一次echo “howdy”</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* 9-18/2 * * 1-5        /usr/bin/<span class="built_in">echo</span> <span class="string">"howdy"</span></span><br></pre></td></tr></table></figure><h2 id="脚本编程部分"><a href="#脚本编程部分" class="headerlink" title="脚本编程部分"></a>脚本编程部分</h2><h3 id="创建目录-tmp-testdir-当前日期时间-在此目录创建100个空文件：file1-file100"><a href="#创建目录-tmp-testdir-当前日期时间-在此目录创建100个空文件：file1-file100" class="headerlink" title="创建目录/tmp/testdir-当前日期时间; 在此目录创建100个空文件：file1-file100"></a>创建目录/tmp/testdir-当前日期时间; 在此目录创建100个空文件：file1-file100</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># cat testdir</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#Author:Jerry</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /tmp &amp;&amp; mkdir testdir-$(date +%Y%m%d%H%M%S)</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> testdir-$(date +%Y%m%d%H%M%S)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..100&#125;; <span class="keyword">do</span></span><br><span class="line">    touch file<span class="variable">$i</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># bash testdir</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># ls /tmp/testdir-20161219144412/</span></span><br><span class="line">file1    file14  file2   file25  file30  file36  file41  file47  file52  file58  file63  file69  file74  file8   file85  file90  file96</span><br><span class="line">file10   file15  file20  file26  file31  file37  file42  file48  file53  file59  file64  file7   file75  file80  file86  file91  file97</span><br><span class="line">file100  file16  file21  file27  file32  file38  file43  file49  file54  file6   file65  file70  file76  file81  file87  file92  file98</span><br><span class="line">file11   file17  file22  file28  file33  file39  file44  file5   file55  file60  file66  file71  file77  file82  file88  file93  file99</span><br><span class="line">file12   file18  file23  file29  file34  file4   file45  file50  file56  file61  file67  file72  file78  file83  file89  file94</span><br><span class="line">file13   file19  file24  file3   file35  file40  file46  file51  file57  file62  file68  file73  file79  file84  file9   file95</span><br><span class="line">[root@centos7 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="12、显示-etc-passwd文件中位于第偶数行的用户的用户名；"><a href="#12、显示-etc-passwd文件中位于第偶数行的用户的用户名；" class="headerlink" title="12、显示/etc/passwd文件中位于第偶数行的用户的用户名；"></a>12、显示/etc/passwd文件中位于第偶数行的用户的用户名；</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># sed -n '2~2p' /etc/passwd |cut -d ":" -f1</span></span><br><span class="line">bin</span><br><span class="line">adm</span><br><span class="line">sync</span><br><span class="line">halt</span><br><span class="line">operator</span><br><span class="line">ftp</span><br><span class="line">avahi-autoipd</span><br><span class="line">systemd-network</span><br><span class="line">polkitd</span><br><span class="line">apache</span><br><span class="line">abrt</span><br><span class="line">unbound</span><br><span class="line">saslauth</span><br><span class="line">amandabackup</span><br><span class="line">geoclue</span><br><span class="line">setroubleshoot</span><br><span class="line">ntp</span><br><span class="line">nfsnobody</span><br><span class="line">qemu</span><br><span class="line">mysql</span><br><span class="line">pulse</span><br><span class="line">gnome-initial-setup</span><br><span class="line">sshd</span><br><span class="line">tcpdump</span><br><span class="line">hadoop</span><br><span class="line">testbash</span><br><span class="line">nologin</span><br><span class="line">user1</span><br></pre></td></tr></table></figure><h3 id="13、创建10用户user10-user19；密码同用户名；"><a href="#13、创建10用户user10-user19；密码同用户名；" class="headerlink" title="13、创建10用户user10-user19；密码同用户名；"></a>13、创建10用户user10-user19；密码同用户名；</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> &#123;10..19&#125;;<span class="keyword">do</span></span><br><span class="line">            <span class="keyword">if</span> id user<span class="variable">$i</span> ;<span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">echo</span> <span class="string">"user<span class="variable">$i</span> exists."</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                    useradd user<span class="variable">$i</span></span><br><span class="line">                    <span class="built_in">echo</span> <span class="string">"user<span class="variable">$i</span>"</span> | passwd --stdin user<span class="variable">$i</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br></pre></td></tr></table></figure><h3 id="14、在-tmp-创建10个空文件file10-file19-把file10的属主和属组改为user10，依次类推。"><a href="#14、在-tmp-创建10个空文件file10-file19-把file10的属主和属组改为user10，依次类推。" class="headerlink" title="14、在/tmp/创建10个空文件file10-file19; 把file10的属主和属组改为user10，依次类推。"></a>14、在/tmp/创建10个空文件file10-file19; 把file10的属主和属组改为user10，依次类推。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">            <span class="built_in">cd</span> /tmp/</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> &#123;10..19&#125;;<span class="keyword">do</span></span><br><span class="line">            <span class="keyword">if</span> [ -e file<span class="variable">$i</span> ] ;<span class="keyword">then</span></span><br><span class="line">                    <span class="built_in">echo</span> <span class="string">"file<span class="variable">$i</span> exists."</span></span><br><span class="line">                    chown user<span class="variable">$i</span>:user<span class="variable">$i</span> file<span class="variable">$i</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">                    touch file<span class="variable">$i</span></span><br><span class="line">                    chown user<span class="variable">$i</span>:user<span class="variable">$i</span> file<span class="variable">$i</span></span><br><span class="line">            <span class="keyword">fi</span></span><br><span class="line">    <span class="keyword">done</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>skr! grep~ skr~~find!</title>
      <link href="/2018/08/02/skr-grep-skr-find/"/>
      <url>/2018/08/02/skr-grep-skr-find/</url>
      <content type="html"><![CDATA[<p>1、显示当前系统上root、fedora或user1用户的默认shell；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -E <span class="string">"^(root|hadoop|user1)\&gt;"</span> /etc/passwd |cut -d<span class="string">":"</span> -f1,7</span><br></pre></td></tr></table></figure><p>2、找出/etc/rc.d/init.d/functions文件中某单词后面跟一组小括号的行，形如：hello()；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment"># grep  -E -o "[_[:alnum:]]+\(\)"  /etc/rc.d/init.d/functions</span></span><br><span class="line">checkpid()</span><br><span class="line">__pids_var_run()</span><br><span class="line">__pids_pidof()</span><br><span class="line">daemon()</span><br><span class="line">killproc()</span><br><span class="line">pidfileofproc()</span><br><span class="line">pidofproc()</span><br><span class="line">status()</span><br><span class="line">echo_success()</span><br><span class="line">echo_failure()</span><br><span class="line">echo_passed()</span><br><span class="line">echo_warning()</span><br><span class="line">update_boot_stage()</span><br><span class="line">success()</span><br><span class="line">failure()</span><br><span class="line">passed()</span><br><span class="line">warning()</span><br><span class="line">action()</span><br><span class="line">strstr()</span><br><span class="line">is_ignored_file()</span><br><span class="line">is_true()</span><br><span class="line">is_false()</span><br><span class="line">apply_sysctl()</span><br></pre></td></tr></table></figure><a id="more"></a><p>3、使用echo命令输出一个绝对路径，使用grep取出其基名；扩展：取出其路径名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment">#  echo "/etc/rc.d/init.d/functions" |grep -E -o "[^/]+$"</span></span><br><span class="line"><span class="built_in">functions</span></span><br><span class="line"></span><br><span class="line">[root@centos7 /]<span class="comment">#  echo "/etc/rc.d/init.d/functions" |grep -E -o  "^/.*/"</span></span><br><span class="line">/etc/rc.d/init.d/</span><br></pre></td></tr></table></figure><p>4、找出ifconfig命令结果中的1-255之间数字；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig | grep  -E  -o  <span class="string">"\&lt;([1-9]|[1-9][0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])\&gt;"</span></span><br></pre></td></tr></table></figure><p>5、挑战题：写一个模式，能匹配合理的IP地址；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -E -o <span class="string">"\&lt;([0-9]|[1-9][0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])\&gt;.\&lt;([0-9]|[1-9][0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])\&gt;.\&lt;([0-9]|[1-9][0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])\&gt;.\&lt;([0-9]|[1-9][0-9]|1[0-9]&#123;2&#125;|2[0-4][0-9]|25[0-5])\&gt;"</span></span><br></pre></td></tr></table></figure><p>6、挑战题：写一个模式，能匹配出所有的邮件地址；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -E -o “\&lt;[a-z0-9A-Z._%+-]+@[a-z0-9A-Z.-]+\.[a-zA-Z]&#123;2,6&#125;\&gt;”</span><br></pre></td></tr></table></figure><p>7、查找/var目录下属主为root，且属组为mail的所有文件或目录；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment"># find /var/ -user root -a -group mail</span></span><br><span class="line">/var/spool/mail</span><br><span class="line">/var/spool/mail/root</span><br></pre></td></tr></table></figure><p>8、查找当前系统上没有属主或属组的文件；进一步：查找当前系统上没有属主或属组，且最近3天内曾被访问过的文件或目录；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -nouser -o -nogroup -atime 3</span><br></pre></td></tr></table></figure><p>9、查找/etc目录下所有用户都有写权限的文件；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc/ -perm -020</span><br></pre></td></tr></table></figure><p>10、查找/etc目录下大于1M，且类型为普通文件的所有文件；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc/ -size +1M -<span class="built_in">type</span> f</span><br></pre></td></tr></table></figure><p>11、查找/etc/init.d/目录下，所有用户都有执行权限，且其它用户有写权限的文件；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc/init.d/ -perm -111 -perm -002</span><br></pre></td></tr></table></figure><p>12、查找/usr目录下不属于root、bin或hadoop的文件；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment"># find /usr ! \( -user root -o -user bin -o -user hadoop \)</span></span><br><span class="line">/usr/share/polkit-1/rules.d</span><br><span class="line">/usr/libexec/abrt-action-install-debuginfo-to-abrt-cache</span><br></pre></td></tr></table></figure><p>13、查找/etc/目录下至少有一类用户没有写权限的文件；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment"># find /usr ! \( -user root -o -user bin -o -user hadoop \)</span></span><br><span class="line">/usr/share/polkit-1/rules.d</span><br><span class="line">/usr/libexec/abrt-action-install-debuginfo-to-abrt-cache</span><br><span class="line">[root@centos7 /]<span class="comment"># find /usr -not \( -user root -o -user bin -o -user hadoop \)</span></span><br><span class="line">/usr/share/polkit-1/rules.d</span><br><span class="line">/usr/libexec/abrt-action-install-debuginfo-to-abrt-cache</span><br><span class="line">[root@centos7 /]<span class="comment"># find /usr ! \( -user root -o -user bin -o -user hadoop \)</span></span><br><span class="line">/usr/share/polkit-1/rules.d</span><br><span class="line">/usr/libexec/abrt-action-install-debuginfo-to-abrt-cache</span><br><span class="line">[root@centos7 /]<span class="comment"># find /etc/ -not -perm /222</span></span><br><span class="line">/etc/pki/ca-trust/extracted/java/cacerts</span><br><span class="line">/etc/pki/ca-trust/extracted/openssl/ca-bundle.trust.crt</span><br><span class="line">/etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem</span><br><span class="line">/etc/pki/ca-trust/extracted/pem/email-ca-bundle.pem</span><br><span class="line">/etc/pki/ca-trust/extracted/pem/objsign-ca-bundle.pem</span><br><span class="line">/etc/gshadow</span><br><span class="line">/etc/openldap/certs/password</span><br><span class="line">/etc/shadow</span><br><span class="line">/etc/ld.so.conf.d/kernel-3.10.0-327.el7.x86_64.conf</span><br><span class="line">/etc/ld.so.conf.d/kernel-3.10.0-327.36.3.el7.x86_64.conf</span><br><span class="line">/etc/udev/hwdb.bin</span><br><span class="line">/etc/gshadow-</span><br><span class="line">/etc/dbus-1/system.d/cups.conf</span><br><span class="line">/etc/shadow-</span><br><span class="line">/etc/lvm/profile/cache-mq.profile</span><br><span class="line">/etc/lvm/profile/cache-smq.profile</span><br><span class="line">/etc/lvm/profile/command_profile_template.profile</span><br><span class="line">/etc/lvm/profile/metadata_profile_template.profile</span><br><span class="line">/etc/lvm/profile/thin-generic.profile</span><br><span class="line">/etc/lvm/profile/thin-performance.profile</span><br><span class="line">/etc/pam.d/cups</span><br><span class="line">/etc/machine-id</span><br><span class="line">/etc/sudoers</span><br></pre></td></tr></table></figure><p>14、查找/etc目录下最近一周内其内容被修改过，且不属于root或hadoop的文件；</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find /etc -mtime -7 ! \( -user root -o -user hadoop \)</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Linux一些基本操作</title>
      <link href="/2018/08/02/Linux%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"/>
      <url>/2018/08/02/Linux%E4%B8%80%E4%BA%9B%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
      <content type="html"><![CDATA[<h3 id="一，列出当前系统上所有已经登录的用户的用户名，注意，同一个用户登录多次只显示一次即可"><a href="#一，列出当前系统上所有已经登录的用户的用户名，注意，同一个用户登录多次只显示一次即可" class="headerlink" title="一，列出当前系统上所有已经登录的用户的用户名，注意，同一个用户登录多次只显示一次即可"></a>一，列出当前系统上所有已经登录的用户的用户名，注意，同一个用户登录多次只显示一次即可</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">w -h | cut -d<span class="string">" "</span> -f1 | uniq</span><br><span class="line">who |cut -d<span class="string">" "</span> -f1|uniq</span><br></pre></td></tr></table></figure><h3 id="二，取出最后登录到当前系统的用户相关信息"><a href="#二，取出最后登录到当前系统的用户相关信息" class="headerlink" title="二，取出最后登录到当前系统的用户相关信息"></a>二，取出最后登录到当前系统的用户相关信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">w| tail -n 1</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="三，取出当前系统上被用户当作默认shell的最多的那个shell"><a href="#三，取出当前系统上被用户当作默认shell的最多的那个shell" class="headerlink" title="三，取出当前系统上被用户当作默认shell的最多的那个shell"></a>三，取出当前系统上被用户当作默认shell的最多的那个shell</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd |cut -d <span class="string">":"</span> -f7|grep /bin/bash|uniq</span><br></pre></td></tr></table></figure><h3 id="四，将-etc-passwd中的第三个字段数值最大的后10个用户的信息全部改为大写后保存至-tmp-maxusers-txt文件中"><a href="#四，将-etc-passwd中的第三个字段数值最大的后10个用户的信息全部改为大写后保存至-tmp-maxusers-txt文件中" class="headerlink" title="四，将/etc/passwd中的第三个字段数值最大的后10个用户的信息全部改为大写后保存至/tmp/maxusers.txt文件中"></a>四，将/etc/passwd中的第三个字段数值最大的后10个用户的信息全部改为大写后保存至/tmp/maxusers.txt文件中</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort -t: -k3 -n /etc/passwd |tail -10|tr <span class="string">'a-z'</span> <span class="string">'A-Z'</span> &gt; /tmp/maxusers.txt</span><br></pre></td></tr></table></figure><h3 id="五，取出当前主机的IP地址，提示：对ifconfig命令的结果进行切分。"><a href="#五，取出当前主机的IP地址，提示：对ifconfig命令的结果进行切分。" class="headerlink" title="五，取出当前主机的IP地址，提示：对ifconfig命令的结果进行切分。"></a>五，取出当前主机的IP地址，提示：对ifconfig命令的结果进行切分。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CentOS7    </span><br><span class="line">ifconfig |grep inet |cut -d<span class="string">' '</span> -f10|head -1</span><br></pre></td></tr></table></figure><h3 id="六，列出-etc-目录下所有以-conf结尾的文件的文件名，并将其名字转换为大写后保存至-tmp-etc-conf文件中"><a href="#六，列出-etc-目录下所有以-conf结尾的文件的文件名，并将其名字转换为大写后保存至-tmp-etc-conf文件中" class="headerlink" title="六，列出/etc/目录下所有以.conf结尾的文件的文件名，并将其名字转换为大写后保存至/tmp/etc.conf文件中"></a>六，列出/etc/目录下所有以.conf结尾的文件的文件名，并将其名字转换为大写后保存至/tmp/etc.conf文件中</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll /etc/*.conf|cut -d<span class="string">'/'</span> -f3|tr <span class="string">'a-z'</span> <span class="string">'A-Z'</span> &gt;/tmp/etc.conf</span><br></pre></td></tr></table></figure><h3 id="七，显示-var目录下一级子目录或文件的总个数"><a href="#七，显示-var目录下一级子目录或文件的总个数" class="headerlink" title="七，显示/var目录下一级子目录或文件的总个数"></a>七，显示/var目录下一级子目录或文件的总个数</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al /var/|head -1|cut -d<span class="string">' '</span> -f2</span><br></pre></td></tr></table></figure><h3 id="八，取出-etc-group文件中第三个字段数值最小的10个组的名字"><a href="#八，取出-etc-group文件中第三个字段数值最小的10个组的名字" class="headerlink" title="八，取出/etc/group文件中第三个字段数值最小的10个组的名字"></a>八，取出/etc/group文件中第三个字段数值最小的10个组的名字</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort -t: -k3 -n /etc/group|head -10|cut -d<span class="string">':'</span> -f1</span><br></pre></td></tr></table></figure><h3 id="九，将-etc-fstab和-etc-issue文件的内容合并为同一个内容保存至-tmp-etc-test文件中"><a href="#九，将-etc-fstab和-etc-issue文件的内容合并为同一个内容保存至-tmp-etc-test文件中" class="headerlink" title="九，将/etc/fstab和/etc/issue文件的内容合并为同一个内容保存至/tmp/etc.test文件中"></a>九，将/etc/fstab和/etc/issue文件的内容合并为同一个内容保存至/tmp/etc.test文件中</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/fstab /etc/issue &gt; /tmp/etc.test</span><br></pre></td></tr></table></figure><h3 id="十，请总结描述用户和组管理类命令的使用方法并完成练习"><a href="#十，请总结描述用户和组管理类命令的使用方法并完成练习" class="headerlink" title="十，请总结描述用户和组管理类命令的使用方法并完成练习"></a>十，请总结描述用户和组管理类命令的使用方法并完成练习</h3><p>(1)、创建组distro，其GID为2016;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd distro -g 2016</span><br></pre></td></tr></table></figure><p>(2)、创建用户mandriva, 其ID号为1005；基本组为distro;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adduser mandriva -u 1005 -g distro</span><br></pre></td></tr></table></figure><p>(3)、创建用户mageia，其ID号为1100，家目录为/home/linux;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd mageia -u 1100 -d /home/linux</span><br></pre></td></tr></table></figure><p>(4)、给用户mageia添加密码，密码为mageedu;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 home]<span class="comment"># passwd mageia </span></span><br><span class="line">更改用户 mageia 的密码 。</span><br><span class="line">新的 密码：</span><br><span class="line">无效的密码： 密码少于 8 个字符</span><br><span class="line">重新输入新的 密码：</span><br><span class="line">passwd：所有的身份验证令牌已经成功更新。</span><br><span class="line">[root@centos7 home]<span class="comment">#</span></span><br></pre></td></tr></table></figure><p>(5)、删除mandriva，但保留其家目录;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel mandriva</span><br></pre></td></tr></table></figure><p>(6)、创建用户slackware，其ID号为2002，基本组为distro，附加组peguin;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd peguin &amp;&amp; useradd slackware -u 2002 -g distro -G peguin</span><br></pre></td></tr></table></figure><p>(7)、修改slackware的默认shell为/bin/tcsh;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">usermod -s /usr/bin/tcsh slackware</span><br></pre></td></tr></table></figure><p>(8)、为用户slackware新增附加组admins;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd admins &amp;&amp; usermod -G admins slackware</span><br></pre></td></tr></table></figure><p>(9)、为slackware添加密码，且要求密码最短使用期限为3天，最长为180天，警告为3天;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"123456"</span> | passwd --stdin slackware</span><br><span class="line">passwd -n 3 -x 180 -w 3 slackware</span><br></pre></td></tr></table></figure><p>(10)、添加用户openstack，其ID号为3003, 基本组为clouds，附加组为peguin和nova;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd nova &amp;&amp; groupadd clouds &amp;&amp; useradd openstack -u 3003 -g clouds -G peguin,nova</span><br></pre></td></tr></table></figure><p>(11)、添加系统用户mysql，要求其shell为/sbin/nologin;</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -s /sbin/nologin mysql</span><br></pre></td></tr></table></figure><p>(12)、使用echo命令，非交互式为openstack添加密码.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"123456"</span> | passwd –stdin openstack</span><br></pre></td></tr></table></figure>]]></content>
      
      
    </entry>
    
    <entry>
      <title>Linux上的文件管理类命令其常用的使用方法及其相关示例演示</title>
      <link href="/2018/08/02/Linux%E4%B8%8A%E7%9A%84%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E7%B1%BB%E5%91%BD%E4%BB%A4%E5%85%B6%E5%B8%B8%E7%94%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3%E7%A4%BA%E4%BE%8B%E6%BC%94%E7%A4%BA/"/>
      <url>/2018/08/02/Linux%E4%B8%8A%E7%9A%84%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E7%B1%BB%E5%91%BD%E4%BB%A4%E5%85%B6%E5%B8%B8%E7%94%A8%E7%9A%84%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%E5%8F%8A%E5%85%B6%E7%9B%B8%E5%85%B3%E7%A4%BA%E4%BE%8B%E6%BC%94%E7%A4%BA/</url>
      <content type="html"><![CDATA[<h2 id="目录管理类的命令"><a href="#目录管理类的命令" class="headerlink" title="目录管理类的命令"></a>目录管理类的命令</h2><h3 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h3><p>用法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir [选项]... 目录...</span><br></pre></td></tr></table></figure><p>选项： </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-p 递归创建多个目录</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># mkdir -p /tmp/jerry/2016/11/4</span></span><br><span class="line">[root@centos7 /]<span class="comment"># tree /tmp</span></span><br><span class="line"> /tmp</span><br><span class="line">├── akonadi-root.9I0Ba3</span><br><span class="line">├── anaconda.log</span><br><span class="line">├── hogsuspend</span><br><span class="line">├── hsperfdata_root</span><br><span class="line">│   └── 88148</span><br><span class="line">├── hsperfdata_user</span><br><span class="line">├── ifcfg.log</span><br><span class="line">├── jerry</span><br><span class="line">│   └── 2016</span><br><span class="line">│       └── 11</span><br><span class="line">│           └──4</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">**注意：**</span><br><span class="line">**centos7&amp;6默认没有安装tree命令，记得yum install tree 就OK。**</span><br></pre></td></tr></table></figure><a id="more"></a><p>选项：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-v 显示创建过程即命令执行过程</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment"># mkdir -pv /tmp/aaa/bbb/ccc/2016/11qa</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/aaa"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/aaa/bbb"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/aaa/bbb/ccc"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/aaa/bbb/ccc/2016"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/aaa/bbb/ccc/2016/11qa"</span></span><br></pre></td></tr></table></figure><p>选项：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-m：设定目录权限，不加则为默认权限</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment"># mkdir -m 777 -pv /tmp/fbi/cia</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/fbi"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/fbi/cia"</span>    </span><br><span class="line">[root@centos7 /]<span class="comment"># ll /tmp/fbi</span></span><br><span class="line">总用量 0</span><br><span class="line">drwxrwxrwx. 2 root root 6 11月  4 15:52 cia</span><br><span class="line"></span><br><span class="line">[root@centos7 /]<span class="comment"># mkdir -m 775 -pv /tmp/hbo/oom/ubuntu</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/hbo"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/hbo/oom"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/hbo/oom/ubuntu</span></span><br><span class="line"><span class="string">[root@centos7 /]# ll /tmp/hbo/oom/</span></span><br><span class="line"><span class="string">总用量 0</span></span><br><span class="line"><span class="string">drwxrwxr-x. 2 root root 6 11月  4 16:00 ubuntu</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">注意：-m 参数设定的目录权限只对最后一级的目录生效，其上级目录均是默认的755。哈哈~~</span></span><br></pre></td></tr></table></figure><h3 id="rmdir"><a href="#rmdir" class="headerlink" title="rmdir"></a>rmdir</h3><p>用法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rmdir [选项]... 目录...</span><br></pre></td></tr></table></figure><p>选项参数：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    --ignore-fail-on-non-empty</span><br><span class="line">         忽略仅由目录非空产生的所有错误</span><br><span class="line">-p, --parents   remove DIRECTORY and its ancestors; e.g., <span class="string">'rmdir -p a/b/c'</span> is</span><br><span class="line">                similar to <span class="string">'rmdir a/b/c a/b a'</span></span><br><span class="line">-v, --verbose   output a diagnostic <span class="keyword">for</span> every directory processed</span><br><span class="line">    --<span class="built_in">help</span> 显示此帮助信息并退出</span><br><span class="line">    --version 显示版本信息并退出</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 tmp]<span class="comment"># rmdir -pv fbi/cia/</span></span><br><span class="line">rmdir: 正在删除目录 <span class="string">"fbi/cia/"</span></span><br><span class="line">rmdir: 正在删除目录 <span class="string">"fbi"</span></span><br></pre></td></tr></table></figure><h2 id="文件查看类命令"><a href="#文件查看类命令" class="headerlink" title="文件查看类命令"></a>文件查看类命令</h2><h3 id="cat"><a href="#cat" class="headerlink" title="cat"></a>cat</h3><p>用法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">用法：cat [选项]... [文件]...</span><br><span class="line">将[文件]或标准输入组合输出到标准输出。</span><br></pre></td></tr></table></figure><p>选项：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-A, --show-all           等于-vET</span><br><span class="line">-b, --number-nonblank    对非空输出行编号</span><br><span class="line">-e                       等于-vE</span><br><span class="line">-E, --show-ends          在每行结束处显示<span class="string">"$"</span></span><br><span class="line">-n, --number             对输出的所有行编号</span><br><span class="line">-s, --squeeze-blank      不输出多行空行</span><br><span class="line">-t                       与-vT 等价</span><br><span class="line">-T, --show-tabs          将跳格字符显示为^I</span><br><span class="line">-u                       (被忽略)</span><br><span class="line">-v, --show-nonprinting   使用^ 和M- 引用，除了LFD和 TAB 之外</span><br><span class="line">    --<span class="built_in">help</span>显示此帮助信息并退出</span><br><span class="line">    --version显示版本信息并退出</span><br></pre></td></tr></table></figure><p>平时可能用到的选项就是输出行号了，实例如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment"># cat -n /etc/rc.local </span></span><br><span class="line"> 1<span class="comment">#!/bin/bash</span></span><br><span class="line"> 2<span class="comment"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</span></span><br><span class="line"> 3<span class="comment">#</span></span><br><span class="line"> 4<span class="comment"># It is highly advisable to create own systemd services or udev rules</span></span><br><span class="line"> 5<span class="comment"># to run scripts during boot instead of using this file.</span></span><br><span class="line"> 6<span class="comment">#</span></span><br><span class="line"> 7<span class="comment"># In contrast to previous versions due to parallel execution during boot</span></span><br><span class="line"> 8<span class="comment"># this script will NOT be run after all other services.</span></span><br><span class="line"> 9<span class="comment">#</span></span><br><span class="line">10<span class="comment"># Please note that you must run 'chmod +x /etc/rc.d/rc.local' to ensure</span></span><br><span class="line">11<span class="comment"># that this script will be executed during boot.</span></span><br><span class="line">12</span><br><span class="line">13touch /var/lock/subsys/<span class="built_in">local</span></span><br><span class="line">[root@centos7 /]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="tac"><a href="#tac" class="headerlink" title="tac"></a>tac</h3><p>tac命令：与cat功能相近，只是逆序显示文件内容</p><h3 id="head"><a href="#head" class="headerlink" title="head"></a>head</h3><p>用法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">head [选项]... [文件]...</span><br><span class="line">查看文件的前N行，默认为10行</span><br></pre></td></tr></table></figure><p>选项：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-n </span><br><span class="line">-#</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># head  /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">[root@centos7 ~]<span class="comment"># head - 15 /etc/passwd</span></span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># head -15 /etc/passwd</span></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">operator:x:11:0:operator:/root:/sbin/nologin</span><br><span class="line">games:x:12:100:games:/usr/games:/sbin/nologin</span><br><span class="line">ftp:x:14:50:FTP User:/var/ftp:/sbin/nologin</span><br><span class="line">nobody:x:99:99:Nobody:/:/sbin/nologin</span><br><span class="line">avahi-autoipd:x:170:170:Avahi IPv4LL Stack:/var/lib/avahi-autoipd:/sbin/nologin</span><br><span class="line">systemd-bus-proxy:x:999:997:systemd Bus Proxy:/:/sbin/nologin</span><br></pre></td></tr></table></figure><h3 id="tail"><a href="#tail" class="headerlink" title="tail"></a>tail</h3><p>用法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tail [选项]... [文件]...</span><br></pre></td></tr></table></figure><p>选项参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-n：指定显示的行数。不加任何参数默认显示10行，从最后一行开始；</span><br><span class="line">-#：直接指定显示的行数，从最后一行开始；</span><br><span class="line">-f：查看文件尾部内容结束后不退出，跟随显示新增的行；</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># tail -2 /etc/passwd</span></span><br><span class="line">tcpdump:x:72:72::/:/sbin/nologin</span><br><span class="line">user:x:1000:1000:user:/home/user:/bin/bash</span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># tail /etc/passwd</span></span><br><span class="line">mysql:x:27:27:MariaDB Server:/var/lib/mysql:/sbin/nologin</span><br><span class="line">pcp:x:988:985:Performance Co-Pilot:/var/lib/pcp:/sbin/nologin</span><br><span class="line">pulse:x:171:171:PulseAudio System Daemon:/var/run/pulse:/sbin/nologin</span><br><span class="line">gdm:x:42:42::/var/lib/gdm:/sbin/nologin</span><br><span class="line">gnome-initial-setup:x:987:982::/run/gnome-initial-setup/:/sbin/nologin</span><br><span class="line">avahi:x:70:70:Avahi mDNS/DNS-SD Stack:/var/run/avahi-daemon:/sbin/nologin</span><br><span class="line">sshd:x:74:74:Privilege-separated SSH:/var/empty/sshd:/sbin/nologin</span><br><span class="line">oprofile:x:16:16:Special user account to be used by OProfile:/var/lib/oprofile:/sbin/nologin</span><br><span class="line">tcpdump:x:72:72::/:/sbin/nologin</span><br><span class="line">user:x:1000:1000:user:/home/user:/bin/bash</span><br></pre></td></tr></table></figure><h3 id="more"><a href="#more" class="headerlink" title="more"></a>more</h3><p>用法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">more [选项] 文件...</span><br><span class="line">特点：翻屏至文件尾部后自动退出；</span><br></pre></td></tr></table></figure><p>选项参数：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">-d        显示帮助，而不是响铃</span><br><span class="line">-f        统计逻辑行数而不是屏幕行数</span><br><span class="line">-l        抑制换页(form feed)后的暂停</span><br><span class="line">-p        不滚屏，清屏并显示文本</span><br><span class="line">-c        不滚屏，显示文本并清理行尾</span><br><span class="line">-u        抑制下划线</span><br><span class="line">-s        将多个空行压缩为一行</span><br><span class="line">-NUM      指定每屏显示的行数为 NUM</span><br><span class="line">+NUM      从文件第 NUM 行开始显示</span><br><span class="line">+/STRING  从匹配搜索字符串 STRING 的文件位置开始显示</span><br><span class="line">-V        输出版本信息并退出</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">略过，给你个眼神自己体会^_^</span><br></pre></td></tr></table></figure><h3 id="less"><a href="#less" class="headerlink" title="less"></a>less</h3><p> 特点： 其实man读取帮助手册就是调用的less指令。所以less命令的操作方式同man</p><h2 id="文件管理类命令"><a href="#文件管理类命令" class="headerlink" title="文件管理类命令"></a>文件管理类命令</h2><h3 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h3><p>用法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">单源复制：cp [OPTION]... [-T] SOURCE DEST</span><br><span class="line">多源复制：cp [OPTION]... SOURCE... DIRECTORY</span><br><span class="line">         cp [OPTION]... -t DIRECTORY SOURCE...</span><br><span class="line"></span><br><span class="line">单源复制：cp [OPTION]... [-T] SOURCE DEST</span><br><span class="line">         如果DEST不存在：则事先创建此文件，并复制源文件的数据流至DEST中；</span><br><span class="line">        如果DEST存在：</span><br><span class="line">            如果DEST是非目录文件：则覆盖目标文件；</span><br><span class="line">            如果DEST是目录文件：则先在DEST目录下创建一个与源文件同名的文件，并复制其数据流；</span><br><span class="line"></span><br><span class="line">多源复制：cp [OPTION]... SOURCE... DIRECTORY</span><br><span class="line">         cp [OPTION]... -t DIRECTORY SOURCE...</span><br><span class="line"></span><br><span class="line">        如果DEST不存在：错误；</span><br><span class="line">        如果DEST存在：</span><br><span class="line">        如果DEST是非目录文件：错误；</span><br><span class="line">        如果DEST是目录文件：分别复制每个文件至目标目录中，并保持原名；</span><br></pre></td></tr></table></figure><p>选项参数：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-i：交互式复制，即覆盖之前提醒用户确认；</span><br><span class="line">-f：强制覆盖目标文件；</span><br><span class="line">-r, -R：递归复制目录；</span><br><span class="line">-d：复制符号链接文件本身，而非其指向的源文件；</span><br><span class="line">-a：-dR --preserve=all, archive，用于实现归档；</span><br><span class="line">--preserv=</span><br><span class="line">      mode：权限</span><br><span class="line">      ownership：属主和属组</span><br><span class="line">      timestamps: 时间戳</span><br><span class="line">      context：安全标签</span><br><span class="line">      xattr：扩展属性</span><br><span class="line">      links：符号链接</span><br><span class="line">      all：上述所有属性</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">`单源复制-目标文件不存在情况`</span><br><span class="line">[root@centos ~]<span class="comment"># ls /tmp/</span></span><br><span class="line">whatis.q3Uigb  yum.log</span><br><span class="line">[root@centos ~]<span class="comment"># cp /etc/issue /tmp</span></span><br><span class="line">[root@centos ~]<span class="comment"># ls /tmp/</span></span><br><span class="line">issue  whatis.q3Uigb  yum.log</span><br><span class="line">[root@centos ~]<span class="comment"># cat /tmp/issue </span></span><br><span class="line">CentOS release 6.5 (Final)</span><br><span class="line">Kernel \r on an \m</span><br><span class="line"></span><br><span class="line">`单源复制-目标文件已存在情况`</span><br><span class="line">[root@centos ~]<span class="comment"># cp /etc/hosts /tmp/issue </span></span><br><span class="line">cp: overwrite `/tmp/issue<span class="string">'? y</span></span><br><span class="line"><span class="string">[root@centos ~]# cat /tmp/issue </span></span><br><span class="line"><span class="string"> 127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span><br><span class="line"><span class="string"> ::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`多源复制-目标目录不存在情况`</span></span><br><span class="line"><span class="string">[root@centos ~]# cp /etc/hosts /etc/issue /tmp/x</span></span><br><span class="line"><span class="string">cp: target `/tmp/x'</span> is not a directory</span><br><span class="line"></span><br><span class="line">`多源复制-目标目录已存在情况`</span><br><span class="line">[root@centos ~]<span class="comment"># mkdir /tmp/x</span></span><br><span class="line">[root@centos ~]<span class="comment"># cp /etc/hosts /etc/issue /tmp/x</span></span><br><span class="line">[root@centos ~]<span class="comment"># ls /tmp/x</span></span><br><span class="line">hosts  issue</span><br><span class="line">[root@centos ~]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line">`-r选项实例`</span><br><span class="line">[root@centos ~]<span class="comment"># mkdir -p /tmp/souce/x/y/z</span></span><br><span class="line">[root@centos ~]<span class="comment"># mkdir /tmp/dest</span></span><br><span class="line">[root@centos ~]<span class="comment"># cp -r /tmp/souce/ /tmp/dest/</span></span><br><span class="line">[root@centos ~]<span class="comment"># tree /tmp/dest/    /tmp/dest/</span></span><br><span class="line">└── souce</span><br><span class="line">    └── x</span><br><span class="line">        └── y</span><br><span class="line">            └── z</span><br><span class="line"></span><br><span class="line">4 directories, 0 files</span><br><span class="line">[root@centos ~]<span class="comment"># </span></span><br><span class="line"></span><br><span class="line">`--preserve选项实例`</span><br><span class="line">[root@centos ~]<span class="comment"># ls -l /tmp/ |grep liubin</span></span><br><span class="line">-rw-rw-r--. 1 liubin liubin    0 Sep 27 04:56 liubin    </span><br><span class="line">[root@centos ~]<span class="comment"># cp --preserve=ownership /tmp/liubin /tmp/root</span></span><br><span class="line">[root@centos ~]<span class="comment"># ls -l /tmp/</span></span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x. 3 root   root   4096 Sep 27 04:53 dest</span><br><span class="line">-rw-r--r--. 1 root   root    158 Sep 27 04:43 issue    </span><br><span class="line">-rw-rw-r--. 1 liubin liubin    0 Sep 27 04:56 liubin    </span><br><span class="line">-rw-rw-r--. 1 liubin liubin    0 Sep 27 04:59 root    </span><br><span class="line">drwxr-xr-x. 3 root   root   4096 Sep 27 04:49 souce</span><br><span class="line">drwxr-xr-x. 2 root   root   4096 Sep 27 04:44 x</span><br><span class="line">-rw-------. 1 root   root      0 Sep 27 03:07 yum.log</span><br></pre></td></tr></table></figure><h3 id="mv"><a href="#mv" class="headerlink" title="mv"></a>mv</h3><p>用法：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mv [OPTION]... [-T] SOURCE DEST</span><br><span class="line">mv [OPTION]... SOURCE... DIRECTORY</span><br><span class="line">mv [OPTION]... -t DIRECTORY SOURCE..</span><br></pre></td></tr></table></figure><p>选项参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-i：交互式    </span><br><span class="line">-f：强制移动</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># tree test</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">|-- 1p2a</span><br><span class="line">|-- 28pa</span><br><span class="line">|-- Pa99</span><br><span class="line">|-- cpdoc.txt</span><br><span class="line">|-- hahaha</span><br><span class="line">|   |-- cpdoc.txt</span><br><span class="line">|   |-- cpdoc1.txt</span><br><span class="line">|   `-- text.txt</span><br><span class="line">|-- p,a</span><br><span class="line">|-- pa</span><br><span class="line">|-- pa12</span><br><span class="line">`-- papi</span><br><span class="line"></span><br><span class="line">1 directory, 11 files</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mv test/1p2a test/hahaha</span></span><br><span class="line">[root@localhost ~]<span class="comment"># tree test</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">|-- 28pa</span><br><span class="line">|-- Pa99</span><br><span class="line">|-- cpdoc.txt</span><br><span class="line">|-- hahaha</span><br><span class="line">|   |-- 1p2a</span><br><span class="line">|   |-- cpdoc.txt</span><br><span class="line">|   |-- cpdoc1.txt</span><br><span class="line">|   `-- text.txt</span><br><span class="line">|-- p,a</span><br><span class="line">|-- pa</span><br><span class="line">|-- pa12</span><br><span class="line">`-- papi</span><br><span class="line"></span><br><span class="line">1 directory, 11 files</span><br><span class="line"></span><br><span class="line">[root@localhost ~]<span class="comment"># mv test/hahaha test/mvtest</span></span><br><span class="line">[root@localhost ~]<span class="comment"># tree test</span></span><br><span class="line"><span class="built_in">test</span></span><br><span class="line">|-- 28pa</span><br><span class="line">|-- Pa99</span><br><span class="line">|-- cpdoc.txt</span><br><span class="line">|-- mvtest</span><br><span class="line">|   |-- 1p2a</span><br><span class="line">|   |-- cpdoc.txt</span><br><span class="line">|   |-- cpdoc1.txt</span><br><span class="line">|   `-- text.txt</span><br><span class="line">|-- p,a</span><br><span class="line">|-- pa</span><br><span class="line">|-- pa12</span><br><span class="line">`-- papi</span><br><span class="line"></span><br><span class="line">1 directory, 11 files</span><br></pre></td></tr></table></figure><h3 id="rm"><a href="#rm" class="headerlink" title="rm"></a>rm</h3><p>用法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm [OPTION]... FILE...</span><br></pre></td></tr></table></figure><p>选项参数：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-i：interactive</span><br><span class="line">-f：force</span><br><span class="line">-r: recursive</span><br></pre></td></tr></table></figure><p>实例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># ls /tmp</span></span><br><span class="line">dest  issue  liubin  root  souce  yum.log</span><br><span class="line">[root@centos ~]<span class="comment"># tree /tmp/souce/</span></span><br><span class="line">/tmp/souce/</span><br><span class="line">└── x</span><br><span class="line">    └── y</span><br><span class="line">        └── z    </span><br><span class="line">3 directories, 0 files</span><br><span class="line">[root@centos ~]<span class="comment"># rm -rf /tmp/souce/</span></span><br><span class="line">[root@centos ~]<span class="comment"># ls</span></span><br><span class="line">anaconda-ks.cfg  install.log  install.log.syslog</span><br><span class="line">[root@centos ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="bash的工作特性之命令执行状态返回值和命令行展开所涉及的内容及其示例演示。"><a href="#bash的工作特性之命令执行状态返回值和命令行展开所涉及的内容及其示例演示。" class="headerlink" title="bash的工作特性之命令执行状态返回值和命令行展开所涉及的内容及其示例演示。"></a>bash的工作特性之命令执行状态返回值和命令行展开所涉及的内容及其示例演示。</h2><h2 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h2><p>echo $?：显示最近一条命令的执行结果</p><p>只能查看最近一条命令的执行的状态结果返回值</p><p>命令执行成功，则显示：0</p><p>命令执行失败，则显示：1-255之间的任意数字 </p><h2 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># ls /var</span></span><br><span class="line">account  cache  db     games   kerberos  <span class="built_in">local</span>  <span class="built_in">log</span>   nis  preserve  spool   tmp  yp</span><br><span class="line">adm      crash  empty  gopher  lib       lock   mail  opt  run       target  www</span><br><span class="line">[root@centos7 ~]<span class="comment"># echo $?</span></span><br><span class="line">0</span><br><span class="line">[root@centos7 ~]<span class="comment"># ls /varte</span></span><br><span class="line">ls: 无法访问/varte: 没有那个文件或目录</span><br><span class="line">[root@centos7 ~]<span class="comment"># echo $?</span></span><br><span class="line">2</span><br><span class="line">[root@centos7 ~]<span class="comment"># lsd /var</span></span><br><span class="line">bash: lsd: 未找到命令...</span><br><span class="line">[root@centos7 ~]<span class="comment"># echo $?</span></span><br><span class="line">127</span><br><span class="line">[root@centos7 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="创建-tmp目录下的：a-c-a-d-b-c-b-d"><a href="#创建-tmp目录下的：a-c-a-d-b-c-b-d" class="headerlink" title="创建/tmp目录下的：a_c, a_d, b_c, b_d"></a>创建/tmp目录下的：a_c, a_d, b_c, b_d</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment">#  mkdir -v /tmp/&#123;a,b&#125;_&#123;c,d&#125;</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/a_c"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/a_d"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/b_c"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/b_d"</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># ls /tmp/</span></span><br><span class="line">a_c</span><br><span class="line">a_d</span><br><span class="line">anaconda.log</span><br><span class="line">b_c </span><br><span class="line">b_d</span><br></pre></td></tr></table></figure><h3 id="创建-tmp-mylinux目录下的："><a href="#创建-tmp-mylinux目录下的：" class="headerlink" title="创建/tmp/mylinux目录下的："></a>创建/tmp/mylinux目录下的：</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mylinux</span><br><span class="line">├── bin</span><br><span class="line">├── boot</span><br><span class="line">│   └── grub</span><br><span class="line">├── dev</span><br><span class="line">├── etc</span><br><span class="line">│   ├── rc.d</span><br><span class="line">│   │   └── init.d</span><br><span class="line">│   └── sysconfig</span><br><span class="line">│       └── network-scripts</span><br><span class="line">├── lib</span><br><span class="line">│   └── modules</span><br><span class="line">├── lib64</span><br><span class="line">├── proc</span><br><span class="line">├── sbin</span><br><span class="line">├── sys</span><br><span class="line">├── tmp</span><br><span class="line">├── usr</span><br><span class="line">│   └── <span class="built_in">local</span></span><br><span class="line">│       ├── bin</span><br><span class="line">│       └── sbin</span><br><span class="line">└── var</span><br><span class="line">    ├── lock</span><br><span class="line">    ├── <span class="built_in">log</span></span><br><span class="line">    └── run</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 ~]<span class="comment"># mkdir -pv /tmp/mylinux/&#123;bin,boot/grub,dev,etc/&#123;rc.d/init.d,sysconfig/network-scripts&#125;,lib/modules,lib64,proc,sbin,sys,tmp,usr/local/&#123;bin,sbin&#125;,var/&#123;lock,log,run&#125;&#125;</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/bin"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/boot"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/boot/grub"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/dev"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/etc"</span> </span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/etc/rc.d"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/etc/rc.d/init.d"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/etc/sysconfig"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/etc/sysconfig/network-scripts"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/lib"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/lib/modules"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/lib64"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/proc"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/sbin"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/sys"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/tmp"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/usr"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/usr/local"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/usr/local/bin"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/usr/local/sbin"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/var"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/var/lock"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/var/log"</span></span><br><span class="line">mkdir: 已创建目录 <span class="string">"/tmp/mylinux/var/run"</span></span><br><span class="line">[root@centos7 ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="文件的元数据信息有哪些，分别表示什么含义，如何查看？如何修改文件的时间戳信息。"><a href="#文件的元数据信息有哪些，分别表示什么含义，如何查看？如何修改文件的时间戳信息。" class="headerlink" title="文件的元数据信息有哪些，分别表示什么含义，如何查看？如何修改文件的时间戳信息。"></a>文件的元数据信息有哪些，分别表示什么含义，如何查看？如何修改文件的时间戳信息。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 etc]<span class="comment"># stat /bin/bash</span></span><br><span class="line">文件：<span class="string">"/bin/bash"</span></span><br><span class="line">大小：960392    块：1880       IO 块：4096   普通文件</span><br><span class="line">设备：fd00h/64768dInode：67111627    硬链接：1</span><br><span class="line">权限：(0755/-rwxr-xr-x)  Uid：(    0/    root)   Gid：(    0/    root)</span><br><span class="line">环境：system_u:object_r:shell_exec_t:s0 </span><br><span class="line">最近访问：2016-11-06 13:06:17.318000042 +0800</span><br><span class="line">最近更改：2016-08-03 00:00:07.000000000 +0800</span><br><span class="line">最近改动：2016-11-03 13:47:45.414998262 +0800</span><br><span class="line">创建时间：-</span><br><span class="line"></span><br><span class="line">touch命令：</span><br><span class="line">touch - change file timestamps</span><br><span class="line"></span><br><span class="line">touch [OPTION]... FILE...</span><br><span class="line"> -c: 指定的文件路径不存在时不予创建；</span><br><span class="line"> -a: 仅修改access time；</span><br><span class="line"> -m：仅修改modify time；</span><br><span class="line"> -t STAMP</span><br><span class="line">[[CC]YY]MMDDhhmm[.ss]</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">实例一：创建不存在的文件</span><br><span class="line"></span><br><span class="line">命令：</span><br><span class="line">touch log2012.log log2013.log</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">［root@localhost <span class="built_in">test</span>］<span class="comment"># touch log2012.log log2013.log</span></span><br><span class="line">［root@localhost <span class="built_in">test</span>］<span class="comment"># ll</span></span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 16:01 log2012.log</span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 16:01 log2013.log</span><br><span class="line"></span><br><span class="line">如果log2014.log不存在，则不创建文件</span><br><span class="line">［root@localhost <span class="built_in">test</span>］<span class="comment"># touch -c log2014.log</span></span><br><span class="line">［root@localhost <span class="built_in">test</span>］<span class="comment"># ll</span></span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 16:01 log2012.log</span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 16:01 log2013.log</span><br><span class="line"></span><br><span class="line">实例二：更新log.log的时间和log2012.log时间戳相同</span><br><span class="line"></span><br><span class="line">命令：</span><br><span class="line">touch -r log.log log2012.log</span><br><span class="line">   </span><br><span class="line">输出：</span><br><span class="line">［root@localhost <span class="built_in">test</span>］<span class="comment"># ll</span></span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 16:01 log2012.log</span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 16:01 log2013.log</span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 14:48 log.log</span><br><span class="line">［root@localhost <span class="built_in">test</span>］<span class="comment"># touch -r log.log log2012.log</span></span><br><span class="line">［root@localhost <span class="built_in">test</span>］<span class="comment"># ll</span></span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 14:48 log2012.log</span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 16:01 log2013.log</span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 14:48 log.log</span><br><span class="line"></span><br><span class="line">实例三：设定文件的时间戳</span><br><span class="line">   </span><br><span class="line">命令：</span><br><span class="line">touch -t 201211142234.50 log.log</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">［root@localhost <span class="built_in">test</span>］<span class="comment"># ll</span></span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 14:48 log2012.log</span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 16:01 log2013.log</span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 14:48 log.log</span><br><span class="line">［root@localhost <span class="built_in">test</span>］<span class="comment"># touch -t 201211142234.50 log.log</span></span><br><span class="line">［root@localhost <span class="built_in">test</span>］<span class="comment"># ll</span></span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 14:48 log2012.log</span><br><span class="line"> -rw-r--r-- 1 root root 0 10-28 16:01 log2013.log</span><br><span class="line"> -rw-r--r-- 1 root root 0 2012-11-14 log.log</span><br><span class="line"></span><br><span class="line">说明：</span><br><span class="line"> -t time 使用指定的时间值 time 作为指定文件相应时间戳记的新值．此处的 time规定为如下形式的十进制数：</span><br><span class="line">［［CC］YY］MMDDhhmm［.SS］</span><br><span class="line">   </span><br><span class="line"> 这里，CC为年数中的前两位，即”世纪数”；YY为年数的后两位，即某世纪中的年数．如果不给出CC的值，则touch 将把年数CCYY限定1969--2068之内．MM为月数，DD为天将把年数CCYY限定在1969--2068之内．MM为月数，DD为天数，hh 为小时数（几点），mm为分钟数，SS为秒数．此处秒的设定范围是0--61，这样可以处理闰秒．这些数字组成的时间是环境变量TZ指定的时区中的一个时 间．由于系统的限制，早于1970年1月1日的时间是错误的</span><br></pre></td></tr></table></figure><h3 id="如何定义一个命令的别名，如何在命令中引用另一个命令的执行结果？"><a href="#如何定义一个命令的别名，如何在命令中引用另一个命令的执行结果？" class="headerlink" title="如何定义一个命令的别名，如何在命令中引用另一个命令的执行结果？"></a>如何定义一个命令的别名，如何在命令中引用另一个命令的执行结果？</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">命令别名查看：</span><br><span class="line"></span><br><span class="line">[root@centos ~]<span class="comment"># alias</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> cp=<span class="string">'cp -i'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> l.=<span class="string">'ls -d .* --color=auto'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> ll=<span class="string">'ls -l --color=auto'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> ls=<span class="string">'ls --color=auto'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> mv=<span class="string">'mv -i'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> rm=<span class="string">'rm -i'</span></span><br><span class="line"></span><br><span class="line">创建别名：</span><br><span class="line"></span><br><span class="line">[root@centos ~]<span class="comment"># alias clear='cls'</span></span><br><span class="line"></span><br><span class="line">[root@centos ~]<span class="comment"># alias</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> clear=<span class="string">'cls'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> cp=<span class="string">'cp -i'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> l.=<span class="string">'ls -d .* --color=auto'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> ll=<span class="string">'ls -l --color=auto'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> ls=<span class="string">'ls --color=auto'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> mv=<span class="string">'mv -i'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">alias</span> rm=<span class="string">'rm -i'</span></span><br><span class="line"></span><br><span class="line">引用命令的执行结果：</span><br><span class="line"></span><br><span class="line"> 使用“引用：</span><br><span class="line"></span><br><span class="line">[root@centos ~]<span class="comment"># echo `date`</span></span><br><span class="line"></span><br><span class="line">Tue Sep 27 06:45:08 CST 2016</span><br><span class="line"></span><br><span class="line">[root@centos ~]<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">使用$(COMMAND)引用</span><br><span class="line"></span><br><span class="line">[root@centos ~]<span class="comment"># file $(which --skip-alias ls)</span></span><br><span class="line"></span><br><span class="line">/bin/ls: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), <span class="keyword">for</span> GNU/Linux 2.6.18, stripped</span><br><span class="line"></span><br><span class="line">[root@centos ~]<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="显示var目录下所有以l开头，以一个小写字母结尾，且中间至少出现一位数字（可以有其它字符）的文件或目录。"><a href="#显示var目录下所有以l开头，以一个小写字母结尾，且中间至少出现一位数字（可以有其它字符）的文件或目录。" class="headerlink" title="显示var目录下所有以l开头，以一个小写字母结尾，且中间至少出现一位数字（可以有其它字符）的文件或目录。"></a>显示var目录下所有以l开头，以一个小写字母结尾，且中间至少出现一位数字（可以有其它字符）的文件或目录。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment"># ls -dl /var/l*[0-9]*[a-z]</span></span><br><span class="line">drwxr-xr-x. 2 root root 6 11月  6 14:58 /var/l42opm</span><br><span class="line">drwxr-xr-x. 2 root root 6 11月  6 14:58 /var/l47wsd</span><br><span class="line">-rw-r--r--. 1 root root 0 11月  6 15:38 /var/l9cxz</span><br><span class="line">drwxr-xr-x. 2 root root 6 11月  6 15:35 /var/ls4gs</span><br><span class="line">drwxr-xr-x. 2 root root 6 11月  6 15:34 /var/lw56tcp</span><br><span class="line">-rw-r--r--. 1 root root 0 11月  6 15:37 /var/lw89cxz</span><br><span class="line">-rw-r--r--. 1 root root 0 11月  6 15:37 /var/lw99cxz</span><br></pre></td></tr></table></figure><p>​    </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment"># ls -dl /var/l*[[:digit:]]*[[:alpha:]]</span></span><br><span class="line">drwxr-xr-x. 2 root root 6 11月  6 14:58 /var/l42opm</span><br><span class="line">drwxr-xr-x. 2 root root 6 11月  6 14:58 /var/l47wsd</span><br><span class="line">-rw-r--r--. 1 root root 0 11月  6 15:38 /var/l9cxz</span><br><span class="line">drwxr-xr-x. 2 root root 6 11月  6 15:35 /var/ls4gs</span><br><span class="line">drwxr-xr-x. 2 root root 6 11月  6 15:34 /var/lw56tcp</span><br><span class="line">-rw-r--r--. 1 root root 0 11月  6 15:37 /var/lw89cxz</span><br><span class="line">-rw-r--r--. 1 root root 0 11月  6 15:37 /var/lw99cxz</span><br></pre></td></tr></table></figure><h3 id="显示-etc目录下，以任意一个数字开头，且以非数字结尾的文件或目录。"><a href="#显示-etc目录下，以任意一个数字开头，且以非数字结尾的文件或目录。" class="headerlink" title="显示/etc目录下，以任意一个数字开头，且以非数字结尾的文件或目录。"></a>显示/etc目录下，以任意一个数字开头，且以非数字结尾的文件或目录。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment"># ls -dl /etc/[[:digit:]]*[[:alpha:]]</span></span><br><span class="line">drwxr-xr-x. 2 root root  6 11月  6 15:43 /etc/12sad</span><br><span class="line">-rw-r--r--. 1 root root 29 11月  6 15:45 /etc/12sd</span><br><span class="line">drwxr-xr-x. 2 root root  6 11月  6 15:43 /etc/23gfhg</span><br><span class="line">-rw-r--r--. 1 root root 35 11月  6 15:46 /etc/4543sdcsf</span><br></pre></td></tr></table></figure><p>​    </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]<span class="comment"># ls -dl /etc/[0-9]*[^0-9]</span></span><br><span class="line">drwxr-xr-x. 2 root root  6 11月  6 15:43 /etc/12sad</span><br><span class="line">-rw-r--r--. 1 root root 29 11月  6 15:45 /etc/12sd</span><br><span class="line">drwxr-xr-x. 2 root root  6 11月  6 15:43 /etc/23gfhg</span><br><span class="line">-rw-r--r--. 1 root root 35 11月  6 15:46 /etc/4543sdcsf</span><br></pre></td></tr></table></figure><h3 id="显示-etc目录下，以非字母开头，后面跟了一个字母以及其它任意长度任意字符的文件或目录。"><a href="#显示-etc目录下，以非字母开头，后面跟了一个字母以及其它任意长度任意字符的文件或目录。" class="headerlink" title="显示/etc目录下，以非字母开头，后面跟了一个字母以及其它任意长度任意字符的文件或目录。"></a>显示/etc目录下，以非字母开头，后面跟了一个字母以及其它任意长度任意字符的文件或目录。</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 /]# ls -dl /etc/[^a-z]*[a-z]</span><br><span class="line">drwxr-xr-x. 2 root root  6 11月  6 15:43 /etc/12sad</span><br><span class="line">-rw-r--r--. 1 root root 29 11月  6 15:45 /etc/12sd</span><br><span class="line">drwxr-xr-x. 2 root root  6 11月  6 15:43 /etc/23gfhg</span><br><span class="line">-rw-r--r--. 1 root root 35 11月  6 15:46 /etc/4543sdcsf</span><br></pre></td></tr></table></figure><h3 id="在-tmp目录下创建以tfile开头，后跟当前日期和时间的文件，文件名形如：tfile-2016-05-27-09-32-22。"><a href="#在-tmp目录下创建以tfile开头，后跟当前日期和时间的文件，文件名形如：tfile-2016-05-27-09-32-22。" class="headerlink" title="在/tmp目录下创建以tfile开头，后跟当前日期和时间的文件，文件名形如：tfile-2016-05-27-09-32-22。"></a>在/tmp目录下创建以tfile开头，后跟当前日期和时间的文件，文件名形如：tfile-2016-05-27-09-32-22。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch /tmp/tfile-$(date +%F-%H-%M-%S)</span><br></pre></td></tr></table></figure><h3 id="复制-etc目录下所有以p开头，以非数字结尾的文件或目录到-tmp-mytest1目录中。"><a href="#复制-etc目录下所有以p开头，以非数字结尾的文件或目录到-tmp-mytest1目录中。" class="headerlink" title="复制/etc目录下所有以p开头，以非数字结尾的文件或目录到/tmp/mytest1目录中。"></a>复制/etc目录下所有以p开头，以非数字结尾的文件或目录到/tmp/mytest1目录中。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /tmp/mytest1 &amp;&amp; cp -r /etc/p*[^0-9] /tmp/mytest1/</span><br></pre></td></tr></table></figure><h3 id="复制-etc目录下所有以-d结尾的文件或目录至-tmp-mytest2目录中。"><a href="#复制-etc目录下所有以-d结尾的文件或目录至-tmp-mytest2目录中。" class="headerlink" title="复制/etc目录下所有以.d结尾的文件或目录至/tmp/mytest2目录中。"></a>复制/etc目录下所有以.d结尾的文件或目录至/tmp/mytest2目录中。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /tmp/mytest2 &amp;&amp; cp -r /etc/*.d /tmp/mytest2/</span><br></pre></td></tr></table></figure><h3 id="复制-etc-目录下所有以l或m或n开头，以-conf结尾的文件至-tmp-mytest3目录中。"><a href="#复制-etc-目录下所有以l或m或n开头，以-conf结尾的文件至-tmp-mytest3目录中。" class="headerlink" title="复制/etc/目录下所有以l或m或n开头，以.conf结尾的文件至/tmp/mytest3目录中。"></a>复制/etc/目录下所有以l或m或n开头，以.conf结尾的文件至/tmp/mytest3目录中。</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /tmp/mytest3 &amp;&amp; cp  /etc/[lmn]*.conf /tmp/mytest3/</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Linux的基础知识</title>
      <link href="/2018/08/02/Linux%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
      <url>/2018/08/02/Linux%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
      <content type="html"><![CDATA[<h2 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h2><h3 id="冯·洛伊曼体系"><a href="#冯·洛伊曼体系" class="headerlink" title="冯·洛伊曼体系"></a>冯·洛伊曼体系</h3><ol><li>控制器(Control)：是整个计算机的中枢神经，其功能是对程序规定的控制信息进行解释，根据其要求进行控制，调度程序、数据、地址，协调计算机各部分工作及内存与外设的访问等。</li><li>运算器(Datapath)：运算器的功能是对数据进行各种算术运算和逻辑运算，即对数据进行加工处理。</li><li>存储器(Memory)：存储器的功能是存储程序、数据和各种信号、命令等信息，并在需要时提供这些信息。</li><li>输入(Input system)：输入设备是计算机的重要组成部分，输入设备与输出设备合称为外部设备，简称外设，输入设备的作用是将程序、原始数据、文字、字符、控制命令或现场采集的数据等信息输入到计算机。常见的输入设备有键盘、鼠标器、光电输入机、磁带机、磁盘机、光盘机等。</li><li>输出(Output system)：输出设备与输入设备同样是计算机的重要组成部分，它把外算机的中间结果或最后结果、机内的各种数据符号及文字或各种控制信号等信息输出出来。微机常用的输出设备有显示终端CRT、打印机、激光印字机、绘图仪及磁带、光盘机等。<a id="more"></a></li></ol><h2 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h2><h3 id="低级语言："><a href="#低级语言：" class="headerlink" title="低级语言："></a>低级语言：</h3><p>汇编语言，汇编器；写驱动</p><h3 id="高级语言："><a href="#高级语言：" class="headerlink" title="高级语言："></a>高级语言：</h3><p>系统级：C，C++，对性能要求较高的服务类程序<br>应用级：Java,Python,Ruby</p><h2 id="Linux-发行版"><a href="#Linux-发行版" class="headerlink" title="Linux 发行版"></a>Linux 发行版</h2><h2 id="RedHat-Enterprise-Linux"><a href="#RedHat-Enterprise-Linux" class="headerlink" title="RedHat Enterprise Linux"></a>RedHat Enterprise Linux</h2><p>Redhat系列，包括RHEL(Redhat Enterprise Linux，也就是所谓的Redhat Advance Server，收费版本)、Fedora Core(由原来的Redhat桌面版本发展而来，免费版本)、CentOS(RHEL的社区 克隆版本，免费)。Redhat是在国内使用人群最多的Linux版本，甚至有人将Redhat等同于Linux。所以这个版本的特点就是使用人群数量大，资料非常多，言下之意就是如果你有什么不明白的地方，很容易找到人来问，而且网上的一般Linux教程都是以Redhat为例来讲解的。Redhat系列的包管理方式采用的是基于RPM包的YUM包管理方式，包分发方式是编译好的二进制文件。稳定性方面RHEL和CentOS的稳定性非常好，适合于服务器使用，但是Fedora Core的稳定性较差，最好只用于桌面应用。 </p><p>CentOS 是一个基于Red Hat Linux 提供的可自由使用源代码的企业级Linux发行版本。每个版本的 CentOS都会获得十年的支持（通过安全更新方式）。新版本的 CentOS 大约每两年发行一次，而每个版本的 CentOS 会定期（大概每六个月）更新一次，以便支持新的硬件。这样，建立一个安全、低维护、稳定、高预测性、高重复性的 Linux 环境。CentOS是Community Enterprise Operating System的缩写。CentOS 是RHEL（Red Hat Enterprise Linux）源代码再编译的产物，而且在RHEL的基础上修正了不少已知的 Bug ，相对于其他 Linux 发行版，其稳定性值得信赖。</p><h2 id="Debian：只有社区的发行版"><a href="#Debian：只有社区的发行版" class="headerlink" title="Debian：只有社区的发行版"></a>Debian：只有社区的发行版</h2><p>Debian系列，包括Debian和Ubuntu等。Debian是社区类Linux的典范，是迄今为止最遵循GNU规范的Linux系统。Debian最早由Ian Murdock于1993年创建，分为三个版本分支（branch）： stable, testing 和unstable。其中，unstable为最新的测试版本，其中包括最新的软件包，但是也有相对较多的bug，适合桌面用户。testing的版本都经过unstable中的测试，相对较为稳定，也支持了不少新技术（比如SMP等）。而stable一般只用于服务器，上面的软件包大部分都比较过时，但是稳定和安全性都非常的高。Debian最具特色的是apt-get / dpkg包管理方式，其实Redhat的YUM也是在模仿Debian的APT方式，但在二进制文件发行方式中，APT应该是最好的了。Debian的资料也很丰富，有很多支持的社区，有问题求教也有地方可去。Debian是包括Ubuntu在内许多发行版的上游，而Ubuntu又是Linux Mint及其他发行版的上游。Debian在服务器和桌面电脑领域都有着广泛的应用。Debian是一个纯开源计划并着重在一个关键点上，稳定性。它同时也提供了最大的和完整的软件仓库给用户。 </p><p>Ubuntu是基于Debian的unstable版本加强而来，可以这么说，Ubuntu就是一个拥有Debian所有的优点，以及自己所加强的优点的近乎完美的 Linux桌面系统。根据选择的桌面系统不同，有三个版本可供选择，基于Gnome的Ubuntu，基于KDE的Kubuntu以及基于Xfc的Xubuntu。特点是界面非常友好，容易上手，对硬件的支持非常全面，是最适合做桌面系统的Linux发行版本。</p><h2 id="Slackware-Linux"><a href="#Slackware-Linux" class="headerlink" title="Slackware Linux"></a>Slackware Linux</h2><p>Slackware Linux是由Patrick Volkerding开发的GNU/Linux发行版。与很多其他的发行版不同，它坚持KISS(Keep It Simple Stupid)的原则。一开始，配置系统会有一些困难，但是更有经验的用户会喜欢这种方式的透明性和灵活性。 Slackware 很多特性体现出了KISS原则，最为有名的一些例子就是不依赖图形界面的文本化系统配置、传统的服务管理方式和不解决依赖的包管理方式。它的最大特点就是安装灵活，目录结构严谨，版本力求稳定而非追新。Slackware的软件包都是通常的tgz(tar/gzip) 或者txz(xz) 格式文件再加上安装脚本。Tgz/Txz 对于有经验的用户来说，比RPM更为灵活，并避免了APT 之类管理器可能带来的的依赖地狱。</p><p>作为开源软件，Slackware与商业版本的关系并不大，但与几家提供付费支持的厂商一直保持的合作关系。作为最早的可用版本之一，Slackware Linux是由Patrick Volkerding开发的GNU/Linux发行版。与很多其他的发行版不同，它坚持KISS(Keep It Simple Stupid)的原则，就是说尽量不依赖配置系统的图形界面工具。其安装程序也是一些Dialog界面的shell脚本写成，你可以在安装的任何时候跳到任何安装步骤，而且这些脚本在安装之后也可以很方便的使用</p><p>Slackware与其他的发行版本（Red Hat、Debian、Gentoo、SuSE、 Mandriva、Ubuntu等）不同的道路，它力图成为“UNIX风格”的Linux发行版本。只吸收稳定版本的应用程序，并且缺少其他linux版本中那些为发行版本定制的配置工具。在当今systemd大势所趋的情况下，Slackware仍然坚持BSD启动风格。</p><p>Slackware主要为x86 PC开发，从2005年起开始出现针对System/390架构的官方移植。同时ARM、DEC Alpha、SPARC和PowerPC也存在一些非官方的移植。Slackware官方维护着一个开发版本（Slackware Current），不断有新的软件被加入到这个源，用户可以实现类似Archlinux的滚动升级，等到一个开发版本足够稳定，便会发布一个稳定版。Slackware是支持x86、amd64（即x86_64）、ARM、Alpha、SPARC、PowerPC的一套GNU/Linux操作系统，其正式发布由PatrickVolkerding 负责。</p><h2 id="Linux发行版汇总"><a href="#Linux发行版汇总" class="headerlink" title="Linux发行版汇总"></a>Linux发行版汇总</h2><p><img src="http://i.imgur.com/JMpVlhj.png" alt=""></p><h2 id="Linux各发行版的联系与区别："><a href="#Linux各发行版的联系与区别：" class="headerlink" title="Linux各发行版的联系与区别："></a>Linux各发行版的联系与区别：</h2><h3 id="联系："><a href="#联系：" class="headerlink" title="联系："></a>联系：</h3><ol><li>各发行版本均采用Linux的内核（kernel）；</li><li>各发行版本均遵守GPL版权协定；</li><li>各发行版本均遵循 Linux Standard Base (LSB)等标准来开发；</li><li>各发行版本均遵循FHS（File system Hierarchy Standard）标准规范；</li></ol><h3 id="区别："><a href="#区别：" class="headerlink" title="区别："></a>区别：</h3><ol><li>不同的发行版采用的软件包管理方式不同；最有名的是 debain 的 deb 包，redhat 的 rpm 包，slackware 等的 tgz 包。</li><li>发行初衷不同，导致特点也不同，见下图：</li></ol><p><img src="http://i.imgur.com/xE0k8AB.png" alt=""></p><h2 id="三、Linux的哲学思想"><a href="#三、Linux的哲学思想" class="headerlink" title="三、Linux的哲学思想"></a>三、Linux的哲学思想</h2><ol><li>一切皆文件</li><li>由众多的单一的程序完成一件比较复杂的工作，一个程序只做一件事，并且做好他。</li><li>尽量避免与用户交互</li><li>使用文本文件保存配置信息</li><li>提供机制（可选的策略、是一种框架），而非策略，提供做大的灵活性。</li></ol><h2 id="四、Linux系统上常用命令的使用格式"><a href="#四、Linux系统上常用命令的使用格式" class="headerlink" title="四、Linux系统上常用命令的使用格式"></a>四、Linux系统上常用命令的使用格式</h2><h2 id="命令的语法通用格式："><a href="#命令的语法通用格式：" class="headerlink" title="命令的语法通用格式："></a>命令的语法通用格式：</h2><p>COMMAND OPTIONS ARGUMENTS</p><h3 id="COMMAND说明"><a href="#COMMAND说明" class="headerlink" title="COMMAND说明"></a>COMMAND说明</h3><p>发起命令时将请求内核将某个二进制程序运行为一个进程，命令本身是一个可执行的程序文件，二进制格式的文件有可能会调用共享库文件。[遵循ELF格式规范]</p><p>多数系统命令程序文件都存放在：/bin,/sbin,/usr/bin,/usr/sbin,/usr/local/bin,/usr/local/sbin，它们又分为普通命令和管理命令。 </p><p>普通命令：存放在/bin,/usr/bin,/usr/local/bin </p><p>管理命令：存放在/sbin,/usr/sbin,/usr/local/sbin </p><p>用到的库文件都存放在：/lib,/lib64,/usr/lib,/usr/lib64,/usr/local/lib,/usr/local/lib64，它们分为32位和64位的库文件，32位使用于32位的操作系统，64位使用于64位的操作系统，64位兼容32位，而32不兼容64 </p><p>32位库：存放在/lib,/usr/lib,/usr/local/lib </p><p>64位库：存放在/lib64,/usr/lib64,/usr/local/lib64 </p><h3 id="命令分为两类："><a href="#命令分为两类：" class="headerlink" title="命令分为两类："></a>命令分为两类：</h3><p>​<br>由shell自带的命令，叫作内嵌命令(builtin) </p><p>独立的可执行程序文件，文件名即命令名，叫作外部命令 </p><p>查看命令的内容的类型： </p><p>file命令：</p><p>例：~]# file /bin/ls </p><p>查看命令的类型： </p><p>type命令： </p><p>例：~]# type COMMAND </p><p>注意：并非所有的命令都有一个在某目录与之对应的可执行程序文件</p><h3 id="OPTIONS说明："><a href="#OPTIONS说明：" class="headerlink" title="OPTIONS说明："></a>OPTIONS说明：</h3><p>指定命令的运行特性，有两种表现形式： </p><p>短选项：-C，例如 ls -l ,-d 注：有的命令选项没有 – ，同一命令同时使用多个短选项可合并：ls -ld </p><p>长选项：–word，例如 ls –help，有时候选项也带参数，例：du -h –max-depth=1 注：长选项不能合并 </p><h3 id="ARGUMENTS说明："><a href="#ARGUMENTS说明：" class="headerlink" title="ARGUMENTS说明："></a>ARGUMENTS说明：</h3><p>参数：命令的作用对象，命令对什么生效，例：ls /etc ,作用在/etc 。注：有些命令可以可同时带多个参数，以空白分隔</p><h2 id="常用命令示例："><a href="#常用命令示例：" class="headerlink" title="常用命令示例："></a>常用命令示例：</h2><h3 id="ifconfig"><a href="#ifconfig" class="headerlink" title="ifconfig"></a>ifconfig</h3><p>作用：显示和配置网络信息</p><p>语法：ifconfig [网络设备][参数]</p><p>示例：ifconfig -a</p><h3 id="echo"><a href="#echo" class="headerlink" title="echo"></a>echo</h3><p>作用：显示文本</p><p>语法：echo [-ne][字符串]或 echo [–help][–version]</p><p>示例：echo ‘Hello World’</p><h3 id="tty"><a href="#tty" class="headerlink" title="tty"></a>tty</h3><p>作用：显示终端机连接标准输入设备的文件名称</p><p>语法：tty [-s][–help][–version]</p><p>示例：tty</p><h3 id="startx"><a href="#startx" class="headerlink" title="startx"></a>startx</h3><p>作用：进入图形操作界面</p><p>示例：startx &amp;</p><h3 id="export"><a href="#export" class="headerlink" title="export"></a>export</h3><p>作用：设置或显示环境变量</p><p>语法：export [-fnp][变量名称]=[变量设置值]</p><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> JAVA_HOME = /home/myuser/jdk1.7.0_03</span><br><span class="line"><span class="built_in">export</span> PATH = <span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br></pre></td></tr></table></figure><h3 id="pwd"><a href="#pwd" class="headerlink" title="pwd"></a>pwd</h3><p>作用：显示当前工作目录</p><p>语法：pwd[–help][–version]</p><p>示例：pwd</p><h3 id="history"><a href="#history" class="headerlink" title="history"></a>history</h3><p>作用：列出bash保存的所有历史命令</p><p>语法：history  [选项]</p><p>示例1：history</p><p>示例2:使用HISTTIMEFORMAT环境变量在历史中显示TIMESTAMP</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">命令：</span><br><span class="line"><span class="built_in">export</span> HISTTIMEFORMAT=<span class="string">'%F %T '</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$history</span></span><br><span class="line"></span><br><span class="line">输出如下：</span><br><span class="line">642  2016-10-25 17:05:46 ll</span><br><span class="line">643  2016-10-25 17:05:46 rm 333 </span><br><span class="line">644  2016-10-25 17:05:46 ll /etc/fstab </span><br><span class="line">645  2016-10-25 17:05:51 <span class="built_in">history</span> --<span class="built_in">help</span></span><br><span class="line">646  2016-10-25 17:05:59 <span class="built_in">history</span> -h</span><br><span class="line">647  2016-10-25 17:06:14 man <span class="built_in">history</span></span><br><span class="line">648  2016-10-25 17:07:53 <span class="built_in">history</span> </span><br><span class="line">649  2016-10-25 17:07:57 <span class="built_in">export</span> HISTTIMEFORMAT=<span class="string">'%F %T '</span></span><br><span class="line">650  2016-10-25 17:07:59 <span class="built_in">history</span></span><br></pre></td></tr></table></figure><h3 id="shutdown"><a href="#shutdown" class="headerlink" title="shutdown"></a>shutdown</h3><p>作用：系统关机命令</p><p>语法：shutdown [-cfFhknr][-t 秒数][时间][警告信息]</p><p>示例：shuntdown -r +5</p><h3 id="poweroff"><a href="#poweroff" class="headerlink" title="poweroff"></a>poweroff</h3><p>作用：关机</p><p>语法：这个命令还说啥语法啊，生产环境上不要随便执行这个命令，否则会被捆绑、滴蜡、爆菊啊<del>~</del></p><p>示例：poweroff</p><h3 id="reboot"><a href="#reboot" class="headerlink" title="reboot"></a>reboot</h3><p>作用：重启</p><p>语法：运维常用作死命令之一，最好在头脑清醒的前提下执行。</p><p>示例：reboot</p><h3 id="hwclock"><a href="#hwclock" class="headerlink" title="hwclock"></a>hwclock</h3><p>作用：用来查询和设置硬件时钟</p><p>语法：  </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-r, --show        读取并打印硬件时钟（<span class="built_in">read</span> hardware clock and <span class="built_in">print</span> result ）</span><br><span class="line">-s, --hctosys     将硬件时钟同步到系统时钟（<span class="built_in">set</span> the system time from the hardware clock ）</span><br><span class="line">-w, --systohc     将系统时钟同步到硬件时钟（<span class="built_in">set</span> the hardware clock to the current system time ）</span><br></pre></td></tr></table></figure><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># hwclock -r</span></span><br><span class="line">2016年10月25日 星期二 17时32分28秒  -0.671802 seconds</span><br></pre></td></tr></table></figure><h3 id="date"><a href="#date" class="headerlink" title="date"></a>date</h3><p>作用：取一个特定时间的linux时间戳</p><p>语法：date [参数]… [+格式]</p><p>示例：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@centos ~]<span class="comment"># date</span></span><br><span class="line">2016年 10月 25日 星期二 17:33:17 CST</span><br></pre></td></tr></table></figure><h2 id="五、如何在Linux系统上获取命令的帮助信息，请详细列出，并描述man文档的章节时如何划分的"><a href="#五、如何在Linux系统上获取命令的帮助信息，请详细列出，并描述man文档的章节时如何划分的" class="headerlink" title="五、如何在Linux系统上获取命令的帮助信息，请详细列出，并描述man文档的章节时如何划分的"></a>五、如何在Linux系统上获取命令的帮助信息，请详细列出，并描述man文档的章节时如何划分的</h2><h2 id="获取命令的使用帮助："><a href="#获取命令的使用帮助：" class="headerlink" title="获取命令的使用帮助："></a>获取命令的使用帮助：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">内部命令：</span><br><span class="line">    <span class="built_in">help</span> COMMAND</span><br><span class="line">外部命令：</span><br><span class="line">    (1) 命令自带简要格式的使用帮助</span><br><span class="line">        <span class="comment"># COMMAND –help</span></span><br><span class="line">    (2) 使用手册：manual</span><br><span class="line">        位置：/usr/share/man</span><br><span class="line">        <span class="comment"># man COMMAND</span></span><br></pre></td></tr></table></figure><p>先执行type COMMNAD 识别是内部命令还是外部命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">(3) info COMMAND</span><br><span class="line">    获取命令的在线文档；</span><br><span class="line"></span><br><span class="line">(4) 很多应用程序会自带帮助文档：/usr/share/doc/APP-VERSION</span><br><span class="line">    README：程序的相关的信息；</span><br><span class="line">    INSTALL: 安装帮助；</span><br><span class="line">    CHANGES：版本迭代时的改动信息；</span><br><span class="line"></span><br><span class="line">(5) 主流发行版官方文档</span><br><span class="line">    http://www.redhat.com/doc</span><br><span class="line"></span><br><span class="line">(6) 程序官方的文档：</span><br><span class="line">    官方站点上的“Document”</span><br><span class="line"></span><br><span class="line">(7) 搜索引擎</span><br><span class="line">    google、baidu </span><br><span class="line"></span><br><span class="line">    keyword filetype:pdf   （输入文章类型更有针对性）</span><br><span class="line">    keyword site:domain.tld</span><br></pre></td></tr></table></figure><h2 id="man-文档章节如何划分"><a href="#man-文档章节如何划分" class="headerlink" title="man 文档章节如何划分"></a>man 文档章节如何划分</h2><p>使用手册：压缩格式的文件，有章节之分；<br>                    /usr/share/man<br>                        man1, man2, …</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1：用户命令；  （普通用户和管理员）</span><br><span class="line">2：系统调用；</span><br><span class="line">3：C库调用；</span><br><span class="line">4：设备文件及特殊文件；</span><br><span class="line">5：文件格式；（配置文件格式）</span><br><span class="line">6：游戏使用帮助；</span><br><span class="line">7：杂项；</span><br><span class="line">8：管理工具及守护进行；</span><br></pre></td></tr></table></figure><h2 id="Linux发行版的基础目录名称命名法则及其功用规定"><a href="#Linux发行版的基础目录名称命名法则及其功用规定" class="headerlink" title="Linux发行版的基础目录名称命名法则及其功用规定"></a>Linux发行版的基础目录名称命名法则及其功用规定</h2><h2 id="FHS："><a href="#FHS：" class="headerlink" title="FHS："></a>FHS：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FHS：全称Filesystem Hierarchy Standard，其定义了两层规范，</span><br></pre></td></tr></table></figure><h2 id="下面的各个目录应该要放什么数据："><a href="#下面的各个目录应该要放什么数据：" class="headerlink" title="/下面的各个目录应该要放什么数据："></a>/下面的各个目录应该要放什么数据：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">/bin：所有用户可用的基本命令程序文件；</span><br><span class="line"></span><br><span class="line">/sbin：供系统管理使用的工具程序；</span><br><span class="line"></span><br><span class="line">/boot：引导加载器必须用到的各静态文件：kernel，initramfs（initrd），grub等；</span><br><span class="line"></span><br><span class="line">/dev：存储特殊文件或设备文件；设备有两种类型：字符设备（线性设备）例如：键盘、显示器；块设备（随机设备）例如：硬盘、内存；</span><br><span class="line"></span><br><span class="line">/etc：系统程序的配置文件，只能为静态</span><br><span class="line"></span><br><span class="line">/home：普通用户的家目录的集中位置；一般每个普通用户的家目录默认为此目录下与用户名同名的子目录，/home/USERNAME；</span><br><span class="line"></span><br><span class="line">/root：管理员的家目录；可选</span><br><span class="line"></span><br><span class="line">/lib：为系统启动或根文件系统上的应用程序（/bin，/sbin等）提供共享库，以及为内核提供的内核参数模块； libc.so.：动态链接的C库； ld：运行时链接器/加载器； modules：用于存储内核模块的目录；</span><br><span class="line"></span><br><span class="line">/lib64：64位系统特有的存放64位共享库的路径；</span><br><span class="line"></span><br><span class="line">/media：便携式设备挂载点，cdrom，floppy等；</span><br><span class="line"></span><br><span class="line">/mnt：其它文件系统的临时挂载点；</span><br><span class="line"></span><br><span class="line">/opt：附加应用程序的安装位置；可选路径；</span><br><span class="line"></span><br><span class="line">/srv：当前主机为服务提供的数据；</span><br><span class="line"></span><br><span class="line">/tmp：为那些会产生临时文件的程序提供的用于存储临时文件的目录；可供所有用户执行写入操作；有特殊权限；</span><br><span class="line"></span><br><span class="line">/usr：usr Hierarchy，全局共享的只读数据路径；</span><br><span class="line"></span><br><span class="line">/var：/var Hierarchy，存储经常发生变化的数据的目录；</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MySQL启用的SSL连接的思考与实践</title>
      <link href="/2018/08/01/mysql-ssl/"/>
      <url>/2018/08/01/mysql-ssl/</url>
      <content type="html"><![CDATA[<h2 id="MySQL启用的SSL连接的思考与实践"><a href="#MySQL启用的SSL连接的思考与实践" class="headerlink" title="MySQL启用的SSL连接的思考与实践"></a>MySQL启用的SSL连接的思考与实践</h2><p><img src="/2018/08/01/mysql-ssl/bodyguard.jpg" alt="SSL"></p><p>由于工作上的业务发展和等保三级合规的要求，需要考虑为MySQL启用SSL连接，那么今天就来说说这个怎么玩。其实一个月前已经在实现了用docker跑MySQL SSL了，只不过后到今天才有时间静下心来总结一下。</p><h3 id="有必要使用为MySQL启用SSL吗？"><a href="#有必要使用为MySQL启用SSL吗？" class="headerlink" title="有必要使用为MySQL启用SSL吗？"></a>有必要使用为MySQL启用SSL吗？</h3><p>先来了解一下SSL吧：</p><p><strong>SSL</strong>（Secure Socket Layer：安全套接字层）利用数据加密、身份验证和消息完整性验证机制，为基于TCP等可靠连接的应用层协议提供安全性保证。<a id="more"></a></p><p>SSL协议提供的功能主要有：</p><p>​    1、 数据传输的机密性：利用对称密钥算法对传输的数据进行加密。<br>    2.、身份验证机制：基于证书利用数字签名方法对服务器和客户端进行身份验证，其中客户端的身份验证是可选的。<br>    3、 消息完整性验证：消息传输过程中使用MAC算法来检验消息的完整性。</p><p>如果用户的传输不是通过SSL的方式，那么其在网络中数据都是以明文进行传输的，而这给别有用心的人带来了可乘之机。所以，现在很多大型网站都开启了SSL功能。同样地，在我们数据库方面，如果客户端连接服务器获取数据不是使用SSL连接，那么在传输过程中，数据就有可能被窃取。</p><p>所以，我认为启用SSL是一个不错的选择。</p><h3 id="那么SSL如何工作在MySQL中的"><a href="#那么SSL如何工作在MySQL中的" class="headerlink" title="那么SSL如何工作在MySQL中的"></a>那么SSL如何工作在MySQL中的</h3><p>这里分两说，因为工作中我涉及到MySQL5.6和MySQL 5.7两个版本，它们在SSL连接的实现上也有少许区别。</p><p><strong>MySQL5.6的SSL</strong></p><p>MySQL  5.6中的SSL文档非常详细，它解释了SSL的工作原理。但首先让我们说清楚一点：MySQL支持使用TLS（传输层安全性）协议在客户端和服务器之间建立安全（加密）连接。 TLS有时被称为SSL（安全套接字层），但MySQL实际上并不使用SSL协议进行安全连接，因为它提供弱加密。 </p><p>因此，当我们有人说MySQL正在使用SSL时，它实际上意味着它正在使用TLS。您可以使用以下命令检查您使用的协议： </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">show status like &apos;Ssl_version&apos;;</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| Ssl_version | TLSv1.2 |</span><br><span class="line">+---------------+---------+</span><br></pre></td></tr></table></figure><p>TLS使用加密算法来确保可以信任通过公共网络接收的数据。它具有检测数据更改，丢失或重放的机制。 TLS还包含使用X509标准提供身份验证的算法。  X509可以识别互联网上的某个人。在基本术语中，应该有一些称为“证书颁发机构”（或CA）的实体，它将电子证书分配给需要它们的任何人。证书依赖于具有两个加密密钥（公钥和密钥）的非对称加密算法。证书所有者可以将证书提供给另一方作为身份证明。证书由其所有者的公钥组成。使用该公钥加密的任何数据只能使用由证书所有者持有的相应密钥解密。</p><p>MySQL5.6只支持TLSv1，MySQL5.7则支持TLSv1, TLSv1.1, and TLSv1.2 。</p><p>MySQL支持使用TLS协议的加密连接：<br>    使用OpenSSL 1.0.1或更高版本编译时，MySQL支持TLSv1，TLSv1.1和TLSv1.2协议。<br>    当使用捆绑版本的yaSSL进行编译时，MySQL支持TLSv1和TLSv1.1协议。 </p><p>使用SSL配置服务器时，客户端必须具有客户端证书。获得后，它可以使用SSL连接到服务器。MySQL5.6的客户端必须指定密钥和证书。否则，我们无法使用SSL连接到服务器。 如下：</p><p>my.cnf配置文件如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">skip-host-cache</span><br><span class="line">skip-name-resolve</span><br><span class="line">pid-file= /var/run/mysqld/mysqld.pid</span><br><span class="line">socket= /var/run/mysqld/mysqld.sock</span><br><span class="line">datadir= /var/lib/mysql</span><br><span class="line">#log-error= /var/log/mysql/error.log</span><br><span class="line"># Disabling symbolic-links is recommended to prevent assorted security risks</span><br><span class="line">symbolic-links=0</span><br><span class="line">ssl-ca=/etc/mysql/certs/ca.pem</span><br><span class="line">ssl-cert=/etc/mysql/certs/MySQL1-cert.pem</span><br><span class="line">ssl-key=/etc/mysql/certs/MySQL1-key.pem</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">ssl-ca=/etc/mysql/certs/ca.pem</span><br><span class="line">ssl-cert=/etc/mysql/certs/MySQL-client-cert.pem</span><br><span class="line">ssl-key=/etc/mysql/certs/MySQL-client-key.pem</span><br></pre></td></tr></table></figure><p>客户端连接：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql --ssl-ca=/etc/mysql/certs/ca.pem  --ssl-cert=/etc/mysql/certs/MySQL-client-cert.pem --ssl-key=/etc/mysql/certs/MySQL-client-key.pem</span><br></pre></td></tr></table></figure><p><strong>MySQL5.7的SSL</strong></p><p>默认情况下，如果服务器支持加密连接，MySQL程序将尝试使用加密进行连接，如果无法建立加密连接，则会回退到未加密的连接。有关影响加密连接使用的选项的信息 。<br>MySQL基于每个连接执行加密，并且对给定用户使用加密可以是可选的或强制的。可以根据各个应用程序的要求选择加密或未加密的连接。在CREATE USER的时候，有SSL相关的参数可以选择，这个创建用户参数取决于其用户连接时，是否必须使用密钥文件连接MySQL。</p><p>这些在官方文档里面都有说明，可以去详细了解下。这里就不铺开了。</p><p><strong>MySQL 5.7中的加密连接支持进行了一些改进。以下时间表总结了这些变化：</strong>        </p><p>5.7.3：在客户端，明确的–ssl选项不再是建议性的，而是规定性的。如果服务器支持加密连接，则客户端程序可以通过仅指定–ssl选项来要求加密连接。 （以前，客户端必须指定–ssl-ca选项，或者所有三个–ssl-ca， –ssl-key和–ssl-cert选项。）连接尝试失败如果无法建立加密连接。客户端的其他–ssl-xxx选项在没有–ssl的情况下是建议性的：客户端尝试使用加密进行连接，但如果无法建立加密连接，则会回退到未加密的连接。        </p><p>5.7.5：默认情况下启用服务器端–ssl选项值。        对于使用OpenSSL编译的服务器，auto_generate_certs和sha256_password_auto_generate_rsa_keys系统变量可用于在启动时启用SSL /  RSA证书和密钥文件的自动生成和自动发现。对于证书和密钥自动发现，如果启用了–ssl并且未给出其他–ssl-xxx选项以明确配置加密连接，则服务器会在启动时尝试自动启用对加密连接的支持，如果它发现必需的证书和密钥文件在数据目录中。        </p><p>5.7.6：mysql_ssl_rsa_setup实用程序可用于手动生成SSL / RSA证书和密钥文件。启动时自动发现SSL / RSA文件将扩展为适用于所有服务器，无论是使用OpenSSL还是使用yaSSL编译。  （这意味着无需启用auto_generate_certs即可进行自动发现。）        如果服务器在启动时发现CA证书是自签名的，则会向错误日志写入警告。 （如果服务器自动创建证书，则证书是自签名的，或者使用mysql_ssl_rsa_setup手动创建证书。）        </p><p>5.7.7：如果服务器支持加密连接，则C客户端库会默认尝试建立加密连接。这会影响客户程序，如下所示：            </p><ul><li>如果没有–ssl选项，客户端将尝试使用加密进行连接，如果无法建立加密连接，则会回退到未加密的连接。            </li><li>显式–ssl选项或同义词（–ssl = 1， -  enable-ssl）的存在是规定性的：客户端需要加密连接，如果无法建立，则会失败。</li><li>使用–ssl = 0选项或同义词（–skip-ssl， -  disable-ssl），客户端使用未加密的连接.此更改还会影响基于C客户端库的MySQL连接器的后续版本：Connector / C，Connector / C ++和Connector / ODBC。        </li></ul><p>5.7.8：require_secure_transport系统变量可用于控制与服务器的客户端连接是否必须使用某种形式的安全传输。        </p><p>5.7.10：TLS协议支持从TLSv1扩展到TLSv1.1和TLSv1.2。服务器端的tls_version系统变量和客户端的–tls-version选项可以选择支持级别。   </p><p>5.7.11：MySQL客户端程序支持–ssl-mode选项，使您可以指定与服务器的连接的安全状态。  –ssl-mode选项包括客户端–ssl和–ssl-verify-server-cert选项的功能。因此，不推荐使用–ssl和–ssl-verify-server-cert，MySQL 8.0中已经删除它们。 </p><p>好，上边说了这么多，各位都看明白了吗？不明白也没关系，我下面用docker来演示</p><p><strong>坑点：我用许多客户端应用程序对它进行了测试，无论是MySQL5.6或5.7，MySQL客户端连接服务端时必须指定客户端密钥。没有密钥，无法连接到服务器。某些较旧的应用程序可能不支持此功能。 所以啊，官档说的也不一定全对。</strong></p><h3 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h3><p>这里以MySQL5.6为例</p><p>1、建立目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mkdir -pv mysql_ssl_&#123;data,config,cert&#125;</span></span><br><span class="line">mkdir: created directory <span class="string">'mysql_ssl_data'</span></span><br><span class="line">mkdir: created directory <span class="string">'mysql_ssl_config'</span></span><br><span class="line">mkdir: created directory <span class="string">'mysql_ssl_cert'</span></span><br></pre></td></tr></table></figure><p>准备好数据、证书、配置等文件</p><p>2、启动容器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name mysql5.6_ssl_test -v /data/mysql_ssl_data/:/var/lib/mysql -v /data/mysql_ssl_config/my.cnf:/etc/my.cnf -v /data/mysql_ssl_cert/:/etc/mysql/certs -p 3306:3306 mysql:5.6.40</span><br></pre></td></tr></table></figure><p>3、因为MySQL5.6默认用户是不开启SSL认证的，需要进行如下操作：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改已存在用户 </span></span><br><span class="line">GRANT USAGE ON *.* TO `user`@`%` REQUIRE X509;</span><br><span class="line"><span class="comment">#新建必须使用SSL用户</span></span><br><span class="line">grant all privileges on *.* to <span class="string">'user'</span>@<span class="string">'%'</span> identified by <span class="string">'111111'</span> with grant option;</span><br><span class="line">GRANT USAGE ON *.* TO `user`@`%` REQUIRE X509;</span><br></pre></td></tr></table></figure><p>对于具有REQUIRE  X509的帐户，客户端必须指定要连接的–ssl-key和–ssl-cert选项。  （建议但不要求也指定–ssl-ca，以便验证服务器提供的公共证书。）对于ISSUER和SUBJECT也是如此，因为这些REQUIRE选项意味着X509的要求。 </p><p>好，现在无论是用图形化工具还是使用命令行客户端，都必须指定客户端的证书及密钥文件，加上账户密码，才能连接登录MySQL了。</p><p><strong>参考资料：</strong></p><p><a href="https://www.cnblogs.com/mysql-dba/p/7061300.html" target="_blank" rel="noopener">https://www.cnblogs.com/mysql-dba/p/7061300.html</a></p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/encrypted-connection-protocols-ciphers.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/encrypted-connection-protocols-ciphers.html</a></p><p><a href="https://dev.mysql.com/doc/refman/5.6/en/encrypted-connection-protocols-ciphers.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.6/en/encrypted-connection-protocols-ciphers.html</a></p><p><a href="https://dev.mysql.com/doc/refman/5.6/en/encrypted-connections.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.6/en/encrypted-connections.html</a></p><p><a href="https://dev.mysql.com/doc/refman/5.7/en/encrypted-connections.html" target="_blank" rel="noopener">https://dev.mysql.com/doc/refman/5.7/en/encrypted-connections.html</a></p><p>​</p>]]></content>
      
      
        <tags>
            
            <tag> SSL,MySQL </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MongoDB备份数据引擎升级</title>
      <link href="/2018/07/09/mongodb/"/>
      <url>/2018/07/09/mongodb/</url>
      <content type="html"><![CDATA[<h2 id="MongoDB备份数据引擎升级"><a href="#MongoDB备份数据引擎升级" class="headerlink" title="MongoDB备份数据引擎升级"></a>MongoDB备份数据引擎升级</h2><p><strong>准备工作</strong></p><ol><li>确认已经安装需要运行的MongoDB版本</li><li>确保有足够的空间进行数据导出导入</li><li>您必须使用MongoDB版本3.0或更高版本才能使用WireldTiger存储引擎。 如果使用较早的MongoDB版本，则必须在继续更改存储引擎之前升级MongoDB版本。本文使用的是MongoDB 3.6</li><li>本文使用docker来操作，请自行安装好docker环境。<a id="more"></a></li><li>直接在裸机安装MongoDB 3.6进行操作亦可。</li><li>这里演示从MongoDB 2.6备份出来的数据还原到MongoDB 3.6 并以WireldTiger引擎启动运行</li></ol><p><strong>步骤</strong></p><p>1、启动你要运行的MongoDB版本，本文用的是3.6 ，Docker运行，配置文件写明要以<code>wiredTiger</code>  启动。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name <span class="variable">$CONTAINER_NAME</span> -v <span class="variable">$DATA_PATH</span>:/data/db -v <span class="variable">$OLD_DATA_PATH</span>:/data2 -v /<span class="variable">$CONFIG_PATH</span>/mongod.conf:/etc/mongod.conf.orig -p <span class="variable">$IP</span>:27017:27017 mongo:3.6</span><br></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">变量名</th><th style="text-align:center">作用说明</th></tr></thead><tbody><tr><td style="text-align:center">$CONTAINER_NAME</td><td style="text-align:center">自定义的容器名字</td></tr><tr><td style="text-align:center">$DATA_PATH</td><td style="text-align:center">容器在宿主机上的数据卷路径</td></tr><tr><td style="text-align:center">$OLD_DATA_PATH</td><td style="text-align:center">待升级的老版本MongoDB备份数据</td></tr><tr><td style="text-align:center">$CONFIG_PATH</td><td style="text-align:center">新版MongoDB的配置文件目录</td></tr><tr><td style="text-align:center">$IP</td><td style="text-align:center">MongoDB容器对外提供服务的IP地址</td></tr></tbody></table><p>配置文件</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Where and how to store data.</span></span><br><span class="line"><span class="attr">storage:</span></span><br><span class="line"><span class="attr">  dbPath:</span> <span class="string">/var/lib/mongodb</span></span><br><span class="line"><span class="attr">    journal:</span></span><br><span class="line"><span class="attr">      enabled:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    engine:</span> <span class="string">wiredTiger</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># where to write logging data.</span></span><br><span class="line"><span class="attr">  systemLog:</span></span><br><span class="line"><span class="attr">    destination:</span> <span class="string">file</span></span><br><span class="line"><span class="attr">    logAppend:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">    path:</span> <span class="string">/var/log/mongodb/mongod.log</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># network interfaces</span></span><br><span class="line"><span class="attr">    net:</span></span><br><span class="line"><span class="attr">     port:</span> <span class="number">27017</span></span><br><span class="line"><span class="attr">     bindIp:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># how the process runs</span></span><br><span class="line"><span class="attr">    processManagement:</span></span><br><span class="line"><span class="attr">    timeZoneInfo:</span> <span class="string">/usr/share/zoneinfo</span></span><br></pre></td></tr></table></figure><p>2、把 MongoDB 2.6的备份数据解压到$OLD_DATA_PATH</p><p>3、进入MongoDB 3.6的容器中执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it <span class="variable">$CONTAINER_NAME</span> /bin/bash <span class="comment">#进入docker并分配bash终端</span></span><br><span class="line">mongorestore data2/<span class="comment">#从data2目录中导入备份数据</span></span><br></pre></td></tr></table></figure><p>OK，接下来静候佳音即可。中间会有一段漫长的导入数据，转换引擎，重建索引的过程。</p><p>当然，你要是土豪，用固态硬盘也是极好的。</p><p>4、最后一步，查看一下数据引擎。运行db.serverStatus()命令,查询结果包含如下内容即可：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"storageEngine" : &#123;</span><br><span class="line">"name" : "wiredTiger",</span><br><span class="line">"supportsCommittedReads" : true,</span><br><span class="line">"readOnly" : false,</span><br><span class="line">"persistent" : true</span><br></pre></td></tr></table></figure>]]></content>
      
      
        <tags>
            
            <tag> MongoDB,Docker </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
